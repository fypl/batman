(function(){var t,e=Array.prototype.slice;t=function(){var n;return n=arguments.length>=1?e.call(arguments,0):[],function(t,e,n){n.prototype=t.prototype;var r=new n,o=t.apply(r,e);return"object"==typeof o?o:r}(t.Object,n,function(){})},t.version="0.14.1",t.config={pathToApp:"/",pathToHTML:"html",fetchRemoteHTML:!0,usePushState:!0,minificationErrors:!0},(t.container=function(){return this}()).Batman=t,"function"==typeof define&&define("batman",[],function(){return t}),t.exportHelpers=function(e){var n,r,o,i;for(i=["mixin","extend","unmixin","redirect","typeOf","redirect","setImmediate","clearImmediate"],r=0,o=i.length;o>r;r++)n=i[r],e["$"+n]=t[n];return e},t.exportGlobals=function(){return t.exportHelpers(t.container)}}).call(this),function(){var t;Batman._Batman=t=function(){function t(t){this.object=t}return t.prototype.check=function(t){return t!==this.object?(t._batman=new Batman._Batman(t),!1):!0},t.prototype.get=function(t){var e,n;switch(n=this.getAll(t),n.length){case 0:return;case 1:return n[0];default:return e=null!=n[0].concat?function(t,e){return t.concat(e)}:null!=n[0].merge?function(t,e){return t.merge(e)}:n.every(function(t){return"object"==typeof t})?(n.unshift({}),function(t,e){return Batman.extend(t,e)}):void 0,e?n.reduceRight(e):n}},t.prototype.getFirst=function(t){var e;return e=this.getAll(t),e[0]},t.prototype.getAll=function(t){var e,n,r;return e="function"==typeof t?t:function(e){var n;return null!=(n=e._batman)?n[t]:void 0},n=this.ancestors(e),(r=e(this.object))&&n.unshift(r),n},t.prototype.ancestors=function(t){var e,n,r,o,i,a;if(this._allAncestors||(this._allAncestors=this.allAncestors()),t){for(n=[],a=this._allAncestors,o=0,i=a.length;i>o;o++)e=a[o],r=t(e),null!=r&&n.push(r);return n}return this._allAncestors},t.prototype.allAncestors=function(){var t,e,n,r,o,i;return r=[],t=!!this.object.prototype,e=t?null!=(o=this.object.__super__)?o.constructor:void 0:(n=Object.getPrototypeOf(this.object))===this.object?this.object.constructor.__super__:n,null!=e&&(null!=(i=e._batman)&&i.check(e),r.push(e),null!=e._batman&&(r=r.concat(e._batman.allAncestors()))),r},t.prototype.set=function(t,e){return this[t]=e},t}()}.call(this),function(){var t,e,n,r,o,i,a,s,u=Array.prototype.slice,c=Object.prototype.hasOwnProperty,p=Array.prototype.indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(this[e]===t)return e;return-1};Batman.typeOf=function(t){return t===void 0?"Undefined":i.call(t).slice(8,-1)},i=Object.prototype.toString,Batman.extend=function(){var t,e,n,r,o,i,a;for(r=arguments[0],n=arguments.length>=2?u.call(arguments,1):[],i=0,a=n.length;a>i;i++){e=n[i];for(t in e)o=e[t],r[t]=o}return r},Batman.mixin=function(){var t,e,n,r,o,i,a,s;for(o=arguments[0],r=arguments.length>=2?u.call(arguments,1):[],t="function"==typeof o.set,a=0,s=r.length;s>a;a++)if(n=r[a],"Object"===Batman.typeOf(n)){for(e in n)c.call(n,e)&&(i=n[e],"initialize"!==e&&"uninitialize"!==e&&"prototype"!==e&&(t?o.set(e,i):null!=o.nodeName?Batman.data(o,e,i):o[e]=i));"function"==typeof n.initialize&&n.initialize.call(o)}return o},Batman.unmixin=function(){var t,e,n,r,o,i;for(t=arguments[0],r=arguments.length>=2?u.call(arguments,1):[],o=0,i=r.length;i>o;o++){n=r[o];for(e in n)"initialize"!==e&&"uninitialize"!==e&&delete t[e];"function"==typeof n.uninitialize&&n.uninitialize.call(t)}return t},Batman._functionName=Batman.functionName=function(t){var e;return t.__name__?t.__name__:t.name?t.name:null!=(e=(""+t).match(/\W*function\s+([\w\$]+)\(/))?e[1]:void 0},Batman._isChildOf=Batman.isChildOf=function(t,e){var n;for(n=e.parentNode;n;){if(n===t)return!0;n=n.parentNode}return!1},o=function(t){var e,n,r,o,i,a,s;return e=function(){var e,n;return t.postMessage?(e=!0,n=t.onmessage,t.onmessage=function(){return e=!1},t.postMessage("","*"),t.onmessage=n,e):!1},s=new Batman.SimpleHash,n=0,o=function(){return"go"+ ++n},t.setImmediate&&t.clearImmediate?(Batman.setImmediate=function(){return t.setImmediate.apply(t,arguments)},Batman.clearImmediate=function(){return t.clearImmediate.apply(t,arguments)}):e()?(a="com.batman.",r=new Batman.SimpleHash,i=function(t){var e,n;if(~t.data.search(a))return e=t.data.substring(a.length),"function"==typeof(n=s.unset(e))?n():void 0},t.addEventListener?t.addEventListener("message",i,!1):t.attachEvent("onmessage",i),Batman.setImmediate=function(e){var n;return s.set(n=o(),e),t.postMessage(a+n,"*"),n},Batman.clearImmediate=function(t){return s.unset(t)}):"undefined"!=typeof document&&p.call(document.createElement("script"),"onreadystatechange")>=0?(Batman.setImmediate=function(){var t,e;return t=o(),e=document.createElement("script"),e.onreadystatechange=function(){var n;return"function"==typeof(n=s.get(t))&&n(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},document.documentElement.appendChild(e),t},Batman.clearImmediate=function(t){return s.unset(t)}):("undefined"!=typeof process&&null!==process?process.nextTick:void 0)?(r={},Batman.setImmediate=function(t){var e;return e=o(),r[e]=t,process.nextTick(function(){return"function"==typeof r[e]&&r[e](),delete r[e]}),e},Batman.clearImmediate=function(t){return delete r[t]}):(Batman.setImmediate=function(t){return setTimeout(t,0)},Batman.clearImmediate=function(t){return clearTimeout(t)})},Batman.setImmediate=function(){return o(Batman.container),Batman.setImmediate.apply(this,arguments)},Batman.clearImmediate=function(){return o(Batman.container),Batman.clearImmediate.apply(this,arguments)},Batman.forEach=function(t,e,n){var r,o,i,a,s,u,c;if(t.forEach)return t.forEach(e,n);if(t.indexOf){for(u=[],o=0,s=t.length;s>o;o++)r=t[o],u.push(e.call(n,r,o,t));return u}c=[];for(i in t)a=t[i],c.push(e.call(n,i,a,t));return c},Batman.objectHasKey=function(t,e){return"function"==typeof t.hasKey?t.hasKey(e):e in t},Batman.contains=function(t,e){return t.indexOf?p.call(t,e)>=0:"function"==typeof t.has?t.has(e):Batman.objectHasKey(t,e)},Batman.get=function(t,e){return"function"==typeof t.get?t.get(e):Batman.Property.forBaseAndKey(t,e).getValue()},Batman.getPath=function(t,e){var n,r,o;for(r=0,o=e.length;o>r;r++){if(n=e[r],null==t)return;if(t=Batman.get(t,n),null==t)return t}return t},r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},a=[],e=[];for(t in r)a.push(t),e.push(r[t]);s=RegExp("["+a.join("")+"]","g"),n=RegExp("("+e.join("|")+")","g"),Batman.escapeHTML=function(){return function(t){return(""+t).replace(s,function(t){return r[t]})}}(),Batman.unescapeHTML=function(){return function(t){var e;if(null!=t)return e=Batman._unescapeHTMLNode||(Batman._unescapeHTMLNode=document.createElement("DIV")),e.innerHTML=t,Batman.DOM.textContent(e)}}(),Batman.translate=function(t,e){return null==e&&(e={}),Batman.helpers.interpolate(Batman.get(Batman.translate.messages,t),e)},Batman.translate.messages={},Batman.t=function(){return Batman.translate.apply(Batman,arguments)},Batman.redirect=function(t,e){var n;return null==e&&(e=!1),null!=(n=Batman.navigator)?n.redirect(t,e):void 0},Batman.initializeObject=function(t){return null!=t._batman?t._batman.check(t):t._batman=new Batman._Batman(t)}}.call(this),function(){var t=Array.prototype.slice,e=Array.prototype.indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(this[e]===t)return e;return-1};Batman.Inflector=function(){function n(){this._plural=[],this._singular=[],this._uncountable=[],this._human=[]}return n.prototype.plural=function(t,e){return this._plural.unshift([t,e])},n.prototype.singular=function(t,e){return this._singular.unshift([t,e])},n.prototype.human=function(t,e){return this._human.unshift([t,e])},n.prototype.uncountable=function(){var e;return e=arguments.length>=1?t.call(arguments,0):[],this._uncountable=this._uncountable.concat(e.map(function(t){return RegExp(""+t+"$","i")}))},n.prototype.irregular=function(t,e){return t.charAt(0)===e.charAt(0)?(this.plural(RegExp("("+t.charAt(0)+")"+t.slice(1)+"$","i"),"$1"+e.slice(1)),this.plural(RegExp("("+t.charAt(0)+")"+e.slice(1)+"$","i"),"$1"+e.slice(1)),this.singular(RegExp("("+e.charAt(0)+")"+e.slice(1)+"$","i"),"$1"+t.slice(1))):(this.plural(RegExp(""+t+"$","i"),e),this.plural(RegExp(""+e+"$","i"),e),this.singular(RegExp(""+e+"$","i"),t))},n.prototype.ordinalize=function(t,n){var r,o;if(null==n&&(n=10),t=parseInt(t,n),r=Math.abs(t),o=r%100,e.call([11,12,13],o)>=0)return t+"th";switch(r%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd";default:return t+"th"}},n.prototype.pluralize=function(t){var e,n,r,o,i,a,s,u,c,p;for(u=this._uncountable,o=0,a=u.length;a>o;o++)if(r=u[o],r.test(t))return t;for(c=this._plural,i=0,s=c.length;s>i;i++)if(p=c[i],e=p[0],n=p[1],e.test(t))return t.replace(e,n);return t},n.prototype.singularize=function(t){var e,n,r,o,i,a,s,u,c,p;for(u=this._uncountable,o=0,a=u.length;a>o;o++)if(r=u[o],r.test(t))return t;for(c=this._singular,i=0,s=c.length;s>i;i++)if(p=c[i],e=p[0],n=p[1],e.test(t))return t.replace(e,n);return t},n.prototype.humanize=function(t){var e,n,r,o,i,a;for(i=this._human,r=0,o=i.length;o>r;r++)if(a=i[r],e=a[0],n=a[1],e.test(t))return t.replace(e,n);return t},n}()}.call(this),function(){var t,e,n,r,o,i,a,s;e=/(?:^|_|\-)(.)/g,n=/(^|\s)([a-z])/g,a=/([A-Z]+)([A-Z][a-z])/g,s=/([a-z\d])([A-Z])/g,r=/_id$/,o=/_|-/g,i=/^\w/g,Batman.helpers={ordinalize:function(){return Batman.helpers.inflector.ordinalize.apply(Batman.helpers.inflector,arguments)},singularize:function(){return Batman.helpers.inflector.singularize.apply(Batman.helpers.inflector,arguments)},pluralize:function(t,e,n,r){var o;return null==r&&(r=!0),2>arguments.length?Batman.helpers.inflector.pluralize(t):(o=1===+t?e:n||Batman.helpers.inflector.pluralize(e),r&&(o=""+(t||0)+" "+o),o)},camelize:function(t,n){return t=t.replace(e,function(t,e){return e.toUpperCase()}),n?t.substr(0,1).toLowerCase()+t.substr(1):t},underscore:function(t){return t.replace(a,"$1_$2").replace(s,"$1_$2").replace("-","_").toLowerCase()},capitalize:function(t){return t.replace(n,function(t,e,n){return e+n.toUpperCase()})},trim:function(t){return t?t.trim():""},interpolate:function(t,e){var n,r,o;"object"==typeof t?(r=t[e.count],r||(r=t.other)):r=t;for(n in e)o=e[n],r=r.replace(RegExp("%\\{"+n+"\\}","g"),o);return r},humanize:function(t){return t=Batman.helpers.underscore(t),t=Batman.helpers.inflector.humanize(t),t.replace(r,"").replace(o," ").replace(i,function(t){return t.toUpperCase()})}},t=new Batman.Inflector,Batman.helpers.inflector=t,t.plural(/$/,"s"),t.plural(/s$/i,"s"),t.plural(/(ax|test)is$/i,"$1es"),t.plural(/(octop|vir)us$/i,"$1i"),t.plural(/(octop|vir)i$/i,"$1i"),t.plural(/(alias|status)$/i,"$1es"),t.plural(/(bu)s$/i,"$1ses"),t.plural(/(buffal|tomat)o$/i,"$1oes"),t.plural(/([ti])um$/i,"$1a"),t.plural(/([ti])a$/i,"$1a"),t.plural(/sis$/i,"ses"),t.plural(/(?:([^f])fe|([lr])f)$/i,"$1$2ves"),t.plural(/(hive)$/i,"$1s"),t.plural(/([^aeiouy]|qu)y$/i,"$1ies"),t.plural(/(x|ch|ss|sh)$/i,"$1es"),t.plural(/(matr|vert|ind)(?:ix|ex)$/i,"$1ices"),t.plural(/([m|l])ouse$/i,"$1ice"),t.plural(/([m|l])ice$/i,"$1ice"),t.plural(/^(ox)$/i,"$1en"),t.plural(/^(oxen)$/i,"$1"),t.plural(/(quiz)$/i,"$1zes"),t.singular(/s$/i,""),t.singular(/(n)ews$/i,"$1ews"),t.singular(/([ti])a$/i,"$1um"),t.singular(/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$/i,"$1$2sis"),t.singular(/(^analy)ses$/i,"$1sis"),t.singular(/([^f])ves$/i,"$1fe"),t.singular(/(hive)s$/i,"$1"),t.singular(/(tive)s$/i,"$1"),t.singular(/([lr])ves$/i,"$1f"),t.singular(/([^aeiouy]|qu)ies$/i,"$1y"),t.singular(/(s)eries$/i,"$1eries"),t.singular(/(m)ovies$/i,"$1ovie"),t.singular(/(x|ch|ss|sh)es$/i,"$1"),t.singular(/([m|l])ice$/i,"$1ouse"),t.singular(/(bus)es$/i,"$1"),t.singular(/(o)es$/i,"$1"),t.singular(/(shoe)s$/i,"$1"),t.singular(/(cris|ax|test)es$/i,"$1is"),t.singular(/(octop|vir)i$/i,"$1us"),t.singular(/(alias|status)es$/i,"$1"),t.singular(/^(ox)en/i,"$1"),t.singular(/(vert|ind)ices$/i,"$1ex"),t.singular(/(matr)ices$/i,"$1ix"),t.singular(/(quiz)zes$/i,"$1"),t.singular(/(database)s$/i,"$1"),t.irregular("person","people"),t.irregular("man","men"),t.irregular("child","children"),t.irregular("sex","sexes"),t.irregular("move","moves"),t.irregular("cow","kine"),t.irregular("zombie","zombies"),t.uncountable("equipment","information","rice","money","species","series","fish","sheep","jeans")}.call(this),function(){var t;Batman.developer={suppressed:!1,DevelopmentError:function(){var t;return t=function(t){return this.message=t,this.name="DevelopmentError"},t.prototype=Error.prototype,t}(),_ie_console:function(t,e){var n,r,o,i;for(1!==e.length&&"undefined"!=typeof console&&null!==console&&console[t]("..."+t+" of "+e.length+" items..."),i=[],r=0,o=e.length;o>r;r++)n=e[r],i.push("undefined"!=typeof console&&null!==console?console[t](n):void 0);return i},suppress:function(e){return t.suppressed=!0,e?(e(),t.suppressed=!1):void 0},unsuppress:function(){return t.suppressed=!1},log:function(){return t.suppressed||null==("undefined"!=typeof console&&null!==console?console.log:void 0)?void 0:console.log.apply?console.log.apply(console,arguments):t._ie_console("log",arguments)},warn:function(){return t.suppressed||null==("undefined"!=typeof console&&null!==console?console.warn:void 0)?void 0:console.warn.apply?console.warn.apply(console,arguments):t._ie_console("warn",arguments)},error:function(e){throw new t.DevelopmentError(e)},assert:function(e,n){return e?void 0:t.error(n)},"do":function(e){return t.suppressed?void 0:e()},addFilters:function(){return Batman.extend(Batman.Filters,{log:function(t){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log&&console.log(arguments),t},logStack:function(e){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log&&console.log(t.currentFilterStack),e}})},deprecated:function(t,e){return Batman.developer.warn(""+t+" has been deprecated.",e||"")}},t=Batman.developer,Batman.developer.assert(function(){}.bind,"Error! Batman needs Function.bind to work! Please shim it using something like es5-shim or augmentjs!")}.call(this),function(){Batman.Event=function(){function t(t,e){this.base=t,this.key=e,this._preventCount=0}return t.forBaseAndKey=function(t,e){return t.isEventEmitter?t.event(e):new Batman.Event(t,e)},t.prototype.isEvent=!0,t.prototype.isEqual=function(t){return this.constructor===t.constructor&&this.base===t.base&&this.key===t.key},t.prototype.hashKey=function(){var t;return this.hashKey=function(){return t},t="<Batman.Event base: "+Batman.Hash.prototype.hashKeyFor(this.base)+', key: "'+Batman.Hash.prototype.hashKeyFor(this.key)+'">'},t.prototype.addHandler=function(t){return this.handlers||(this.handlers=[]),-1===this.handlers.indexOf(t)&&this.handlers.push(t),this.oneShot&&this.autofireHandler(t),this},t.prototype.removeHandler=function(t){var e;return this.handlers&&-1!==(e=this.handlers.indexOf(t))&&this.handlers.splice(e,1),this},t.prototype.eachHandler=function(t){var e,n,r,o,i,a,s,u,c,p,l,h,d;if(null!=(i=this.handlers)&&i.slice().forEach(t),null!=(a=this.base)?a.isEventEmitter:void 0){for(n=this.key,u=null!=(s=this.base._batman)?s.ancestors():void 0,d=[],r=0,o=u.length;o>r;r++)e=u[r],d.push(e.isEventEmitter&&(null!=(c=e._batman)?null!=(p=c.events)?p.hasOwnProperty(n):void 0:void 0)?null!=(l=e.event(n,!1))?null!=(h=l.handlers)?h.slice().forEach(t):void 0:void 0:void 0);return d}},t.prototype.clearHandlers=function(){return this.handlers=void 0},t.prototype.handlerContext=function(){return this.base},t.prototype.prevent=function(){return++this._preventCount},t.prototype.allow=function(){return this._preventCount&&--this._preventCount,this._preventCount},t.prototype.isPrevented=function(){return this._preventCount>0},t.prototype.autofireHandler=function(t){return this._oneShotFired&&null!=this._oneShotArgs?t.apply(this.handlerContext(),this._oneShotArgs):void 0},t.prototype.resetOneShot=function(){return this._oneShotFired=!1,this._oneShotArgs=null},t.prototype.fire=function(){return this.fireWithContext(this.handlerContext(),arguments)},t.prototype.fireWithContext=function(t,e){return this.isPrevented()||this._oneShotFired?!1:(this.oneShot&&(this._oneShotFired=!0,this._oneShotArgs=e),this.eachHandler(function(n){return n.apply(t,e)}))},t.prototype.allowAndFire=function(){return this.allowAndFireWithContext(this.handlerContext,arguments)},t.prototype.allowAndFireWithContext=function(t,e){return this.allow(),this.fireWithContext(t,e)},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.PropertyEvent=function(){function t(){t.__super__.constructor.apply(this,arguments)}return e(t,Batman.Event),t.prototype.eachHandler=function(t){return this.base.eachObserver(t)},t.prototype.handlerContext=function(){return this.base.base},t}()}.call(this),function(){var t=Array.prototype.slice;Batman.EventEmitter={isEventEmitter:!0,hasEvent:function(t){var e,n;return null!=(e=this._batman)?"function"==typeof e.get?null!=(n=e.get("events"))?n.hasOwnProperty(t):void 0:void 0:void 0},event:function(t,e){var n,r,o,i,a,s,u,c,p,l,h,d;if(null==e&&(e=!0),Batman.initializeObject(this),r=this.eventClass||Batman.Event,null!=(p=this._batman.events)?p.hasOwnProperty(t):void 0)return i=this._batman.events[t];for(l=this._batman.ancestors(),u=0,c=l.length;c>u&&(n=l[u],!(i=null!=(h=n._batman)?null!=(d=h.events)?d[t]:void 0:void 0));u++);return e||(null!=i?i.oneShot:void 0)?(o=(s=this._batman).events||(s.events={}),a=o[t]=new r(this,t),a.oneShot=null!=i?i.oneShot:void 0,a):i},on:function(){var e,n,r,o,i,a,s;for(r=arguments.length>=2?t.call(arguments,0,o=arguments.length-1):(o=0,[]),e=arguments[o++],s=[],i=0,a=r.length;a>i;i++)n=r[i],s.push(this.event(n).addHandler(e));return s},once:function(t,e){var n,r;return n=this.event(t),r=function(){return e.apply(this,arguments),n.removeHandler(r)},n.addHandler(r)},registerAsMutableSource:function(){return Batman.Property.registerSource(this)},mutation:function(t){return function(){var e,n;return e=t.apply(this,arguments),null!=(n=this.event("change",!1))&&n.fire(this,this),e}},prevent:function(t){return this.event(t).prevent(),this},allow:function(t){return this.event(t).allow(),this},isPrevented:function(t){var e;return null!=(e=this.event(t,!1))?e.isPrevented():void 0},fire:function(){var e,n,r;return n=arguments[0],e=arguments.length>=2?t.call(arguments,1):[],null!=(r=this.event(n,!1))?r.fireWithContext(this,e):void 0},allowAndFire:function(){var e,n,r;return n=arguments[0],e=arguments.length>=2?t.call(arguments,1):[],null!=(r=this.event(n,!1))?r.allowAndFireWithContext(this,e):void 0}}}.call(this),function(){var t=Array.prototype.slice;Batman.Enumerable={isEnumerable:!0,map:function(t,e){var n;return null==e&&(e=Batman.container),n=[],this.forEach(function(){return n.push(t.apply(e,arguments))}),n},mapToProperty:function(t){var e;return e=[],this.forEach(function(n){return e.push(n.get(t))}),e},every:function(t,e){var n;return null==e&&(e=Batman.container),n=!0,this.forEach(function(){return n=n&&t.apply(e,arguments)}),n},some:function(t,e){var n;return null==e&&(e=Batman.container),n=!1,this.forEach(function(){return n=n||t.apply(e,arguments)}),n},reduce:function(e,n){var r,o,i;return r=0,i=this,o=null!=n?!0:!1,this.forEach(function(){return o?n=e.apply(null,[n].concat(t.call(arguments),[r],[i])):(n=arguments[0],o=!0,void 0)}),n},filter:function(t){var e,n;return e=new this.constructor,e.add?n=function(e,n){return t(n)&&e.add(n),e}:e.set?n=function(e,n,r){return t(n,r)&&e.set(n,r),e}:(e.push||(e=[]),n=function(e,n){return t(n)&&e.push(n),e}),this.reduce(n,e)},inGroupsOf:function(t){var e,n,r;return r=[],e=!1,n=0,this.forEach(function(o){return 0===n++%t&&(e=[],r.push(e)),e.push(o)}),r}}}.call(this),function(){var t,e=Array.prototype.slice,n=function(t,e){return function(){return t.apply(e,arguments)}};t=Object.prototype.toString,Batman.SimpleHash=function(){function r(t){this._storage={},this.length=0,null!=t&&this.update(t)}return Batman.extend(r.prototype,Batman.Enumerable),r.prototype.hasKey=function(t){var e,n,r,o;if(this.objectKey(t)){if(!this._objectStorage)return!1;if(n=this._objectStorage[this.hashKeyFor(t)])for(r=0,o=n.length;o>r;r++)if(e=n[r],this.equality(e[0],t))return!0;return!1}return t=this.prefixedKey(t),this._storage.hasOwnProperty(t)},r.prototype.get=function(t){var e,n,r,o;if(!this.objectKey(t))return this._storage[this.prefixedKey(t)];if(this._objectStorage&&(n=this._objectStorage[this.hashKeyFor(t)]))for(r=0,o=n.length;o>r;r++)if(e=n[r],this.equality(e[0],t))return e[1]},r.prototype.set=function(t,e){var n,r,o,i,a,s;if(this.objectKey(t)){for(this._objectStorage||(this._objectStorage={}),r=(o=this._objectStorage)[s=this.hashKeyFor(t)]||(o[s]=[]),i=0,a=r.length;a>i;i++)if(n=r[i],this.equality(n[0],t))return n[1]=e;return this.length++,r.push([t,e]),e}return t=this.prefixedKey(t),null==this._storage[t]&&this.length++,this._storage[t]=e},r.prototype.unset=function(t){var e,n,r,o,i,a,s,u,c;if(!this.objectKey(t))return t=this.prefixedKey(t),a=this._storage[t],null!=this._storage[t]&&(this.length--,delete this._storage[t]),a;if(this._objectStorage&&(e=this.hashKeyFor(t),i=this._objectStorage[e]))for(n=0,u=i.length;u>n;n++)if(c=i[n],r=c[0],s=c[1],this.equality(r,t))return o=i.splice(n,1),i.length||delete this._objectStorage[e],this.length--,o[0][1]},r.prototype.getOrSet=function(t,e){var n;return n=this.get(t),n||(n=e(),this.set(t,n)),n},r.prototype.prefixedKey=function(t){return"_"+t},r.prototype.unprefixedKey=function(t){return t.slice(1)},r.prototype.hashKeyFor=function(e){var n,r;return(n=null!=e?"function"==typeof e.hashKey?e.hashKey():void 0:void 0)?n:(r=t.call(e),"[object Array]"===r?r:e)},r.prototype.equality=function(t,e){return t===e?!0:t!==t&&e!==e?!0:(null!=t?"function"==typeof t.isEqual?t.isEqual(e):void 0:void 0)&&(null!=e?"function"==typeof e.isEqual?e.isEqual(t):void 0:void 0)?!0:!1},r.prototype.objectKey=function(t){return"string"!=typeof t},r.prototype.forEach=function(t,e){var n,r,o,i,a,s,u,c,p,l,h;if(o=[],this._objectStorage){c=this._objectStorage;for(n in c)for(a=c[n],p=a.slice(),s=0,u=p.length;u>s;s++)l=p[s],r=l[0],i=l[1],o.push(t.call(e,r,i,this))}h=this._storage;for(n in h)i=h[n],o.push(t.call(e,this.unprefixedKey(n),i,this));return o},r.prototype.keys=function(){var t;return t=[],Batman.SimpleHash.prototype.forEach.call(this,function(e){return t.push(e)}),t},r.prototype.toArray=r.prototype.keys,r.prototype.clear=function(){return this._storage={},delete this._objectStorage,this.length=0},r.prototype.isEmpty=function(){return 0===this.length},r.prototype.merge=function(){var t,n,r,o,i;for(r=arguments.length>=1?e.call(arguments,0):[],n=new this.constructor,r.unshift(this),o=0,i=r.length;i>o;o++)t=r[o],t.forEach(function(t,e){return n.set(t,e)});return n},r.prototype.update=function(t){var e,n,r;r=[];for(e in t)n=t[e],r.push(this.set(e,n));return r},r.prototype.replace=function(t){return this.forEach(n(function(e){return e in t?void 0:this.unset(e)},this)),this.update(t)},r.prototype.toObject=function(){var t,e,n,r,o,i;e={},o=this._storage;for(t in o)r=o[t],e[this.unprefixedKey(t)]=r;if(this._objectStorage){i=this._objectStorage;for(t in i)n=i[t],e[t]=n[0][1]}return e},r.prototype.toJSON=r.prototype.toObject,r}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=Array.prototype.slice;Batman.AssociationCurator=function(){function t(e){this.model=e,t.__super__.constructor.call(this),this._byTypeStorage=new Batman.SimpleHash}return e(t,Batman.SimpleHash),t.availableAssociations=["belongsTo","hasOne","hasMany"],t.prototype.add=function(t){var e;return this.set(t.label,t),(e=this._byTypeStorage.get(t.associationType))||(e=new Batman.SimpleSet,this._byTypeStorage.set(t.associationType,e)),e.add(t)},t.prototype.getByType=function(t){return this._byTypeStorage.get(t)},t.prototype.getByLabel=function(t){return this.get(t)},t.prototype.reset=function(){return this.forEach(function(t,e){return e.reset()}),!0},t.prototype.merge=function(){var e,r;return e=arguments.length>=1?n.call(arguments,0):[],r=t.__super__.merge.apply(this,arguments),r._byTypeStorage=this._byTypeStorage.merge(e.map(function(t){return t._byTypeStorage})),r},t.prototype._markDirtyAttribute=function(t,e){var n;if("loading"!==(n=this.lifecycle.get("state"))&&"creating"!==n&&"saving"!==n&&"saved"!==n){if(this.lifecycle.startTransition("set"))return this.dirtyKeys.set(t,e);throw new Batman.StateMachine.InvalidTransitionError("Can't set while in state "+this.lifecycle.get("state"))}},t}()}.call(this),function(){var t=Array.prototype.slice;Batman.SimpleSet=function(){function e(){var t,e;this._storage=[],this.length=0,e=function(){var e,n,r;for(r=[],e=0,n=arguments.length;n>e;e++)t=arguments[e],null!=t&&r.push(t);return r}.apply(this,arguments),e.length>0&&this.add.apply(this,e)}return Batman.extend(e.prototype,Batman.Enumerable),e.prototype.has=function(t){return!!~this._indexOfItem(t)},e.prototype.add=function(){var e,n,r,o,i;for(r=arguments.length>=1?t.call(arguments,0):[],e=[],o=0,i=r.length;i>o;o++)n=r[o],~this._indexOfItem(n)||(this._storage.push(n),e.push(n));return this.length=this._storage.length,this.fire&&0!==e.length&&(this.fire("change",this,this),this.fire.apply(this,["itemsWereAdded"].concat(t.call(e)))),e},e.prototype.remove=function(){var e,n,r,o,i,a;for(r=arguments.length>=1?t.call(arguments,0):[],o=[],i=0,a=r.length;a>i;i++)n=r[i],~(e=this._indexOfItem(n))&&(this._storage.splice(e,1),o.push(n));return this.length=this._storage.length,this.fire&&0!==o.length&&(this.fire("change",this,this),this.fire.apply(this,["itemsWereRemoved"].concat(t.call(o)))),o},e.prototype.find=function(t){var e,n,r,o;for(o=this._storage,n=0,r=o.length;r>n;n++)if(e=o[n],t(e))return e},e.prototype.forEach=function(t,e){var n,r,o,i,a;for(i=this._storage,a=[],r=0,o=i.length;o>r;r++)n=i[r],a.push(t.call(e,n,null,this));return a},e.prototype.isEmpty=function(){return 0===this.length},e.prototype.clear=function(){var e;return e=this._storage,this._storage=[],this.length=0,this.fire&&0!==e.length&&(this.fire("change",this,this),this.fire.apply(this,["itemsWereRemoved"].concat(t.call(e)))),e},e.prototype.replace=function(t){try{return"function"==typeof this.prevent&&this.prevent("change"),this.clear(),this.add.apply(this,t.toArray())}finally{"function"==typeof this.allowAndFire&&this.allowAndFire("change",this,this)}},e.prototype.toArray=function(){return this._storage.slice()},e.prototype.merge=function(){var e,n,r,o,i;for(n=arguments.length>=1?t.call(arguments,0):[],e=new this.constructor,n.unshift(this),o=0,i=n.length;i>o;o++)r=n[o],r.forEach(function(t){return e.add(t)});return e},e.prototype.indexedBy=function(t){return this._indexes||(this._indexes=new Batman.SimpleHash),this._indexes.get(t)||this._indexes.set(t,new Batman.SetIndex(this,t))},e.prototype.indexedByUnique=function(t){return this._uniqueIndexes||(this._uniqueIndexes=new Batman.SimpleHash),this._uniqueIndexes.get(t)||this._uniqueIndexes.set(t,new Batman.UniqueSetIndex(this,t))},e.prototype.sortedBy=function(t,e){var n;return null==e&&(e="asc"),e="desc"===e.toLowerCase()?"desc":"asc",this._sorts||(this._sorts=new Batman.SimpleHash),n=this._sorts.get(t)||this._sorts.set(t,new Batman.Object),n.get(e)||n.set(e,new Batman.SetSort(this,t,e))},e.prototype.equality=Batman.SimpleHash.prototype.equality,e.prototype._indexOfItem=function(t){var e,n,r,o;for(o=this._storage,e=0,r=o.length;r>e;e++)if(n=o[e],this.equality(t,n))return e;return-1},e}()}.call(this),function(){var t,e,n=function(t,e){return function(){return t.apply(e,arguments)}},r=Array.prototype.slice;t=[],e=!0,Batman.Property=function(){function o(t,e){this.base=t,this.key=e}return Batman.mixin(o.prototype,Batman.EventEmitter),o._sourceTrackerStack=t,o._sourceTrackerStackValid=e,o.defaultAccessor={get:function(t){return this[t]},set:function(t,e){return this[t]=e},unset:function(t){var e;return e=this[t],delete this[t],e},cache:!1},o.defaultAccessorForBase=function(t){var e;return(null!=(e=t._batman)?e.getFirst("defaultAccessor"):void 0)||Batman.Property.defaultAccessor},o.accessorForBaseAndKey=function(t,e){var n,r,o,i,a,s,u,c,p;if(null!=(o=t._batman)&&(n=null!=(s=o.keyAccessors)?s.get(e):void 0,!n))for(u=o.ancestors(),i=0,a=u.length;a>i&&(r=u[i],!(n=null!=(c=r._batman)?null!=(p=c.keyAccessors)?p.get(e):void 0:void 0));i++);return n||this.defaultAccessorForBase(t)},o.forBaseAndKey=function(t,e){return t.isObservable?t.property(e):new Batman.Keypath(t,e)},o.withoutTracking=function(t){return this.wrapTrackingPrevention(t)()},o.wrapTrackingPrevention=function(t){return function(){Batman.Property.pushDummySourceTracker();try{return t.apply(this,arguments)}finally{Batman.Property.popSourceTracker()}}},o.registerSource=function(n){var r;n.isEventEmitter&&(e?r=t[t.length-1]:(r=[],t.push(r),e=!0),null!=r&&r.push(n))},o.pushSourceTracker=function(){return e?e=!1:t.push([])},o.popSourceTracker=function(){return e?t.pop():(e=!0,void 0)},o.pushDummySourceTracker=function(){return e||(t.push([]),e=!0),t.push(null)},o.prototype._isolationCount=0,o.prototype.cached=!1,o.prototype.value=null,o.prototype.sources=null,o.prototype.isProperty=!0,o.prototype.isDead=!1,o.prototype.eventClass=Batman.PropertyEvent,o.prototype.isEqual=function(t){return this.constructor===t.constructor&&this.base===t.base&&this.key===t.key},o.prototype.hashKey=function(){return this._hashKey||(this._hashKey="<Batman.Property base: "+Batman.Hash.prototype.hashKeyFor(this.base)+', key: "'+Batman.Hash.prototype.hashKeyFor(this.key)+'">')},o.prototype.event=function(t){var e,n;return e=this.eventClass||Batman.Event,this.events||(this.events={}),(n=this.events)[t]||(n[t]=new e(this,t)),this.events[t]},o.prototype.changeEvent=function(){return this._changeEvent||(this._changeEvent=this.event("change"))},o.prototype.accessor=function(){return this._accessor||(this._accessor=this.constructor.accessorForBaseAndKey(this.base,this.key))},o.prototype.eachObserver=function(t){var e,n,r,o,i,a,s,u,c,p,l,h;if(r=this.key,n=null!=(p=this.changeEvent().handlers)?p.slice():void 0)for(a=0,u=n.length;u>a;a++)o=n[a],t(o);if(this.base.isObservable){for(l=this.base._batman.ancestors(),h=[],s=0,c=l.length;c>s;s++)e=l[s],h.push(function(){var a,s,u,c;if(e.isObservable&&e.hasProperty(r)&&(i=e.property(r),n=null!=(u=i.changeEvent().handlers)?u.slice():void 0)){for(c=[],a=0,s=n.length;s>a;a++)o=n[a],c.push(t(o));return c}}());return h}},o.prototype.observers=function(){var t;return t=[],this.eachObserver(function(e){return t.push(e)}),t},o.prototype.hasObservers=function(){return this.observers().length>0},o.prototype.updateSourcesFromTracker=function(){var t,e,n,r,o,i,a,s,u,c;if(e=this.constructor.popSourceTracker(),t=this.sourceChangeHandler(),this.sources)for(s=this.sources,r=0,i=s.length;i>r;r++)n=s[r],null!=n&&n.event("change").removeHandler(t);if(this.sources=e,this.sources){for(u=this.sources,c=[],o=0,a=u.length;a>o;o++)n=u[o],c.push(null!=n?n.event("change").addHandler(t):void 0);return c}},o.prototype.getValue=function(){if(this.registerAsMutableSource(),!this.isCached()){this.constructor.pushSourceTracker();try{this.value=this.valueFromAccessor(),this.cached=!0}finally{this.updateSourcesFromTracker()}}return this.value},o.prototype.isCachable=function(){var t;return this.isFinal()?!0:(t=this.accessor().cache,null!=t?!!t:!0)},o.prototype.isCached=function(){return this.isCachable()&&this.cached},o.prototype.isFinal=function(){return!!this.accessor()["final"]},o.prototype.refresh=function(){var t,e;return this.cached=!1,t=this.value,e=this.getValue(),e===t||this.isIsolated()||this.fire(e,t),void 0!==this.value&&this.isFinal()?this.lockValue():void 0},o.prototype.sourceChangeHandler=function(){return this._sourceChangeHandler||(this._sourceChangeHandler=this._handleSourceChange.bind(this)),Batman.developer["do"](n(function(){return this._sourceChangeHandler.property=this
},this)),this._sourceChangeHandler},o.prototype._handleSourceChange=function(){return this.isIsolated()?this._needsRefresh=!0:this.isFinal()||this.hasObservers()?this.refresh():this.cached=!1},o.prototype.valueFromAccessor=function(){var t;return null!=(t=this.accessor().get)?t.call(this.base,this.key):void 0},o.prototype.setValue=function(t){var e;if(e=this.accessor().set)return this._changeValue(function(){return e.call(this.base,this.key,t)})},o.prototype.unsetValue=function(){var t;if(t=this.accessor().unset)return this._changeValue(function(){return t.call(this.base,this.key)})},o.prototype._changeValue=function(t){var e;this.cached=!1,this.constructor.pushDummySourceTracker();try{e=t.apply(this),this.refresh()}finally{this.constructor.popSourceTracker()}return this.isCached()||this.hasObservers()||this.die(),e},o.prototype.forget=function(t){return null!=t?this.changeEvent().removeHandler(t):this.changeEvent().clearHandlers()},o.prototype.observeAndFire=function(t){return this.observe(t),t.call(this.base,this.value,this.value,this.key)},o.prototype.observe=function(t){return this.changeEvent().addHandler(t),null==this.sources&&this.getValue(),this},o.prototype.observeOnce=function(t){var e,n;return e=this.changeEvent(),n=function(){return t.apply(this,arguments),e.removeHandler(n)},e.addHandler(n),null==this.sources&&this.getValue(),this},o.prototype._removeHandlers=function(){var t,e,n,r,o;if(t=this.sourceChangeHandler(),this.sources)for(o=this.sources,n=0,r=o.length;r>n;n++)e=o[n],e.event("change").removeHandler(t);return delete this.sources,this.changeEvent().clearHandlers()},o.prototype.lockValue=function(){return this._removeHandlers(),this.getValue=function(){return this.value},this.setValue=this.unsetValue=this.refresh=this.observe=function(){}},o.prototype.die=function(){var t,e;return this._removeHandlers(),null!=(t=this.base._batman)&&null!=(e=t.properties)&&e.unset(this.key),this.isDead=!0},o.prototype.fire=function(){var t;return(t=this.changeEvent()).fire.apply(t,r.call(arguments).concat([this.key]))},o.prototype.isolate=function(){return 0===this._isolationCount&&(this._preIsolationValue=this.getValue()),this._isolationCount++},o.prototype.expose=function(){return 1===this._isolationCount?(this._isolationCount--,this._needsRefresh?(this.value=this._preIsolationValue,this.refresh()):this.value!==this._preIsolationValue&&this.fire(this.value,this._preIsolationValue),this._preIsolationValue=null):this._isolationCount>0?this._isolationCount--:void 0},o.prototype.isIsolated=function(){return this._isolationCount>0},o}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.Keypath=function(){function t(e,n){"string"==typeof n?(this.segments=n.split("."),this.depth=this.segments.length):(this.segments=[n],this.depth=1),t.__super__.constructor.apply(this,arguments)}return e(t,Batman.Property),t.prototype.isCachable=function(){return 1===this.depth?t.__super__.isCachable.apply(this,arguments):!0},t.prototype.terminalProperty=function(){var t;return t=Batman.getPath(this.base,this.segments.slice(0,-1)),null!=t?Batman.Keypath.forBaseAndKey(t,this.segments[this.depth-1]):void 0},t.prototype.valueFromAccessor=function(){return 1===this.depth?t.__super__.valueFromAccessor.apply(this,arguments):Batman.getPath(this.base,this.segments)},t.prototype.setValue=function(e){var n;return 1===this.depth?t.__super__.setValue.apply(this,arguments):null!=(n=this.terminalProperty())?n.setValue(e):void 0},t.prototype.unsetValue=function(){var e;return 1===this.depth?t.__super__.unsetValue.apply(this,arguments):null!=(e=this.terminalProperty())?e.unsetValue():void 0},t}()}.call(this),function(){var t=Array.prototype.slice;Batman.Observable={isObservable:!0,hasProperty:function(t){var e,n;return null!=(e=this._batman)?null!=(n=e.properties)?"function"==typeof n.hasKey?n.hasKey(t):void 0:void 0:void 0},property:function(t){var e,n,r;return Batman.initializeObject(this),n=this.propertyClass||Batman.Keypath,e=(r=this._batman).properties||(r.properties=new Batman.SimpleHash),e.get(t)||e.set(t,new n(this,t))},get:function(t){return this.property(t).getValue()},set:function(t,e){return this.property(t).setValue(e)},unset:function(t){return this.property(t).unsetValue()},getOrSet:Batman.SimpleHash.prototype.getOrSet,forget:function(t,e){var n;return t?this.property(t).forget(e):null!=(n=this._batman.properties)&&n.forEach(function(t,e){return e.forget()}),this},observe:function(){var e,n,r;return n=arguments[0],e=arguments.length>=2?t.call(arguments,1):[],(r=this.property(n)).observe.apply(r,e),this},observeAndFire:function(){var e,n,r;return n=arguments[0],e=arguments.length>=2?t.call(arguments,1):[],(r=this.property(n)).observeAndFire.apply(r,e),this},observeOnce:function(){var e,n,r;return n=arguments[0],e=arguments.length>=2?t.call(arguments,1):[],(r=this.property(n)).observeOnce.apply(r,e),this}}}.call(this),function(){Batman.DOM={textInputTypes:["text","search","tel","url","email","password"],scrollIntoView:function(t){var e;return null!=(e=document.getElementById(t))?"function"==typeof e.scrollIntoView?e.scrollIntoView():void 0:void 0},partial:function(t,e,n,r){var o;return r.prevent("rendered"),o=new Batman.View({source:e,context:n}),o.on("ready",function(){return Batman.DOM.setInnerHTML(t,""),Batman.DOM.appendChild(t,o.get("node")),r.allowAndFire("rendered")})},propagateBindingEvent:function(t,e){for(var n,r,o,i,a;n=(n||e).parentNode;)if(o=Batman._data(n,"bindings"),null!=o)for(i=0,a=o.length;a>i;i++)r=o[i],"function"==typeof r.childBindingAdded&&r.childBindingAdded(t)},propagateBindingEvents:function(t){var e,n,r,o,i,a,s,u;for(u=t.childNodes,o=0,a=u.length;a>o;o++)r=u[o],Batman.DOM.propagateBindingEvents(r);if(n=Batman._data(t,"bindings"))for(i=0,s=n.length;s>i;i++)e=n[i],Batman.DOM.propagateBindingEvent(e,t)},trackBinding:function(t,e){var n;return(n=Batman._data(e,"bindings"))?n.push(t):Batman._data(e,"bindings",[t]),Batman.DOM.fire("bindingAdded",t),Batman.DOM.propagateBindingEvent(t,e),!0},onParseExit:function(t,e){var n;return n=Batman._data(t,"onParseExit")||Batman._data(t,"onParseExit",new Batman.SimpleSet),null!=e&&n.add(e),n},forgetParseExit:function(t){return Batman.removeData(t,"onParseExit",!0)},defineView:function(t,e){var n;return n=e.innerHTML,Batman.View.store.set(Batman.Navigator.normalizePath(t),n),n},setStyleProperty:function(t,e,n,r){return t.style.setProperty?t.style.setProperty(e,n,r):t.style.setAttribute(e,n,r)},removeOrDestroyNode:function(t){var e;return e=Batman._data(t,"view"),e||(e=Batman._data(t,"yielder")),null!=e&&e.get("cached")?Batman.DOM.removeNode(t):Batman.DOM.destroyNode(t)},insertBefore:function(t,e,n){return null==n&&(n=null),!n||0>=t.childNodes.length?Batman.DOM.appendChild(t,e):(Batman.DOM.willInsertNode(e),t.insertBefore(e,n),Batman.DOM.didInsertNode(e))},valueForNode:function(t,e,n){var r,o,i,a,s,u,c;switch(null==e&&(e=""),null==n&&(n=!0),o=arguments.length>1,i=t.nodeName.toUpperCase()){case"INPUT":case"TEXTAREA":return o?t.value=e:t.value;case"SELECT":if(o)return t.value=e;if(t.multiple){for(u=t.children,c=[],a=0,s=u.length;s>a;a++)r=u[a],r.selected&&c.push(r.value);return c}return t.value;default:return o?("OPTION"===i&&(t.text=e),Batman.DOM.setInnerHTML(t,n?Batman.escapeHTML(e):e)):t.innerHTML}},nodeIsEditable:function(t){var e;return"INPUT"===(e=t.nodeName.toUpperCase())||"TEXTAREA"===e||"SELECT"===e},addEventListener:function(t,e,n){var r;return(r=Batman._data(t,"listeners"))||(r=Batman._data(t,"listeners",{})),r[e]||(r[e]=[]),r[e].push(n),Batman.DOM.hasAddEventListener?t.addEventListener(e,n,!1):t.attachEvent("on"+e,n)},removeEventListener:function(t,e,n){var r,o,i;return(i=Batman._data(t,"listeners"))&&(r=i[e])&&(o=r.indexOf(n),-1!==o&&r.splice(o,1)),Batman.DOM.hasAddEventListener?t.removeEventListener(e,n,!1):t.detachEvent("on"+e,n)},hasAddEventListener:!!("undefined"!=typeof window&&null!==window?window.addEventListener:void 0),preventDefault:function(t){return"function"==typeof t.preventDefault?t.preventDefault():t.returnValue=!1},stopPropagation:function(t){return t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},willInsertNode:function(t){var e,n,r,o,i,a;for(n=Batman._data(t,"view"),null!=n&&n.fire("beforeAppear",t),null!=(i=Batman.data(t,"show"))&&i.call(t),a=t.childNodes,r=0,o=a.length;o>r;r++)e=a[r],Batman.DOM.willInsertNode(e);return!0},didInsertNode:function(t){var e,n,r,o,i;for(n=Batman._data(t,"view"),n&&(n.fire("appear",t),n.applyYields()),i=t.childNodes,r=0,o=i.length;o>r;r++)e=i[r],Batman.DOM.didInsertNode(e);return!0},willRemoveNode:function(t){var e,n,r,o,i,a;for(n=Batman._data(t,"view"),n&&n.fire("beforeDisappear",t),null!=(i=Batman.data(t,"hide"))&&i.call(t),a=t.childNodes,r=0,o=a.length;o>r;r++)e=a[r],Batman.DOM.willRemoveNode(e);return!0},didRemoveNode:function(t){var e,n,r,o,i;for(n=Batman._data(t,"view"),n&&(n.retractYields(),n.fire("disappear",t)),i=t.childNodes,r=0,o=i.length;o>r;r++)e=i[r],Batman.DOM.didRemoveNode(e);return!0},willDestroyNode:function(t){var e,n,r,o,i;for(n=Batman._data(t,"view"),n&&(n.fire("beforeDestroy",t),n.get("yields").forEach(function(e,n){var r,o,i;for(i=[],r=0,o=n.length;o>r;r++)t=n[r].node,i.push(Batman.DOM.willDestroyNode(t));return i})),i=t.childNodes,r=0,o=i.length;o>r;r++)e=i[r],Batman.DOM.willDestroyNode(e);return!0},didDestroyNode:function(t){var e,n,r,o,i,a,s,u,c;if(a=Batman._data(t,"view"),a&&a.die(),(e=Batman._data(t,"bindings"))&&e.forEach(function(t){return t.die()}),i=Batman._data(t,"listeners"))for(o in i)r=i[o],r.forEach(function(e){return Batman.DOM.removeEventListener(t,o,e)});for(Batman.removeData(t),Batman.removeData(t,void 0,!0),c=t.childNodes,s=0,u=c.length;u>s;s++)n=c[s],Batman.DOM.didDestroyNode(n);return!0}},Batman.mixin(Batman.DOM,Batman.EventEmitter,Batman.Observable),Batman.DOM.event("bindingAdded")}.call(this),function(){Batman.DOM.ReaderBindingDefinition=function(){function t(t,e,n,r){this.node=t,this.keyPath=e,this.context=n,this.renderer=r}return t}(),Batman.BindingDefinitionOnlyObserve={Data:"data",Node:"node",All:"all",None:"none"},Batman.DOM.readers={target:function(t){return t.onlyObserve=Batman.BindingDefinitionOnlyObserve.Node,Batman.DOM.readers.bind(t)},source:function(t){return t.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,Batman.DOM.readers.bind(t)},bind:function(t){var e,n;switch(n=t.node,n.nodeName.toLowerCase()){case"input":switch(n.getAttribute("type")){case"checkbox":return t.attr="checked",Batman.DOM.attrReaders.bind(t),!0;case"radio":e=Batman.DOM.RadioBinding;break;case"file":e=Batman.DOM.FileBinding}break;case"select":e=Batman.DOM.SelectBinding}return e||(e=Batman.DOM.ValueBinding),new e(t)},context:function(t){return t.context.descendWithDefinition(t)},mixin:function(t){return t.context=t.context.descend(Batman.mixins),new Batman.DOM.MixinBinding(t)},showif:function(t){return new Batman.DOM.ShowHideBinding(t)},hideif:function(t){return t.invert=!0,new Batman.DOM.ShowHideBinding(t)},insertif:function(t){return new Batman.DOM.InsertionBinding(t)},removeif:function(t){return t.invert=!0,new Batman.DOM.InsertionBinding(t)},route:function(t){return new Batman.DOM.RouteBinding(t)},view:function(t){return new Batman.DOM.ViewBinding(t)},partial:function(t){return Batman.DOM.partial(t.node,t.keyPath,t.context,t.renderer)},defineview:function(t){var e;return e=t.node,Batman.DOM.onParseExit(e,function(){var t;return null!=(t=e.parentNode)?t.removeChild(e):void 0}),Batman.DOM.defineView(t.keyPath,e),{skipChildren:!0}},renderif:function(t){return new Batman.DOM.DeferredRenderingBinding(t)},yield:function(t){var e,n;return n=t.node,e=t.keyPath,Batman.DOM.onParseExit(n,function(){return Batman.DOM.Yield.withName(e).set("containerNode",n)})},contentfor:function(t){var e,n,r,o,i;return n=t.node,i=t.value,o=t.swapMethod,r=t.renderer,e=t.keyPath,o||(o="append"),Batman.DOM.onParseExit(n,function(){var t;return null!=(t=n.parentNode)&&t.removeChild(n),r.view.pushYieldAction(e,o,n)})},replace:function(t){return t.swapMethod="replace",Batman.DOM.readers.contentfor(t)}}}.call(this),function(){var t=Array.prototype.slice,e=Array.prototype.indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(this[e]===t)return e;return-1};Batman.DOM.events={click:function(e,n,r,o){return null==o&&(o="click"),Batman.DOM.addEventListener(e,o,function(){var i,a;return a=arguments[0],i=arguments.length>=2?t.call(arguments,1):[],a.metaKey||a.ctrlKey||1===a.button||(Batman.DOM.preventDefault(a),!Batman.DOM.eventIsAllowed(o,a))?void 0:n.apply(null,[e,a].concat(t.call(i),[r]))}),"A"!==e.nodeName.toUpperCase()||e.href||(e.href="#"),e},doubleclick:function(t,e,n){return Batman.DOM.events.click(t,e,n,"dblclick")},change:function(n,r,o){var i,a,s,u,c,p;for(a=function(){var t;switch(n.nodeName.toUpperCase()){case"TEXTAREA":return["input","keyup","change"];case"INPUT":return t=n.type.toLowerCase(),e.call(Batman.DOM.textInputTypes,t)>=0?(s=r,r=function(t,e){return"keyup"===e.type&&Batman.DOM.events.isEnter(e)?void 0:s(t,e)},["input","keyup","change"]):["input","change"];default:return["change"]}}(),p=[],u=0,c=a.length;c>u;u++)i=a[u],p.push(Batman.DOM.addEventListener(n,i,function(){var e;return e=arguments.length>=1?t.call(arguments,0):[],r.apply(null,[n].concat(t.call(e),[o]))}));return p},isEnter:function(t){var e,n;return(e=t.keyCode)>=13&&14>=e||(n=t.which)>=13&&14>=n||"Enter"===t.keyIdentifier||"Enter"===t.key},submit:function(e,n,r){return Batman.DOM.nodeIsEditable(e)?(Batman.DOM.addEventListener(e,"keydown",function(){var n;return n=arguments.length>=1?t.call(arguments,0):[],Batman.DOM.events.isEnter(n[0])?Batman.DOM._keyCapturingNode=e:void 0}),Batman.DOM.addEventListener(e,"keyup",function(){var o;return o=arguments.length>=1?t.call(arguments,0):[],Batman.DOM.events.isEnter(o[0])?(Batman.DOM._keyCapturingNode===e&&(Batman.DOM.preventDefault(o[0]),n.apply(null,[e].concat(t.call(o),[r]))),Batman.DOM._keyCapturingNode=null):void 0})):Batman.DOM.addEventListener(e,"submit",function(){var o;return o=arguments.length>=1?t.call(arguments,0):[],Batman.DOM.preventDefault(o[0]),n.apply(null,[e].concat(t.call(o),[r]))}),e},other:function(e,n,r,o){return Batman.DOM.addEventListener(e,n,function(){var n;return n=arguments.length>=1?t.call(arguments,0):[],r.apply(null,[e].concat(t.call(n),[o]))})}},Batman.DOM.eventIsAllowed=function(t,e){var n,r,o;return(n=null!=(r=Batman.currentApp)?null!=(o=r.shouldAllowEvent)?o[t]:void 0:void 0)&&n(e)===!1?!1:!0}}.call(this),function(){Batman.DOM.AttrReaderBindingDefinition=function(){function t(t,e,n,r,o){this.node=t,this.attr=e,this.keyPath=n,this.context=r,this.renderer=o}return t}(),Batman.DOM.attrReaders={_parseAttribute:function(t){return"false"===t&&(t=!1),"true"===t&&(t=!0),t},source:function(t){return t.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,Batman.DOM.attrReaders.bind(t)},bind:function(t){var e;return e=function(){switch(t.attr){case"checked":case"disabled":case"selected":return Batman.DOM.CheckedBinding;case"value":case"href":case"src":case"size":return Batman.DOM.NodeAttributeBinding;case"class":return Batman.DOM.ClassBinding;case"style":return Batman.DOM.StyleBinding;default:return Batman.DOM.AttributeBinding}}(),new e(t)},context:function(t){return t.context.descendWithDefinition(t)},event:function(t){return new Batman.DOM.EventBinding(t)},addclass:function(t){return new Batman.DOM.AddClassBinding(t)},removeclass:function(t){return t.invert=!0,new Batman.DOM.AddClassBinding(t)},foreach:function(t){return new Batman.DOM.IteratorBinding(t)},formfor:function(t){return new Batman.DOM.FormBinding(t),t.context.descendWithDefinition(t)}}}.call(this),function(){var t,e,n,r,o,i=function(t,e){return function(){return t.apply(e,arguments)}},a=Array.prototype.slice,s=Object.prototype.hasOwnProperty,u=function(t,e){function n(){this.constructor=t}for(var r in e)s.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=function(t,e){var n,r,o,i;for("function"==typeof e&&(e={get:e}),i=["cachable","cacheable"],r=0,o=i.length;o>r;r++)n=i[r],n in e&&(Batman.developer.warn('Property accessor option "'+n+'" is deprecated. Use "cache" instead.'),"cache"in e||(e.cache=e[n]));return e},r=function(t){return function(e){return{get:function(n){var r,o,a,s,u,c,p;return null!=(o=e.get.apply(this,arguments))?o:(r=!1,a=void 0,null==(c=(s=this._batman).promises)&&(s.promises={}),null==(p=(u=this._batman.promises)[n])&&(u[n]=i(function(){var e,o;return e=i(function(t,e){return r&&this.set(n,e),a=e},this),o=t.call(this,e,n),null==a&&(a=o),!0},this)()),r=!0,a)},cache:!0}}},o=function(t,e){var n,r;e=("function"==typeof e?e(t):void 0)||e;for(n in t)r=t[n],n in e||(e[n]=r);return e},e={_defineAccessor:function(){var t,e,o,i,s,u,c,p,l;if(o=arguments.length>=2?a.call(arguments,0,s=arguments.length-1):(s=0,[]),t=arguments[s++],null==t)return Batman.Property.defaultAccessorForBase(this);if(0===o.length&&"Object"!==(p=Batman.typeOf(t))&&"Function"!==p)return Batman.Property.accessorForBaseAndKey(this,t);if("function"==typeof t.promise)return this._defineWrapAccessor.apply(this,a.call(o).concat([r(t.promise)]));if(Batman.initializeObject(this),0===o.length)return this._batman.defaultAccessor=n(this,t);for((i=this._batman).keyAccessors||(i.keyAccessors=new Batman.SimpleHash),l=[],u=0,c=o.length;c>u;u++)e=o[u],l.push(this._batman.keyAccessors.set(e,n(this,t)));return l},_defineWrapAccessor:function(){var t,e,n,r,i,s,u;if(e=arguments.length>=2?a.call(arguments,0,r=arguments.length-1):(r=0,[]),n=arguments[r++],Batman.initializeObject(this),0===e.length)return this._defineAccessor(o(this._defineAccessor(),n));for(u=[],i=0,s=e.length;s>i;i++)t=e[i],u.push(this._defineAccessor(t,o(this._defineAccessor(t),n)));return u},_resetPromises:function(){var t;if(null!=this._batman.promises)for(t in this._batman.promises)this._resetPromise(t)},_resetPromise:function(t){this.unset(t),this.property(t).cached=!1,delete this._batman.promises[t]}},t=function(){function t(){var t;t=arguments.length>=1?a.call(arguments,0):[],this._batman=new Batman._Batman(this),this.mixin.apply(this,t)}var n;return u(t,Object),Batman.initializeObject(t),Batman.initializeObject(t.prototype),Batman.mixin(t.prototype,e,Batman.EventEmitter,Batman.Observable),Batman.mixin(t,e,Batman.EventEmitter,Batman.Observable),t.classMixin=function(){return Batman.mixin.apply(Batman,[this].concat(a.call(arguments)))},t.mixin=function(){return this.classMixin.apply(this.prototype,arguments)},t.prototype.mixin=t.classMixin,t.classAccessor=t._defineAccessor,t.accessor=function(){var t;return(t=this.prototype)._defineAccessor.apply(t,arguments)},t.prototype.accessor=t._defineAccessor,t.wrapClassAccessor=t._defineWrapAccessor,t.wrapAccessor=function(){var t;return(t=this.prototype)._defineWrapAccessor.apply(t,arguments)},t.prototype.wrapAccessor=t._defineWrapAccessor,t.observeAll=function(){return this.prototype.observe.apply(this.prototype,arguments)},t.singleton=function(t){return null==t&&(t="sharedInstance"),this.classAccessor(t,{get:function(){var e;return this[e="_"+t]||(this[e]=new this)}})},t.accessor("_batmanID",function(){return this._batmanID()}),n=0,t.prototype._batmanID=function(){var t,e;return this._batman.check(this),null==(e=(t=this._batman).id)&&(t.id=n++),this._batman.id},t.prototype.hashKey=function(){var t;if("function"!=typeof this.isEqual)return(t=this._batman).hashKey||(t.hashKey="<Batman.Object "+this._batmanID()+">")},t.prototype.toJSON=function(){var t,e,n;e={};for(t in this)s.call(this,t)&&(n=this[t],"_batman"!==t&&"hashKey"!==t&&"_batmanID"!==t&&(e[t]=(null!=n?n.toJSON:void 0)?n.toJSON():n));return e},t}(),Batman.Object=t}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=Object.prototype.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.Renderer=function(){function e(n,r,o){this.node=n,this.context=r,this.view=o,this.resume=t(this.resume,this),this.start=t(this.start,this),e.__super__.constructor.call(this),this.context instanceof Batman.RenderContext||Batman.developer.error("Must pass a RenderContext to a renderer for rendering"),this.immediate=Batman.setImmediate(this.start)}var r,o,i,a,s,u,c,p,l,h;for(n(e,Batman.Object),e.prototype.deferEvery=50,e.prototype.start=function(){return this.startTime=new Date,this.prevent("parsed"),this.prevent("rendered"),this.parseNode(this.node)},e.prototype.resume=function(){return this.startTime=new Date,this.parseNode(this.resumeNode)},e.prototype.finish=function(){return this.startTime=null,this.prevent("stopped"),this.allowAndFire("parsed"),this.allowAndFire("rendered")},e.prototype.stop=function(){return Batman.clearImmediate(this.immediate),this.fire("stopped")},h=["parsed","rendered","stopped"],c=0,p=h.length;p>c;c++)a=h[c],e.prototype.event(a).oneShot=!0;for(r=/^data\-(.*)/,o=["view","renderif","foreach","formfor","context","bind","source","target"],i={},u=0,l=o.length;l>u;u++)s=o[u],i[s]=u;return e.prototype._sortBindings=function(t,e){var n,r;return n=i[t[0]],r=i[e[0]],null==n&&(n=o.length),null==r&&(r=o.length),n>r?1:r>n?-1:t[0]>e[0]?1:e[0]>t[0]?-1:0},e.prototype.parseNode=function(e){var n,o,i,a,u,c,p,l,h,d,f,y,m,g,v,_,B,b,O;if(this.deferEvery&&new Date-this.startTime>this.deferEvery)return this.resumeNode=e,this.timeout=Batman.setImmediate(this.resume),void 0;if(e.getAttribute&&e.attributes){for(u=[],_=e.attributes,y=0,g=_.length;g>y;y++)o=_[y],s=null!=(B=o.nodeName.match(r))?B[1]:void 0,s&&u.push((c=s.split("-")).length>1?[c[0],c.slice(1,c.length+1||9e9).join("-"),o.value]:[s,void 0,o.value]);for(b=u.sort(this._sortBindings),m=0,v=b.length;v>m;m++)if(O=b[m],s=O[0],n=O[1],f=O[2],i=n?(h=Batman.DOM.attrReaders[s])?(a=new Batman.DOM.AttrReaderBindingDefinition(e,n,f,this.context,this),h(a)):void 0:(h=Batman.DOM.readers[s])?(a=new Batman.DOM.ReaderBindingDefinition(e,f,this.context,this),h(a)):void 0,i instanceof Batman.RenderContext)l=this.context,this.context=i,Batman.DOM.onParseExit(e,t(function(){return this.context=l},this));else if(null!=i?i.skipChildren:void 0){d=!0;break}}return(p=this.nextNode(e,d))?this.parseNode(p):this.finish()},e.prototype.nextNode=function(t,e){var n,r,o,i,a,s;if(!e&&(n=t.childNodes,null!=n?n.length:void 0))return n[0];if(i=t.nextSibling,null!=(a=Batman.DOM.onParseExit(t))&&a.forEach(function(t){return t()}),Batman.DOM.forgetParseExit(t),this.node!==t){if(i)return i;for(r=t;r=r.parentNode;){if(o=r.nextSibling,null!=(s=Batman.DOM.onParseExit(r))&&s.forEach(function(t){return t()}),Batman.DOM.forgetParseExit(r),this.node===r)return;if(o)return o}}},e}()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=Object.prototype.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.AbstractBinding=function(){function e(e){this._fireDataChange=t(this._fireDataChange,this),this.node=e.node,this.keyPath=e.keyPath,this.renderContext=e.context,this.renderer=e.renderer,e.onlyObserve&&(this.onlyObserve=e.onlyObserve),null!=e.skipParseFilter&&(this.skipParseFilter=e.skipParseFilter),this.skipParseFilter||this.parseFilter(),this.bindImmediately&&this.bind()}var r,o,i,a,s,u;return n(e,Batman.Object),i=/(^|,)\s*(?:(true|false)|("[^"]*")|(\{[^\}]*\})|(([0-9]+[a-zA-Z\_\-]|[a-zA-Z])[\w\-\.]*[\?\!]?))\s*(?=$|,)/g,r=/(?:\]\.)(.+?)(?=[\[\.]|\s*\||$)/,o=/(?!^\s*)\[(.*?)\]/g,e.accessor("filteredValue",{get:function(){var t,e,n,r;return r=this.get("unfilteredValue"),n=this,t=this.get("renderContext"),this.filterFunctions.length>0?(Batman.developer.currentFilterStack=t,e=this.filterFunctions.reduce(function(e,r,o){var i;for(i=n.filterArguments[o].map(function(t){return t._keypath?n.renderContext.get(t._keypath):t}),i.unshift(e);i.length<r.length-1;)i.push(void 0);return i.push(n),r.apply(t,i)},r),Batman.developer.currentFilterStack=null,e):r},set:function(t,e){return this.set("unfilteredValue",e)}}),e.accessor("unfilteredValue",{get:function(){var t;return(t=this.get("key"))?Batman.RenderContext.deProxy(Batman.getPath(this,["keyContext",t])):this.get("value")},set:function(t,e){var n,r,o;return(n=this.get("key"))?(r=this.get("keyContext"),r&&r!==Batman.container?(o=Batman.Property.forBaseAndKey(r,n),o.setValue(e)):void 0):this.set("value",e)}}),e.accessor("keyContext",function(){return this.renderContext.contextForKey(this.key)}),a=Batman.BindingDefinitionOnlyObserve.All,s=Batman.BindingDefinitionOnlyObserve.Data,u=Batman.BindingDefinitionOnlyObserve.Node,e.prototype.bindImmediately=!0,e.prototype.shouldSet=!0,e.prototype.isInputBinding=!1,e.prototype.escapeValue=!0,e.prototype.onlyObserve=a,e.prototype.skipParseFilter=!1,e.prototype.isTwoWay=function(){return null!=this.key&&0===this.filterFunctions.length},e.prototype.bind=function(){var t,e;return this.node&&((t=this.onlyObserve)===a||t===u)&&Batman.DOM.nodeIsEditable(this.node)&&(Batman.DOM.events.change(this.node,this._fireNodeChange.bind(this)),this.onlyObserve===u&&this._fireNodeChange()),((e=this.onlyObserve)===a||e===s)&&this.observeAndFire("filteredValue",this._fireDataChange),this.node?Batman.DOM.trackBinding(this,this.node):void 0},e.prototype._fireNodeChange=function(t){var e;return this.shouldSet=!1,e=this.value||this.get("keyContext"),"function"==typeof this.nodeChange&&this.nodeChange(this.node,e,t),this.fire("nodeChange",this.node,e),this.shouldSet=!0},e.prototype._fireDataChange=function(t){return this.shouldSet?("function"==typeof this.dataChange&&this.dataChange(t,this.node),this.fire("dataChange",t,this.node)):void 0},e.prototype.die=function(){var t;return this.forget(),null!=(t=this._batman.properties)&&t.forEach(function(t,e){return e.die()}),this.fire("die"),this.node=null,this.keyPath=null,this.renderContext=null,this.renderer=null,this.dead=!0,!0},e.prototype.parseFilter=function(){var t,e,n,i,a,s,u,c,p;for(this.filterFunctions=[],this.filterArguments=[],u=this.keyPath;r.test(u);)u=u.replace(r,"]['$1']");a=u.replace(o," | get $1 ").replace(/'/g,'"').split(/(?!")\s+\|\s+(?!")/);try{s=this.parseSegment(c=a.shift())[0]}catch(l){Batman.developer.warn(l),Batman.developer.error("Error! Couldn't parse keypath in \""+c+'". Parsing error above.')}if(s&&s._keypath?this.key=s._keypath:this.value=s,a.length){for(;i=a.shift();){if(p=i.indexOf(" "),-1===p&&(p=i.length),n=i.substr(0,p),t=i.substr(p),!(e=Batman.Filters[n]))return Batman.developer.error("Unrecognized filter '"+n+"' in key \""+this.keyPath+'"!');this.filterFunctions.push(e);try{this.filterArguments.push(this.parseSegment(t))}catch(l){Batman.developer.error('Bad filter arguments "'+t+'"!')}}return!0}},e.prototype.parseSegment=function(t){return t=t.replace(i,function(t,e,n,r,o,i){var a;return null==e&&(e=""),a=i?'{"_keypath": "'+i+'"}':n||r||o,e+a}),JSON.parse("["+t+"]")},e}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=function(t,e){return function(){return t.apply(e,arguments)}};Batman.DOM.ViewBinding=function(){function t(){t.__super__.constructor.apply(this,arguments),this.renderer.prevent("rendered"),this.node.removeAttribute("data-view")}return e(t,Batman.DOM.AbstractBinding),t.prototype.skipChildren=!0,t.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,t.prototype.dataChange=function(t){var e;if(null!=t)return t.isView?(this.view=t,this.view.set("context",this.renderContext),this.view.set("node",this.node)):this.view=new t({node:this.node,context:this.renderContext,parentView:this.renderer.view}),this.view.on("ready",n(function(){return this.renderer.allowAndFire("rendered")},this)),this.forget(),null!=(e=this._batman.properties)?e.forEach(function(t,e){return e.die()}):void 0},t.prototype.die=function(){return this.view=null,t.__super__.die.apply(this,arguments)},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.ViewArgumentBinding=function(){function t(){t.__super__.constructor.apply(this,arguments)}return e(t,Batman.DOM.AbstractBinding),t.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.None,t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.ValueBinding=function(){function t(e){var n;this.isInputBinding="input"===(n=e.node.nodeName.toLowerCase())||"textarea"===n,t.__super__.constructor.apply(this,arguments)}return e(t,Batman.DOM.AbstractBinding),t.prototype.nodeChange=function(){return this.isTwoWay()?this.set("filteredValue",this.node.value):void 0},t.prototype.dataChange=function(t){return Batman.DOM.valueForNode(this.node,t,this.escapeValue)},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.ShowHideBinding=function(){function t(e){var n;n=e.node.style.display,n&&"none"!==n||(n=""),this.originalDisplay=n,this.invert=e.invert,t.__super__.constructor.apply(this,arguments)}return e(t,Batman.DOM.AbstractBinding),t.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,t.prototype.dataChange=function(t){var e,n,r;return n=Batman._data(this.node,"view"),!!t==!this.invert?(null!=n&&n.fire("beforeAppear",this.node),null!=(r=Batman.data(this.node,"show"))&&r.call(this.node),this.node.style.display=this.originalDisplay,null!=n?n.fire("appear",this.node):void 0):(null!=n&&n.fire("beforeDisappear",this.node),"function"==typeof(e=Batman.data(this.node,"hide"))?e.call(this.node):Batman.DOM.setStyleProperty(this.node,"display","none","important"),null!=n?n.fire("disappear",this.node):void 0)},t}()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=Object.prototype.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.SelectBinding=function(){function e(){this.updateOptionBindings=t(this.updateOptionBindings,this),this.nodeChange=t(this.nodeChange,this),this.dataChange=t(this.dataChange,this),this.childBindingAdded=t(this.childBindingAdded,this),this.selectedBindings=new Batman.SimpleSet,e.__super__.constructor.apply(this,arguments)}return n(e,Batman.DOM.AbstractBinding),e.prototype.isInputBinding=!0,e.prototype.canSetImplicitly=!0,e.prototype.childBindingAdded=function(e){var n;if(e instanceof Batman.DOM.CheckedBinding)e.on("dataChange",n=t(function(){return this.nodeChange()},this)),e.on("die",t(function(){return e.forget("dataChange",n),this.selectedBindings.remove(e)},this)),this.selectedBindings.add(e);else{if(!(e instanceof Batman.DOM.IteratorBinding))return;e.on("nodeAdded",n=t(function(){return this._fireDataChange(this.get("filteredValue"))},this)),e.on("nodeRemoved",n),e.on("die",function(){return e.forget("nodeAdded",n),e.forget("nodeRemoved",n)})}return this._fireDataChange(this.get("filteredValue"))},e.prototype.lastKeyContext=null,e.prototype.dataChange=function(e){var n,r,o,i,a,s,u;if(this.lastKeyContext||(this.lastKeyContext=this.get("keyContext")),this.lastKeyContext!==this.get("keyContext")&&(this.canSetImplicitly=!0,this.lastKeyContext=this.get("keyContext")),null!=e?e.forEach:void 0){for(o={},u=this.node.children,i=0,a=u.length;a>i;i++)n=u[i],n.selected=!1,r=o[s=n.value]||(o[s]=[]),r.push(n);
e.forEach(t(function(t){var e,n,r,i,a;if(e=o[t]){for(a=[],r=0,i=e.length;i>r;r++)n=e[r],a.push(n.selected=!0);return a}},this))}else null==e&&this.canSetImplicitly?this.node.value&&(this.canSetImplicitly=!1,this.set("unfilteredValue",this.node.value)):(this.canSetImplicitly=!1,Batman.DOM.valueForNode(this.node,e,this.escapeValue));this.updateOptionBindings(),this.fixSelectElementWidth()},e.prototype.nodeChange=function(){var t;this.isTwoWay()&&(t=Batman.DOM.valueForNode(this.node),typeof t===Array&&1===t.length&&(t=t[0]),this.set("unfilteredValue",t),this.updateOptionBindings())},e.prototype.updateOptionBindings=function(){return this.selectedBindings.forEach(function(t){return t._fireNodeChange()})},e.prototype.fixSelectElementWidth=function(){return-1!==window.navigator.userAgent.toLowerCase().indexOf("msie")?(this._fixWidthTimeout&&clearTimeout(this._fixWidthTimeout),this._fixWidthTimeout=setTimeout(t(function(){return this._fixWidthTimeout=null,this._fixSelectElementWidth()},this),100)):void 0},e.prototype._fixSelectElementWidth=function(){var t,e,n;return(e=null!=(n=this.get("node"))?n.style:void 0)?(t=this.get("node").currentStyle.width,e.width="100%",e.width=null!=t?t:""):void 0},e}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=function(t,e){return function(){return t.apply(e,arguments)}};Batman.DOM.RouteBinding=function(){function t(){t.__super__.constructor.apply(this,arguments)}return e(t,Batman.DOM.AbstractBinding),t.prototype.onAnchorTag=!1,t.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,t.accessor("dispatcher",function(){return this.renderContext.get("dispatcher")||Batman.App.get("current.dispatcher")}),t.prototype.bind=function(){return"A"===this.node.nodeName.toUpperCase()&&(this.onAnchorTag=!0),t.__super__.bind.apply(this,arguments),Batman.DOM.events.click(this.node,n(function(t,e){var n;if(!e.__batmanActionTaken)return e.__batmanActionTaken=!0,n=this.pathFromValue(this.get("filteredValue")),null!=n?Batman.redirect(n):void 0},this))},t.prototype.dataChange=function(t){var e;return t&&(e=this.pathFromValue(t)),this.onAnchorTag?(e=e&&Batman.navigator?Batman.navigator.linkTo(e):"#",this.node.href=e):void 0},t.prototype.pathFromValue=function(t){var e;return t?t.isNamedRouteQuery?t.get("path"):null!=(e=this.get("dispatcher"))?e.pathFromParams(t):void 0:void 0},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.RadioBinding=function(){function t(){t.__super__.constructor.apply(this,arguments)}return e(t,Batman.DOM.AbstractBinding),t.accessor("parsedNodeValue",function(){return Batman.DOM.attrReaders._parseAttribute(this.node.value)}),t.prototype.firstBind=!0,t.prototype.dataChange=function(){var t;return t=this.get("filteredValue"),null!=t?this.node.checked=t===Batman.DOM.attrReaders._parseAttribute(this.node.value):this.firstBind&&this.node.checked&&this.set("filteredValue",this.get("parsedNodeValue")),this.firstBind=!1},t.prototype.nodeChange=function(){return this.isTwoWay()?this.set("filteredValue",this.get("parsedNodeValue")):void 0},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.MixinBinding=function(){function t(){t.__super__.constructor.apply(this,arguments)}return e(t,Batman.DOM.AbstractBinding),t.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,t.prototype.dataChange=function(t){return null!=t?Batman.mixin(this.node,t):void 0},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.FileBinding=function(){function t(){t.__super__.constructor.apply(this,arguments)}return e(t,Batman.DOM.AbstractBinding),t.prototype.isInputBinding=!0,t.prototype.nodeChange=function(t){return this.isTwoWay()?t.hasAttribute("multiple")?this.set("filteredValue",Array.prototype.slice.call(t.files)):this.set("filteredValue",t.files[0]):void 0},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.DeferredRenderingBinding=function(){function t(){t.__super__.constructor.apply(this,arguments),this.node.removeAttribute("data-renderif")}return e(t,Batman.DOM.AbstractBinding),t.prototype.rendered=!1,t.prototype.skipChildren=!0,t.prototype.nodeChange=function(){},t.prototype.dataChange=function(t){return t&&!this.rendered?this.render():void 0},t.prototype.render=function(){return new Batman.Renderer(this.node,this.renderContext,this.renderer.view),this.rendered=!0},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.AbstractAttributeBinding=function(){function t(e){this.attributeName=e.attr,t.__super__.constructor.apply(this,arguments)}return e(t,Batman.DOM.AbstractBinding),t}()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=Object.prototype.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.FormBinding=function(){function e(){this.childBindingAdded=t(this.childBindingAdded,this),e.__super__.constructor.apply(this,arguments),this.contextName=this.attributeName,delete this.attributeName,Batman.DOM.events.submit(this.get("node"),function(t,e){return Batman.DOM.preventDefault(e)}),this.setupErrorsList()}return n(e,Batman.DOM.AbstractAttributeBinding),e.current=null,e.prototype.errorClass="error",e.prototype.defaultErrorsListSelector="div.errors",e.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.None,e.accessor("errorsListSelector",function(){return this.get("node").getAttribute("data-errors-list")||this.defaultErrorsListSelector}),e.prototype.childBindingAdded=function(t){var e,n,r,o;return t.isInputBinding&&Batman.isChildOf(this.get("node"),t.get("node"))&&~(r=t.get("key").indexOf(this.contextName))?(o=t.get("node"),n=t.get("key").slice(r+this.contextName.length+1),e=new Batman.DOM.AttrReaderBindingDefinition(o,this.errorClass,this.get("keyPath")+(" | get 'errors."+n+".length'"),this.renderContext,this.renderer),new Batman.DOM.AddClassBinding(e)):void 0},e.prototype.setupErrorsList=function(){return(this.errorsListNode=Batman.DOM.querySelector(this.get("node"),this.get("errorsListSelector")))&&(Batman.DOM.setInnerHTML(this.errorsListNode,this.errorsListHTML()),!this.errorsListNode.getAttribute("data-showif"))?this.errorsListNode.setAttribute("data-showif",""+this.contextName+".errors.length"):void 0},e.prototype.errorsListHTML=function(){return'<ul>\n  <li data-foreach-error="'+this.contextName+'.errors" data-bind="error.fullMessage"></li>\n</ul>'},e}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=function(t,e){return function(){return t.apply(e,arguments)}};Batman.DOM.EventBinding=function(){function t(){var e,r,o;t.__super__.constructor.apply(this,arguments),(o=this.node.getAttribute("data-confirm"))&&Batman.developer.deprecated("data-confirm"),r=n(function(){var t;if(!o||confirm(o))return null!=(t=this.get("filteredValue"))?t.apply(this.get("callbackContext"),arguments):void 0},this),(e=Batman.DOM.events[this.attributeName])?e(this.node,r,this.renderContext):Batman.DOM.events.other(this.node,this.attributeName,r,this.renderContext)}return e(t,Batman.DOM.AbstractAttributeBinding),t.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.None,t.accessor("callbackContext",function(){var t;return t=this.key.split("."),t.pop(),t.length>0?this.get("keyContext").get(t.join(".")):this.get("keyContext")}),t.wrapAccessor("unfilteredValue",function(t){return{get:function(){var e,n,r,o;return(n=this.get("key"))&&(o=n.split("."),o.length>1&&(e=o.pop(),r=Batman.getPath(this,["keyContext"].concat(o)),r=Batman.RenderContext.deProxy(r),null!=r))?r[e]:t.get.apply(this,arguments)}}}),t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.NodeAttributeBinding=function(){function t(){t.__super__.constructor.apply(this,arguments)}return e(t,Batman.DOM.AbstractAttributeBinding),t.prototype.dataChange=function(t){return null==t&&(t=""),this.node[this.attributeName]=t},t.prototype.nodeChange=function(t){return this.isTwoWay()?this.set("filteredValue",Batman.DOM.attrReaders._parseAttribute(t[this.attributeName])):void 0},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.CheckedBinding=function(){function t(){t.__super__.constructor.apply(this,arguments)}return e(t,Batman.DOM.NodeAttributeBinding),t.prototype.isInputBinding=!0,t.prototype.dataChange=function(t){return this.node[this.attributeName]=!!t},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.AttributeBinding=function(){function t(){t.__super__.constructor.apply(this,arguments)}return e(t,Batman.DOM.AbstractAttributeBinding),t.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,t.prototype.dataChange=function(t){return this.node.setAttribute(this.attributeName,t)},t.prototype.nodeChange=function(t){return this.isTwoWay()?this.set("filteredValue",Batman.DOM.attrReaders._parseAttribute(t.getAttribute(this.attributeName))):void 0},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.AddClassBinding=function(){function t(e){var n;this.invert=e.invert,this.classes=function(){var t,r,o,i;for(o=e.attr.split("|"),i=[],t=0,r=o.length;r>t;t++)n=o[t],i.push({name:n,pattern:RegExp("(?:^|\\s)"+n+"(?:$|\\s)","i")});return i}(),t.__super__.constructor.apply(this,arguments)}return e(t,Batman.DOM.AbstractAttributeBinding),t.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,t.prototype.dataChange=function(t){var e,n,r,o,i,a,s,u;for(e=this.node.className,s=this.classes,i=0,a=s.length;a>i;i++)u=s[i],r=u.name,o=u.pattern,n=o.test(e),!!t==!this.invert?n||(this.node.className=""+e+" "+r):n&&(this.node.className=e.replace(o," "));return!0},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.AbstractCollectionBinding=function(){function t(){t.__super__.constructor.apply(this,arguments)}return e(t,Batman.DOM.AbstractAttributeBinding),t.prototype.bindCollection=function(t){var e;return t instanceof Batman.Hash&&(t=t.meta),t===this.collection?!0:(this.unbindCollection(),this.collection=t,(null!=(e=this.collection)?e.isObservable:void 0)?(this.collection.observeAndFire("toArray",this.handleArrayChanged),!0):!1)},t.prototype.unbindCollection=function(){var t;return(null!=(t=this.collection)?t.isObservable:void 0)?this.collection.forget("toArray",this.handleArrayChanged):void 0},t.prototype.handleArrayChanged=function(){},t.prototype.die=function(){return this.unbindCollection(),t.__super__.die.apply(this,arguments)},t}()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=Object.prototype.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},r=Array.prototype.slice;Batman.DOM.StyleBinding=function(){function o(){this.setStyle=t(this.setStyle,this),this.handleArrayChanged=t(this.handleArrayChanged,this),this.oldStyles={},this.styleBindings={},o.__super__.constructor.apply(this,arguments)}return n(o,Batman.DOM.AbstractCollectionBinding),o.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,o.prototype.dataChange=function(t){var n,o,i,a,s,u,c,p,l;if(!t)return this.resetStyles(),void 0;this.unbindCollection();{if("string"!=typeof t){if(t instanceof Batman.Hash)return this.bindCollection(t);t instanceof Batman.Object&&(t=t.toJSON()),this.resetStyles(),l=[];for(i in t)e.call(t,i)&&l.push(this.bindSingleAttribute(i,""+this.keyPath+"."+i));return l}for(this.resetStyles(),c=t.split(";"),s=0,u=c.length;u>s;s++)a=c[s],p=a.split(":"),o=p[0],n=p.length>=2?r.call(p,1):[],this.setStyle(o,n.join(":"))}},o.prototype.handleArrayChanged=function(){return this.collection.forEach(t(function(t){return this.bindSingleAttribute(t,""+this.keyPath+"."+t)},this))},o.prototype.bindSingleAttribute=function(t,e){var n;return n=new Batman.DOM.AttrReaderBindingDefinition(this.node,t,e,this.renderContext,this.renderer),this.styleBindings[t]=new Batman.DOM.StyleBinding.SingleStyleBinding(n,this)},o.prototype.setStyle=function(t,e){return t=Batman.helpers.camelize(t.trim(),!0),null==this.oldStyles[t]&&(this.oldStyles[t]=this.node.style[t]||""),(null!=e?e.trim:void 0)&&(e=e.trim()),null==e&&(e=""),this.node.style[t]=e},o.prototype.resetStyles=function(){var t,n,r,o;r=this.oldStyles,o=[];for(t in r)e.call(r,t)&&(n=r[t],o.push(this.setStyle(t,n)));return o},o.prototype.resetBindings=function(){var t,e,n;n=this.styleBindings;for(t in n)e=n[t],e._fireDataChange(""),e.die();return this.styleBindings={}},o.prototype.unbindCollection=function(){return this.resetBindings(),o.__super__.unbindCollection.apply(this,arguments)},o.SingleStyleBinding=function(){function t(e,n){this.parent=n,t.__super__.constructor.call(this,e)}return n(t,Batman.DOM.AbstractAttributeBinding),t.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,t.prototype.isTwoWay=function(){return!1},t.prototype.dataChange=function(t){return this.parent.setStyle(this.attributeName,t)},t}(),o}()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=Object.prototype.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.IteratorBinding=function(){function e(n){this.handleArrayChanged=t(this.handleArrayChanged,this);var r,o;o=n.node,this.iteratorName=n.attr,this.key=n.keyPath,this.parentRenderer=n.renderer,this.nodeMap=new Batman.SimpleHash,this.rendererMap=new Batman.SimpleHash,this.prototypeNode=o.cloneNode(!0),this.prototypeNode.removeAttribute("data-foreach-"+this.iteratorName),r=o.nextSibling,this.startNode=document.createComment("start "+this.iteratorName+"-"+this.get("_batmanID")),this.endNode=document.createComment("end "+this.iteratorName+"-"+this.get("_batmanID")),this.endNode[Batman.expando]=o[Batman.expando],Batman.canDeleteExpando&&delete o[Batman.expando],Batman.DOM.insertBefore(o.parentNode,this.startNode,r),Batman.DOM.insertBefore(o.parentNode,this.endNode,r),this.parentRenderer.prevent("rendered"),Batman.DOM.onParseExit(o.parentNode,t(function(){return Batman.DOM.destroyNode(o),this.bind(),this.parentRenderer.allowAndFire("rendered")},this)),n.node=this.endNode,e.__super__.constructor.apply(this,arguments)}return n(e,Batman.DOM.AbstractCollectionBinding),e.prototype.currentActionNumber=0,e.prototype.queuedActionNumber=0,e.prototype.bindImmediately=!1,e.prototype.skipChildren=!0,e.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,e.prototype.parentNode=function(){return this.endNode.parentNode},e.prototype.dataChange=function(t){var e,n;return null==t?this.handleArrayChanged([]):this.bindCollection(t)?void 0:(e=(null!=t?t.forEach:void 0)?(n=[],t.forEach(function(t){return n.push(t)}),n):Object.keys(t),this.handleArrayChanged(e))},e.prototype.handleArrayChanged=function(e){var n,r,o,i,a,s,u,c,p;if(s=this.parentNode(),u=this._getStartNodeIndex()+1,c=this.nodeMap.merge(),e)for(r=0,p=e.length;p>r;r++)o=e[r],a=s.childNodes[u+r],null==a||this._itemForNode(a)!==o?(i=(n=this.nodeMap.get(o))?(c.unset(o),n):this._newNodeForItem(o),Batman.DOM.insertBefore(this.parentNode(),i,a)):c.unset(o);c.forEach(t(function(t,e){return this._nodesToBeRendered.has(e)?(this._nodesToBeRemoved||(this._nodesToBeRemoved=new Batman.SimpleSet),this._nodesToBeRemoved.add(e)):this._removeItem(t)},this))},e.prototype._itemForNode=function(t){return Batman._data(t,""+this.iteratorName+"Item")},e.prototype._newNodeForItem=function(e){var n,r;return n=this.prototypeNode.cloneNode(!0),this._nodesToBeRendered||(this._nodesToBeRendered=new Batman.SimpleSet),this._nodesToBeRendered.add(n),Batman._data(n,""+this.iteratorName+"Item",e),this.nodeMap.set(e,n),this.parentRenderer.prevent("rendered"),r=new Batman.Renderer(n,this.renderContext.descend(e,this.iteratorName),this.parentRenderer.view),r.once("rendered",t(function(){var t;return this._nodesToBeRendered.remove(n),(null!=(t=this._nodesToBeRemoved)?t.has(n):void 0)?(this._nodesToBeRemoved.remove(n),this._removeItem(e)):(Batman.DOM.propagateBindingEvents(n),this.fire("nodeAdded",n,e)),this.parentRenderer.allowAndFire("rendered")},this)),n},e.prototype._getStartNodeIndex=function(){var t,e,n,r;for(r=this.parentNode().childNodes,t=0,n=r.length;n>t;t++)if(e=r[t],e===this.startNode)return t;return 0},e.prototype._removeItem=function(t){var e;return e=this.nodeMap.unset(t),Batman.DOM.destroyNode(e),this.fire("nodeRemoved",e,t)},e.prototype.die=function(){var t;return this._nodesToBeRendered&&!this._nodesToBeRendered.isEmpty()&&(this._nodesToBeRemoved||(this._nodesToBeRemoved=new Batman.SimpleSet),(t=this._nodesToBeRemoved).add.apply(t,this._nodesToBeRendered.toArray())),e.__super__.die.apply(this,arguments)},e}()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=Object.prototype.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.ClassBinding=function(){function r(){this.handleArrayChanged=t(this.handleArrayChanged,this),r.__super__.constructor.apply(this,arguments)}return n(r,Batman.DOM.AbstractCollectionBinding),r.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,r.prototype.dataChange=function(t){return null!=t?(this.unbindCollection(),"string"==typeof t?this.node.className=t:(this.bindCollection(t),this.updateFromCollection())):void 0},r.prototype.updateFromCollection=function(){var t,n,r;return this.collection?(t=this.collection.map?this.collection.map(function(t){return t}):function(){var t,o;t=this.collection,o=[];for(n in t)e.call(t,n)&&(r=t[n],o.push(n));return o}.call(this),null!=t.toArray&&(t=t.toArray()),this.node.className=t.join(" ")):void 0},r.prototype.handleArrayChanged=function(){return this.updateFromCollection()},r}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.ValidationError=function(){function t(e,n){t.__super__.constructor.call(this,{attribute:e,message:n})}return e(t,Batman.Object),t.accessor("fullMessage",function(){return Batman.t("errors.format",{attribute:Batman.helpers.humanize(this.attribute),message:this.message})}),t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=Array.prototype.slice,r=function(t,e){return function(){return t.apply(e,arguments)}};Batman.StorageAdapter=function(){function t(e){var n;t.__super__.constructor.call(this,{model:e}),n=this.constructor,n.ModelMixin&&Batman.extend(e,n.ModelMixin),n.RecordMixin&&Batman.extend(e.prototype,n.RecordMixin)}return e(t,Batman.Object),t.StorageError=function(){function t(e){t.__super__.constructor.apply(this,arguments),this.message=e}return e(t,Error),t.prototype.name="StorageError",t}(),t.RecordExistsError=function(){function n(t){n.__super__.constructor.call(this,t||"Can't create this record because it already exists in the store!")}return e(n,t.StorageError),n.prototype.name="RecordExistsError",n}(),t.NotFoundError=function(){function n(t){n.__super__.constructor.call(this,t||"Record couldn't be found in storage!")}return e(n,t.StorageError),n.prototype.name="NotFoundError",n}(),t.NotAllowedError=function(){function n(t){n.__super__.constructor.call(this,t||"Storage operation denied access to the operation!")}return e(n,t.StorageError),n.prototype.name="NotAllowedError",n}(),t.NotAcceptableError=function(){function n(t){n.__super__.constructor.call(this,t||"Storage operation permitted but the request was malformed!")}return e(n,t.StorageError),n.prototype.name="NotAcceptableError",n}(),t.UnprocessableRecordError=function(){function n(t){n.__super__.constructor.call(this,t||"Storage adapter could not process the record!")}return e(n,t.StorageError),n.prototype.name="UnprocessableRecordError",n}(),t.InternalStorageError=function(){function n(t){n.__super__.constructor.call(this,t||"An error occured during the storage operation!")}return e(n,t.StorageError),n.prototype.name="InternalStorageError",n}(),t.NotImplementedError=function(){function n(t){n.__super__.constructor.call(this,t||"This operation is not implemented by the storage adpater!")}return e(n,t.StorageError),n.prototype.name="NotImplementedError",n}(),t.prototype.isStorageAdapter=!0,t.prototype.storageKey=function(t){var e;return e=(null!=t?t.constructor:void 0)||this.model,e.get("storageKey")||Batman.helpers.pluralize(Batman.helpers.underscore(e.get("resourceName")))},t.prototype.getRecordFromData=function(t,e){var n;return null==e&&(e=this.model),n=new e,n._withoutDirtyTracking(function(){return this.fromJSON(t)}),n},t.skipIfError=function(t){return function(e,n){return null!=e.error?n():t.call(this,e,n)}},t.prototype.before=function(){return this._addFilter.apply(this,["before"].concat(n.call(arguments)))},t.prototype.after=function(){return this._addFilter.apply(this,["after"].concat(n.call(arguments)))},t.prototype._inheritFilters=function(){var t,e,n,r,o,i;if(!(this._batman.check(this)&&this._batman.filters||(r=this._batman.getFirst("filters"),this._batman.filters={before:{},after:{}},null==r))){i=[];for(o in r)t=r[o],i.push(function(){var r;r=[];for(n in t)e=t[n],r.push(this._batman.filters[o][n]=e.slice(0));return r}.call(this));return i}},t.prototype._addFilter=function(){var t,e,r,o,i,a,s,u;for(o=arguments[0],r=arguments.length>=3?n.call(arguments,1,a=arguments.length-1):(a=1,[]),t=arguments[a++],this._inheritFilters(),s=0,u=r.length;u>s;s++)e=r[s],(i=this._batman.filters[o])[e]||(i[e]=[]),this._batman.filters[o][e].push(t);return!0},t.prototype.runFilter=function(t,e,n,o){var i,a,s,u;return this._inheritFilters(),a=this._batman.filters[t].all||[],i=this._batman.filters[t][e]||[],n.action=e,s="before"===t?i.concat(a):a.concat(i),u=r(function(t){var e;return null!=t&&(n=t),null!=(e=s.shift())?e.call(this,n,u):o.call(this,n)},this),u()},t.prototype.runBeforeFilter=function(){return this.runFilter.apply(this,["before"].concat(n.call(arguments)))},t.prototype.runAfterFilter=function(t,e,n){return this.runFilter("after",t,e,this.exportResult(n))},t.prototype.exportResult=function(t){return function(e){return t(e.error,e.result,e)}},t.prototype._jsonToAttributes=function(t){return JSON.parse(t)},t.prototype.perform=function(t,e,n,o){var i,a;n||(n={}),i={options:n,subject:e},a=r(function(e){return null!=e&&(i=e),this.runAfterFilter(t,i,o)},this),this.runBeforeFilter(t,i,function(e){return this[t](e,a)})},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=Array.prototype.slice,r=Array.prototype.indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(this[e]===t)return e;return-1},o=function(t,e){return function(){return t.apply(e,arguments)}};Batman.RestStorage=function(){function t(){t.__super__.constructor.apply(this,arguments),this.defaultRequestOptions=Batman.extend({},this.defaultRequestOptions)}var i,a,s,u,c;for(e(t,Batman.StorageAdapter),t.CommunicationError=function(){function n(t){n.__super__.constructor.call(this,t||"A communication error has occurred!")}return e(n,t.StorageError),n.prototype.name="CommunicationError",n}(),t.JSONContentType="application/json",t.PostBodyContentType="application/x-www-form-urlencoded",t.BaseMixin={request:function(t,e,n){return n||(n=e,e={}),e.method||(e.method="GET"),e.action=t,this._doStorageOperation(e.method.toLowerCase(),e,n)}},t.ModelMixin=Batman.extend({},t.BaseMixin,{urlNestsUnder:function(){var t,e,r,o,i;for(e=arguments.length>=1?n.call(arguments,0):[],r={},o=0,i=e.length;i>o;o++)t=e[o],r[t+"_id"]=Batman.helpers.pluralize(t);return this.url=function(t){var e,n,o,i;e=Batman.helpers.pluralize(this.get("resourceName").toLowerCase());for(n in r)if(i=r[n],o=t.data[n])return delete t.data[n],""+i+"/"+o+"/"+e;return e},this.prototype.url=function(){var t,e,n,o,i,a;t=Batman.helpers.pluralize(this.constructor.get("resourceName").toLowerCase());for(n in r)if(i=r[n],o=this.get("dirtyKeys").get(n),void 0===o&&(o=this.get(n)),o){a=""+i+"/"+o+"/"+t;break}return a||(a=t),(e=this.get("id"))&&(a+="/"+e),a}}}),t.RecordMixin=Batman.extend({},t.BaseMixin),t.prototype.defaultRequestOptions={type:"json"},t.prototype._implicitActionNames=["create","read","update","destroy","readAll"],t.prototype.serializeAsForm=!0,t.prototype.recordJsonNamespace=function(t){return Batman.helpers.singularize(this.storageKey(t))},t.prototype.collectionJsonNamespace=function(t){return Batman.helpers.pluralize(this.storageKey(t.prototype))},t.prototype._execWithOptions=function(t,e,n,r){return null==r&&(r=t),"function"==typeof t[e]?t[e].call(r,n):t[e]},t.prototype._defaultCollectionUrl=function(t){return""+this.storageKey(t.prototype)},t.prototype._addParams=function(t,e){var n;return!e||!e.action||(n=e.action,r.call(this._implicitActionNames,n)>=0)||(t+="/"+e.action.toLowerCase()),t},t.prototype._addUrlAffixes=function(t,e,n){var r,o;return o=[t,this.urlSuffix(e,n)],"/"!==t.charAt(0)&&(r=this.urlPrefix(e,n),"/"!==r.charAt(r.length-1)&&o.unshift("/"),o.unshift(r)),o.join("")},t.prototype.urlPrefix=function(t,e){return this._execWithOptions(t,"urlPrefix",e.options)||""},t.prototype.urlSuffix=function(t,e){return this._execWithOptions(t,"urlSuffix",e.options)||""},t.prototype.urlForRecord=function(t,e){var n,r,o;if(null!=(o=e.options)?o.recordUrl:void 0)r=this._execWithOptions(e.options,"recordUrl",e.options,t);else if(t.url)r=this._execWithOptions(t,"url",e.options);else if(r=t.constructor.url?this._execWithOptions(t.constructor,"url",e.options):this._defaultCollectionUrl(t.constructor),"create"!==e.action){if(null==(n=t.get("id")))throw new this.constructor.StorageError("Couldn't get/set record primary key on "+e.action+"!");r=r+"/"+n}return this._addUrlAffixes(this._addParams(r,e.options),t,e)},t.prototype.urlForCollection=function(t,e){var n,r;return n=(null!=(r=e.options)?r.collectionUrl:void 0)?this._execWithOptions(e.options,"collectionUrl",e.options,e.options.urlContext):t.url?this._execWithOptions(t,"url",e.options):this._defaultCollectionUrl(t,e.options),this._addUrlAffixes(this._addParams(n,e.options),t,e)},t.prototype.request=function(t,e){var n;return n=Batman.extend(t.options,{autosend:!1,success:function(e){return t.data=e},error:function(e){return t.error=e},loaded:function(){return t.response=t.request.get("response"),e()}}),t.request=new Batman.Request(n),t.request.send()},t.prototype.perform=function(e,n,r,o){return r||(r={}),Batman.extend(r,this.defaultRequestOptions),t.__super__.perform.call(this,e,n,r,o)},t.prototype.before("all",t.skipIfError(function(t,e){if(!t.options.url)try{t.options.url=t.subject.prototype?this.urlForCollection(t.subject,t):this.urlForRecord(t.subject,t)}catch(n){t.error=n}return e()})),t.prototype.before("get","put","post","delete",t.skipIfError(function(t,e){return t.options.method=t.action.toUpperCase(),e()})),t.prototype.before("create","update",t.skipIfError(function(t,e){var n,r,o;return r=t.subject.toJSON(),(o=this.recordJsonNamespace(t.subject))?(n={},n[o]=r):n=r,t.options.data=n,e()})),t.prototype.before("create","update","put","post",t.skipIfError(function(t,e){return this.serializeAsForm?t.options.contentType=this.constructor.PostBodyContentType:null!=t.options.data&&(t.options.data=JSON.stringify(t.options.data),t.options.contentType=this.constructor.JSONContentType),e()})),t.prototype.after("all",t.skipIfError(function(t,e){var n;if(null==t.data)return e();if("string"==typeof t.data){if(t.data.length>0)try{n=this._jsonToAttributes(t.data)}catch(r){return t.error=r,e()}}else"object"==typeof t.data&&(n=t.data);return null!=n&&(t.json=n),e()})),t.prototype.extractFromNamespace=function(t,e){return e&&null!=t[e]?t[e]:t},t.prototype.after("create","read","update",t.skipIfError(function(t,e){var n;return null!=t.json&&(n=this.extractFromNamespace(t.json,this.recordJsonNamespace(t.subject)),t.subject._withoutDirtyTracking(function(){return this.fromJSON(n)})),t.result=t.subject,e()})),t.prototype.after("readAll",t.skipIfError(function(t,e){var n,r;return r=this.collectionJsonNamespace(t.subject),t.recordsAttributes=this.extractFromNamespace(t.json,r),"Array"!==Batman.typeOf(t.recordsAttributes)&&(r=this.recordJsonNamespace(t.subject.prototype),t.recordsAttributes=[this.extractFromNamespace(t.json,r)]),t.result=t.records=function(){var e,r,o,i;for(o=t.recordsAttributes,i=[],e=0,r=o.length;r>e;e++)n=o[e],i.push(this.getRecordFromData(n,t.subject));return i}.call(this),e()})),t.prototype.after("get","put","post","delete",t.skipIfError(function(t,e){var n,r;return null!=t.json&&(n=t.json,r=t.subject.prototype?this.collectionJsonNamespace(t.subject):this.recordJsonNamespace(t.subject),t.result=r&&null!=t.json[r]?t.json[r]:t.json),e()})),t.HTTPMethods={create:"POST",update:"PUT",read:"GET",readAll:"GET",destroy:"DELETE"},c=["create","read","update","destroy","readAll","get","post","put","delete"],a=o(function(t){return this.prototype[t]=this.skipIfError(function(e,n){var r;return(r=e.options).method||(r.method=this.constructor.HTTPMethods[t]),this.request(e,n)})},t),s=0,u=c.length;u>s;s++)i=c[s],a(i);return t.prototype.after("all",function(t,e){return t.error&&(t.error=this._errorFor(t.error,t)),e()}),t._statusCodeErrors={0:t.CommunicationError,403:t.NotAllowedError,404:t.NotFoundError,406:t.NotAcceptableError,409:t.RecordExistsError,422:t.UnprocessableRecordError,500:t.InternalStorageError,501:t.NotImplementedError},t.prototype._errorFor=function(t,e){var n,r;return t instanceof Error||null==t.request?t:((n=this.constructor._statusCodeErrors[t.request.status])&&(r=t.request,t=new n,t.request=r,t.env=e),t)
},t}.call(this)}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=function(t,e){return function(){return t.apply(e,arguments)}};Batman.LocalStorage=function(){function t(){return window.localStorage===void 0?null:(t.__super__.constructor.apply(this,arguments),this.storage=localStorage,void 0)}return e(t,Batman.StorageAdapter),t.prototype.storageRegExpForRecord=function(t){return RegExp("^"+this.storageKey(t)+"(\\d+)$")},t.prototype.nextIdForRecord=function(t){var e,n;return n=this.storageRegExpForRecord(t),e=1,this._forAllStorageEntries(function(t){var r;return(r=n.exec(t))?e=Math.max(e,parseInt(r[1],10)+1):void 0}),e},t.prototype._forAllStorageEntries=function(t){var e,n,r;for(e=0,r=this.storage.length;r>=0?r>e:e>r;r>=0?e++:e--)n=this.storage.key(e),t.call(this,n,this.storage.getItem(n));return!0},t.prototype._storageEntriesMatching=function(t,e){var n,r;return n=this.storageRegExpForRecord(t.prototype),r=[],this._forAllStorageEntries(function(o,i){var a,s;return(s=n.exec(o))&&(a=this._jsonToAttributes(i),a[t.primaryKey]=s[1],this._dataMatches(e,a))?r.push(a):void 0}),r},t.prototype._dataMatches=function(t,e){var n,r,o;r=!0;for(n in t)if(o=t[n],e[n]!==o){r=!1;break}return r},t.prototype.before("read","create","update","destroy",t.skipIfError(function(t,e){return t.id="create"===t.action?t.subject.get("id")||t.subject._withoutDirtyTracking(n(function(){return t.subject.set("id",this.nextIdForRecord(t.subject))},this)):t.subject.get("id"),null==t.id?t.error=new this.constructor.StorageError("Couldn't get/set record primary key on "+t.action+"!"):t.key=this.storageKey(t.subject)+t.id,e()})),t.prototype.before("create","update",t.skipIfError(function(t,e){return t.recordAttributes=JSON.stringify(t.subject),e()})),t.prototype.after("read",t.skipIfError(function(t,e){if("string"==typeof t.recordAttributes)try{t.recordAttributes=this._jsonToAttributes(t.recordAttributes)}catch(n){return t.error=n,e()}return t.subject._withoutDirtyTracking(function(){return this.fromJSON(t.recordAttributes)}),e()})),t.prototype.after("read","create","update","destroy",t.skipIfError(function(t,e){return t.result=t.subject,e()})),t.prototype.after("readAll",t.skipIfError(function(t,e){var n;return t.result=t.records=function(){var e,r,o,i;for(o=t.recordsAttributes,i=[],e=0,r=o.length;r>e;e++)n=o[e],i.push(this.getRecordFromData(n,t.subject));return i}.call(this),e()})),t.prototype.read=t.skipIfError(function(t,e){return t.recordAttributes=this.storage.getItem(t.key),t.recordAttributes||(t.error=new this.constructor.NotFoundError),e()}),t.prototype.create=t.skipIfError(function(t,e){var n,r;return n=t.key,r=t.recordAttributes,this.storage.getItem(n)?arguments[0].error=new this.constructor.RecordExistsError:this.storage.setItem(n,r),e()}),t.prototype.update=t.skipIfError(function(t,e){var n,r;return n=t.key,r=t.recordAttributes,this.storage.setItem(n,r),e()}),t.prototype.destroy=t.skipIfError(function(t,e){var n;return n=t.key,this.storage.removeItem(n),e()}),t.prototype.readAll=t.skipIfError(function(t,e){try{arguments[0].recordsAttributes=this._storageEntriesMatching(t.subject,t.options.data)}catch(n){arguments[0].error=n}return e()}),t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.SessionStorage=function(){function t(){return window.sessionStorage===void 0?null:(t.__super__.constructor.apply(this,arguments),this.storage=sessionStorage,void 0)}return e(t,Batman.LocalStorage),t}()}.call(this),function(){Batman.Encoders=new Batman.Object}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.ParamsReplacer=function(){function t(t,e){this.navigator=t,this.params=e}return e(t,Batman.Object),t.prototype.redirect=function(){return this.navigator.redirect(this.toObject(),!0)},t.prototype.replace=function(t){return this.params.replace(t),this.redirect()},t.prototype.update=function(t){return this.params.update(t),this.redirect()},t.prototype.clear=function(){return this.params.clear(),this.redirect()},t.prototype.toObject=function(){return this.params.toObject()},t.accessor({get:function(t){return this.params.get(t)},set:function(t,e){var n,r;return n=this.params.get(t),r=this.params.set(t,e),n!==e&&this.redirect(),r},unset:function(t){var e,n;return e=this.params.hasKey(t),n=this.params.unset(t),e&&this.redirect(),n}}),t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.ParamsPusher=function(){function t(){t.__super__.constructor.apply(this,arguments)}return e(t,Batman.ParamsReplacer),t.prototype.redirect=function(){return this.navigator.redirect(this.toObject())},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=function(t,e){return function(){return t.apply(e,arguments)}};Batman.NamedRouteQuery=function(){function t(e,n){var r;null==n&&(n=[]),t.__super__.constructor.call(this,{routeMap:e,args:n});for(r in this.get("routeMap").childrenByName)this[r]=this._queryAccess.bind(this,r)}return e(t,Batman.Object),t.prototype.isNamedRouteQuery=!0,t.accessor("route",function(){var t,e,n,r,o,i,a;for(i=this.get("routeMap"),e=i.memberRoute,t=i.collectionRoute,a=[e,t],r=0,o=a.length;o>r;r++)if(n=a[r],null!=n&&n.namedArguments.length===this.get("args").length)return n;return t||e}),t.accessor("path",function(){return this.path()}),t.accessor("routeMap","args","cardinality","hashValue",Batman.Property.defaultAccessor),t.accessor({get:function(t){return null!=t?"string"==typeof t?this.nextQueryForName(t):this.nextQueryWithArgument(t):void 0},cache:!1}),t.accessor("withHash",function(){return new Batman.Accessible(n(function(t){return this.withHash(t)},this))}),t.prototype.withHash=function(t){var e;return e=this.clone(),e.set("hashValue",t),e},t.prototype.nextQueryForName=function(t){var e;return(e=this.get("routeMap").childrenByName[t])?new Batman.NamedRouteQuery(e,this.args):Batman.developer.error("Couldn't find a route for the name "+t+"!")},t.prototype.nextQueryWithArgument=function(t){var e;return e=this.args.slice(0),e.push(t),this.clone(e)},t.prototype.path=function(){var t,e,n,r,o,i;for(o={},r=this.get("route.namedArguments"),n=0,i=r.length;i>n;n++)t=r[n],null!=(e=this.get("args")[n])&&(o[t]=this._toParam(e));return null!=this.get("hashValue")&&(o["#"]=this.get("hashValue")),this.get("route").pathFromParams(o)},t.prototype.toString=function(){return this.path()},t.prototype.clone=function(t){return null==t&&(t=this.args),new Batman.NamedRouteQuery(this.routeMap,t)},t.prototype._toParam=function(t){return t instanceof Batman.AssociationProxy&&(t=t.get("target")),null!=(null!=t?t.toParam:void 0)?t.toParam():t},t.prototype._queryAccess=function(t,e){var n;return n=this.nextQueryForName(t),null!=e&&(n=n.nextQueryWithArgument(e)),n},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.Dispatcher=function(){function t(e,n){t.__super__.constructor.call(this,{app:e,routeMap:n})}var n;return e(t,Batman.Object),t.canInferRoute=function(t){return t instanceof Batman.Model||t instanceof Batman.AssociationProxy||t.prototype instanceof Batman.Model},t.paramsFromArgument=function(t){var e;return e=function(t){return Batman.helpers.camelize(Batman.helpers.pluralize(t.get("resourceName")),!0)},this.canInferRoute(t)?t instanceof Batman.Model||t instanceof Batman.AssociationProxy?(t.isProxy&&(t=t.get("target")),null!=t?{controller:e(t.constructor),action:"show",id:t.get("id")}:{}):t.prototype instanceof Batman.Model?{controller:e(t),action:"index"}:t:t},n=function(){function t(){t.__super__.constructor.apply(this,arguments)}return e(t,Batman.Object),t.accessor("__app",Batman.Property.defaultAccessor),t.accessor(function(t){return this.get("__app."+Batman.helpers.capitalize(t)+"Controller.sharedController")}),t}(),t.accessor("controllers",function(){return new n({__app:this.get("app")})}),t.prototype.routeForParams=function(t){return t=this.constructor.paramsFromArgument(t),this.get("routeMap").routeForParams(t)},t.prototype.pathFromParams=function(t){var e;return"string"==typeof t?t:(t=this.constructor.paramsFromArgument(t),null!=(e=this.routeForParams(t))?e.pathFromParams(t):void 0)},t.prototype.dispatch=function(t,e){var n,r,o,i,a,s;if(r=this.constructor.paramsFromArgument(t),i=this.routeForParams(r))a=i.pathAndParamsFromArgument(r),o=a[0],t=a[1],e&&Batman.mixin(t,e),this.set("app.currentRoute",i),this.set("app.currentURL",o),this.get("app.currentParams").replace(t||{}),i.dispatch(t);else{if("Object"===Batman.typeOf(t)&&!this.constructor.canInferRoute(t))return this.get("app.currentParams").replace(t);if(this.get("app.currentParams").clear(),n={type:"404",isPrevented:!1,preventDefault:function(){return this.isPrevented=!0}},null!=(s=Batman.currentApp)&&s.fire("error",n),n.isPrevented)return t;if("/404"!==t)return Batman.redirect("/404")}return o},t}.call(this)}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.Route=function(){function t(e,n){var r,o,i,a,s,u,c,p,l,h;for(c=this.constructor.regexps,0!==e.indexOf("/")&&(e="/"+e),a=e.replace(c.escapeRegExp,"\\$&"),u=RegExp("^"+a.replace(c.openOptParam,"(?:").replace(c.closeOptParam,")?").replace(c.namedParam,"([^/]+)").replace(c.splatParam,"(.*?)")+c.queryParam+"$"),c.namedOrSplat.lastIndex=0,i=function(){var t;for(t=[];o=c.namedOrSplat.exec(a);)t.push(o[1]);return t}(),s={templatePath:e,pattern:a,regexp:u,namedArguments:i,baseParams:n},h=this.optionKeys,p=0,l=h.length;l>p;p++)r=h[p],s[r]=n[r],delete n[r];t.__super__.constructor.call(this,s)}return e(t,Batman.Object),t.regexps={namedParam:/:([\w\d]+)/g,splatParam:/\*([\w\d]+)/g,queryParam:"(?:\\?.+)?",namedOrSplat:/[:|\*]([\w\d]+)/g,namePrefix:"[:|*]",escapeRegExp:/[-[\]{}+?.,\\^$|#\s]/g,openOptParam:/\(/g,closeOptParam:/\)/g},t.prototype.optionKeys=["member","collection"],t.prototype.testKeys=["controller","action"],t.prototype.isRoute=!0,t.prototype.paramsFromPath=function(t){var e,n,r,o,i,a,s,u;for(s=new Batman.URI(t),i=this.get("namedArguments"),a=Batman.extend({path:s.path},this.get("baseParams")),r=this.get("regexp").exec(s.path).slice(1),e=0,u=r.length;u>e;e++)n=r[e],o=i[e],a[o]=n;return Batman.extend(a,s.queryParams)},t.prototype.pathFromParams=function(t){var e,n,r,o,i,a,s,u,c,p,l,h,d,f,y;for(i=Batman.extend({},t),a=this.get("templatePath"),c=this.constructor.regexps,f=this.get("namedArguments"),p=0,h=f.length;h>p;p++)r=f[p],u=RegExp(""+c.namePrefix+r),o=a.replace(u,null!=i[r]?i[r]:""),o!==a&&(delete i[r],a=o);for(a=a.replace(c.openOptParam,"").replace(c.closeOptParam,"").replace(/([^\/])\/+$/,"$1"),y=this.testKeys,l=0,d=y.length;d>l;l++)n=y[l],delete i[n];return i["#"]&&(e=i["#"],delete i["#"]),s=Batman.URI.queryFromParams(i),s&&(a+="?"+s),e&&(a+="#"+e),a},t.prototype.test=function(t){var e,n,r,o,i,a;if("string"==typeof t)n=t;else if(null!=t.path)n=t.path;else for(n=this.pathFromParams(t),a=this.testKeys,o=0,i=a.length;i>o;o++)if(e=a[o],null!=(r=this.get(e))&&t[e]!==r)return!1;return this.get("regexp").test(n)},t.prototype.pathAndParamsFromArgument=function(t){var e,n;return"string"==typeof t?(e=this.paramsFromPath(t),n=t):(e=t,n=this.pathFromParams(t)),[n,e]},t.prototype.dispatch=function(t){return this.test(t)?this.get("callback")(t):!1},t.prototype.callback=function(){throw new Batman.DevelopmentError("Override callback in a Route subclass")},t}()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=Object.prototype.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.ControllerActionRoute=function(){function e(n,r){this.callback=t(this.callback,this);var o,i,a;r.signature&&(a=r.signature.split("#"),i=a[0],o=a[1],o||(o="index"),r.controller=i,r.action=o,delete r.signature),e.__super__.constructor.call(this,n,r)}return n(e,Batman.Route),e.prototype.optionKeys=["member","collection","app","controller","action"],e.prototype.callback=function(t){var e;return e=this.get("app.dispatcher.controllers."+this.get("controller")),e.dispatch(this.get("action"),t)},e}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.CallbackActionRoute=function(){function t(){t.__super__.constructor.apply(this,arguments)}return e(t,Batman.Route),t.prototype.optionKeys=["member","collection","callback","app"],t.prototype.controller=!1,t.prototype.action=!1,t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=function(t,e){return function(){return t.apply(e,arguments)}},r=Array.prototype.slice;Batman.Hash=function(){function t(){this.meta=new this.constructor.Metadata(this),Batman.SimpleHash.apply(this,arguments),t.__super__.constructor.apply(this,arguments)}var o,i,a,s,u,c,p,l;for(e(t,Batman.Object),t.Metadata=function(){function t(t){this.hash=t}return e(t,Batman.Object),Batman.extend(t.prototype,Batman.Enumerable),t.accessor("length",function(){return this.hash.registerAsMutableSource(),this.hash.length}),t.accessor("isEmpty","keys","toArray",function(t){return this.hash.registerAsMutableSource(),this.hash[t]()}),t.prototype.forEach=function(){var t;return(t=this.hash).forEach.apply(t,arguments)},t}(),Batman.extend(t.prototype,Batman.Enumerable),t.prototype.propertyClass=Batman.Property,t.defaultAccessor={get:Batman.SimpleHash.prototype.get,set:t.mutation(function(t,e){var n;return n=Batman.SimpleHash.prototype.set.call(this,t,e),this.fire("itemsWereAdded",t),n}),unset:t.mutation(function(t){var e;return e=Batman.SimpleHash.prototype.unset.call(this,t),null!=e&&this.fire("itemsWereRemoved",t),e}),cache:!1},t.accessor(t.defaultAccessor),t.prototype._preventMutationEvents=function(t){this.prevent("change"),this.prevent("itemsWereAdded"),this.prevent("itemsWereRemoved");try{return t.call(this)}finally{this.allow("change"),this.allow("itemsWereAdded"),this.allow("itemsWereRemoved")}},t.prototype.clear=t.mutation(function(){var t,e;return t=this.keys(),this._preventMutationEvents(function(){return this.forEach(n(function(t){return this.unset(t)},this))}),e=Batman.SimpleHash.prototype.clear.call(this),this.fire.apply(this,["itemsWereRemoved"].concat(r.call(t))),e}),t.prototype.update=t.mutation(function(t){var e;return e=[],this._preventMutationEvents(function(){return Batman.forEach(t,n(function(t,n){return this.hasKey(t)||e.push(t),this.set(t,n)},this))}),e.length>0?this.fire.apply(this,["itemsWereAdded"].concat(r.call(e))):void 0}),t.prototype.replace=t.mutation(function(t){var e,o;return e=[],o=[],this._preventMutationEvents(function(){return this.forEach(n(function(e){return Batman.objectHasKey(t,e)?void 0:(this.unset(e),o.push(e))},this)),Batman.forEach(t,n(function(t,n){return this.hasKey(t)||e.push(t),this.set(t,n)},this))}),e.length>0&&this.fire.apply(this,["itemsWereAdded"].concat(r.call(e))),o.length>0?this.fire.apply(this,["itemsWereRemoved"].concat(r.call(o))):void 0}),p=["equality","hashKeyFor","objectKey","prefixedKey","unprefixedKey"],a=0,u=p.length;u>a;a++)o=p[a],t.prototype[o]=Batman.SimpleHash.prototype[o];for(l=["hasKey","forEach","isEmpty","keys","toArray","merge","toJSON","toObject"],i=n(function(t){return this.prototype[t]=function(){return this.registerAsMutableSource(),Batman.SimpleHash.prototype[t].apply(this,arguments)}},t),s=0,c=l.length;c>s;s++)o=l[s],i(o);return t}.call(this)}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=function(t,e){return function(){return t.apply(e,arguments)}};Batman.RenderCache=function(){function t(){t.__super__.constructor.apply(this,arguments),this.keyQueue=[]}return e(t,Batman.Hash),t.prototype.maximumLength=4,t.prototype.viewForOptions=function(t){return t.cache===!1||t.viewClass.prototype.cache===!1?this._newViewFromOptions(t):this.getOrSet(t,n(function(){return this._newViewFromOptions(Batman.extend({},t))},this))},t.prototype._newViewFromOptions=function(t){return new t.viewClass(t)},t.wrapAccessor(function(t){return{cache:!1,get:function(e){var n;return n=t.get.call(this,e),n&&this._addOrBubbleKey(e),n},set:function(e){var n;return n=t.set.apply(this,arguments),n.set("cached",!0),this._addOrBubbleKey(e),this._evictExpiredKeys(),n},unset:function(e){var n;return n=t.unset.apply(this,arguments),n.set("cached",!1),this._removeKeyFromQueue(e),n}}}),t.prototype.equality=function(t,e){var n;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(n in t)if("view"!==n&&t[n]!==e[n])return!1;return!0},t.prototype.reset=function(){var t,e,n,r,o;for(r=this.keyQueue.slice(0),o=[],e=0,n=r.length;n>e;e++)t=r[e],o.push(this.unset(t));return o},t.prototype._addOrBubbleKey=function(t){return this._removeKeyFromQueue(t),this.keyQueue.unshift(t)},t.prototype._removeKeyFromQueue=function(t){var e,n,r,o;for(o=this.keyQueue,e=0,r=o.length;r>e;e++)if(n=o[e],this.equality(n,t)){this.keyQueue.splice(e,1);break}return t},t.prototype._evictExpiredKeys=function(){var t,e,n,r,o;if(this.length>this.maximumLength)for(t=this.keyQueue.slice(0),e=r=this.maximumLength,o=t.length;o>=r?o>e:e>o;o>=r?e++:e--)n=t[e],this.get(n).isInDOM()||this.unset(n)},t}()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=Object.prototype.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},r=Array.prototype.slice,o=Array.prototype.indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(this[e]===t)return e;return-1};Batman.Controller=function(){function e(){this.redirect=t(this.redirect,this),this.handleError=t(this.handleError,this),this.errorHandler=t(this.errorHandler,this),e.__super__.constructor.apply(this,arguments),this._resetActionFrames()}var i;return n(e,Batman.Object),e.singleton("sharedController"),e.wrapAccessor("routingKey",function(){return{get:function(){return null!=this.routingKey?this.routingKey:(Batman.config.minificationErrors&&Batman.developer.error("Please define `routingKey` on the prototype of "+Batman.functionName(this.constructor)+" in order for your controller to be minification safe."),Batman.functionName(this.constructor).replace(/Controller$/,""))}}}),e.accessor("_renderContext",function(){return Batman.RenderContext.root().descend(this)}),i=function(t,e){return e?"string"==typeof t?t={only:[t]}:(t.only&&"Array"!==Batman.typeOf(t.only)&&(t.only=[t.only]),t.except&&"Array"!==Batman.typeOf(t.except)&&(t.except=[t.except])):(e=t,t={}),t.block=e,t},e.beforeFilter=function(){var t,e,n;return Batman.initializeObject(this),e=i.apply(null,arguments),t=(n=this._batman).beforeFilters||(n.beforeFilters=[]),t.push(e)},e.afterFilter=function(){var t,e,n;return Batman.initializeObject(this),e=i.apply(null,arguments),t=(n=this._batman).afterFilters||(n.afterFilters=[]),t.push(e)},e.afterFilter(function(t){return this.autoScrollToHash&&null!=t["#"]?this.scrollToHash(t["#"]):void 0}),e.catchError=function(){var t,e,n,o,i,a,s,u,c,p;for(n=arguments.length>=2?r.call(arguments,0,s=arguments.length-1):(s=0,[]),i=arguments[s++],Batman.initializeObject(this),(a=this._batman).errorHandlers||(a.errorHandlers=new Batman.SimpleHash),o="Array"===Batman.typeOf(i["with"])?i["with"]:[i["with"]],p=[],u=0,c=n.length;c>u;u++)e=n[u],t=this._batman.errorHandlers.get(e)||[],p.push(this._batman.errorHandlers.set(e,t.concat(o)));return p},e.prototype.errorHandler=function(e){var n,r;return n=null!=(r=this._actionFrames)?r[this._actionFrames.length-1]:void 0,t(function(t,r,o){if(!t)return"function"==typeof e?e(r,o):void 0;if((null!=n?!n.error:true)&&(null!=n&&(n.error=t),!this.handleError(t)))throw t},this)},e.prototype.handleError=function(e){var n,r;return n=!1,null!=(r=this.constructor._batman.getAll("errorHandlers"))&&r.forEach(t(function(r){return r.forEach(t(function(t,r){var o,i,a,s;if(e instanceof t){for(n=!0,s=[],i=0,a=r.length;a>i;i++)o=r[i],s.push(o.call(this,e));return s}},this))},this)),n},e.prototype.renderCache=new Batman.RenderCache,e.prototype.defaultRenderYield="main",e.prototype.autoScrollToHash=!0,e.prototype.dispatch=function(t,e){var n;return null==e&&(e={}),e.controller||(e.controller=this.get("routingKey")),e.action||(e.action=t),e.target||(e.target=this),this._resetActionFrames(),this.set("action",t),this.set("params",e),Batman.DOM.Yield.cycleAll(),this.executeAction(t,e),Batman.DOM.Yield.clearAllStale(),n=this._afterFilterRedirect,delete this._afterFilterRedirect,n?Batman.redirect(n):void 0},e.prototype.executeAction=function(e,n){var r,o,i,a,s,u;return null==n&&(n=this.get("params")),Batman.developer.assert(this[e],"Error! Controller action "+this.get("routingKey")+"."+e+" couldn't be found!"),i=this._actionFrames[this._actionFrames.length-1],r=new Batman.ControllerActionFrame({parentFrame:i,action:e},t(function(){var t;return this._afterFilterRedirect||this._runFilters(e,n,"afterFilters"),this._resetActionFrames(),null!=(t=Batman.navigator)?t.redirect=o:void 0},this)),this._actionFrames.push(r),r.startOperation({internal:!0}),o=null!=(s=Batman.navigator)?s.redirect:void 0,null!=(u=Batman.navigator)&&(u.redirect=this.redirect),this._runFilters(e,n,"beforeFilters"),this._afterFilterRedirect||(a=this[e](n)),r.operationOccurred||this.render(),r.finishOperation(),a},e.prototype.redirect=function(t){var e;return e=this._actionFrames[this._actionFrames.length-1],e?(e.operationOccurred&&Batman.developer.warn("Warning! Trying to redirect but an action has already been taken during "+this.get("routingKey")+"."+(e.action||this.get("action"))),e.startAndFinishOperation(),null!=this._afterFilterRedirect?Batman.developer.warn("Warning! Multiple actions trying to redirect!"):this._afterFilterRedirect=t):("Object"===Batman.typeOf(t)&&(t.controller||(t.controller=this)),Batman.redirect(t))},e.prototype.render=function(e){var n,r,o,i,a;return null==e&&(e={}),(r=null!=(i=this._actionFrames)?i[this._actionFrames.length-1]:void 0)&&r.startOperation(),e===!1?(r.finishOperation(),void 0):(n=(null!=r?r.action:void 0)||this.get("action"),e&&(e.into||(e.into=this.defaultRenderYield)),e.view?(o=e.view,e.view=null):(e.viewClass||(e.viewClass=this._viewClassForAction(n)),e.context||(e.context=this.get("_renderContext")),e.source||(e.source=Batman.helpers.underscore(this.get("routingKey")+"/"+n)),o=this.renderCache.viewForOptions(e)),o&&(null!=(a=Batman.currentApp)&&a.prevent("ready"),o.once("ready",t(function(){var t;return Batman.DOM.Yield.withName(e.into).replace(o.get("node")),null!=(t=Batman.currentApp)&&t.allowAndFire("ready"),null!=r?r.finishOperation():void 0},this))),o)},e.prototype.scrollToHash=function(t){return null==t&&(t=this.get("params")["#"]),Batman.DOM.scrollIntoView(t)},e.prototype._resetActionFrames=function(){return this._actionFrames=[]},e.prototype._viewClassForAction=function(t){var e,n;return e=this.get("routingKey").replace("/","_"),(null!=(n=Batman.currentApp)?n[Batman.helpers.camelize(""+e+"_"+t+"_view")]:void 0)||Batman.View},e.prototype._runFilters=function(t,e,n){var r,i,a,s,u,c;if(n=null!=(u=this.constructor._batman)?u.get(n):void 0){for(c=[],a=0,s=n.length;s>a;a++)if(i=n[a],!(i.only&&0>o.call(i.only,t)||i.except&&o.call(i.except,t)>=0)){if(this._afterFilterRedirect)return;r=i.block,c.push("function"==typeof r?r.call(this,e):"function"==typeof this[r]?this[r](e):void 0)}return c}},e}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=function(t,e){return function(){return t.apply(e,arguments)}};Batman.Set=function(){function t(){Batman.SimpleSet.apply(this,arguments)}var r,o,i,a,s,u,c,p;for(e(t,Batman.Object),Batman.extend(t.prototype,Batman.Enumerable),t._applySetAccessors=function(t){var e,r,o,i;r={first:function(){return this.toArray()[0]},last:function(){return this.toArray()[this.length-1]},isEmpty:function(){return this.isEmpty()},toArray:function(){return this.toArray()},length:function(){return this.registerAsMutableSource(),this.length},indexedBy:function(){return new Batman.TerminalAccessible(n(function(t){return this.indexedBy(t)},this))},indexedByUnique:function(){return new Batman.TerminalAccessible(n(function(t){return this.indexedByUnique(t)},this))},sortedBy:function(){return new Batman.TerminalAccessible(n(function(t){return this.sortedBy(t)},this))},sortedByDescending:function(){return new Batman.TerminalAccessible(n(function(t){return this.sortedBy(t,"desc")},this))}},i=[];for(o in r)e=r[o],i.push(t.accessor(o,e));return i},t._applySetAccessors(t),c=["add","remove","clear","replace","indexedBy","indexedByUnique","sortedBy","equality","_indexOfItem"],i=0,s=c.length;s>i;i++)r=c[i],t.prototype[r]=Batman.SimpleSet.prototype[r];for(p=["find","merge","forEach","toArray","isEmpty","has"],o=n(function(t){return this.prototype[t]=function(){return this.registerAsMutableSource(),Batman.SimpleSet.prototype[t].apply(this,arguments)}},t),a=0,u=p.length;u>a;a++)r=p[a],o(r);return t.prototype.toJSON=t.prototype.toArray,t}.call(this)}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.ErrorsSet=function(){function t(){t.__super__.constructor.apply(this,arguments)}return e(t,Batman.Set),t.accessor(function(t){return this.indexedBy("attribute").get(t)}),t.prototype.add=function(e,n){return t.__super__.add.call(this,new Batman.ValidationError(e,n))},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=Array.prototype.slice,r=function(t,e){return function(){return t.apply(e,arguments)}};Batman.SetProxy=function(){function t(e){this.base=e,t.__super__.constructor.call(this),this.length=this.base.length,this.base.on("itemsWereAdded",r(function(){var t;return t=arguments.length>=1?n.call(arguments,0):[],this.set("length",this.base.length),this.fire.apply(this,["itemsWereAdded"].concat(n.call(t)))},this)),this.base.on("itemsWereRemoved",r(function(){var t;return t=arguments.length>=1?n.call(arguments,0):[],this.set("length",this.base.length),this.fire.apply(this,["itemsWereRemoved"].concat(n.call(t)))},this))}var o,i,a,s,u;for(e(t,Batman.Object),Batman.extend(t.prototype,Batman.Enumerable),t.prototype.filter=function(t){return this.reduce(function(e,n){return t(n)&&e.add(n),e},new Batman.Set)},t.prototype.replace=function(){var t,e;return t=this.property("length"),t.isolate(),e=this.base.replace.apply(this,arguments),t.expose(),e},Batman.Set._applySetAccessors(t),u=["add","remove","find","clear","has","merge","toArray","isEmpty","indexedBy","indexedByUnique","sortedBy"],i=r(function(t){return this.prototype[t]=function(){var e;return(e=this.base)[t].apply(e,arguments)}},t),a=0,s=u.length;s>a;a++)o=u[a],i(o);return t.accessor("length",{get:function(){return this.registerAsMutableSource(),this.length},set:function(t,e){return this.length=e}}),t}.call(this)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=Object.prototype.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},r=Array.prototype.slice;Batman.BinarySetOperation=function(){function e(n,r){this.left=n,this.right=r,this._setup=t(this._setup,this),e.__super__.constructor.call(this),this._setup(this.left,this.right),this._setup(this.right,this.left)}return n(e,Batman.Set),e.prototype._setup=function(e,n){return e.on("itemsWereAdded",t(function(){var t;return t=arguments.length>=1?r.call(arguments,0):[],this._itemsWereAddedToSource.apply(this,[e,n].concat(r.call(t)))},this)),e.on("itemsWereRemoved",t(function(){var t;return t=arguments.length>=1?r.call(arguments,0):[],this._itemsWereRemovedFromSource.apply(this,[e,n].concat(r.call(t)))},this)),this._itemsWereAddedToSource.apply(this,[e,n].concat(r.call(e.toArray())))},e.prototype.merge=function(){var t,e,n,o,i;for(e=arguments.length>=1?r.call(arguments,0):[],t=new Batman.Set,e.unshift(this),o=0,i=e.length;i>o;o++)n=e[o],n.forEach(function(e){return t.add(e)});return t},e.prototype.filter=Batman.SetProxy.prototype.filter,e}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=Array.prototype.slice;Batman.SetUnion=function(){function t(){t.__super__.constructor.apply(this,arguments)}return e(t,Batman.BinarySetOperation),t.prototype._itemsWereAddedToSource=function(){var t,e,r;return r=arguments[0],e=arguments[1],t=arguments.length>=3?n.call(arguments,2):[],this.add.apply(this,t)},t.prototype._itemsWereRemovedFromSource=function(){var t,e,r,o,i;return i=arguments[0],o=arguments[1],e=arguments.length>=3?n.call(arguments,2):[],r=function(){var n,r,i;for(i=[],n=0,r=e.length;r>n;n++)t=e[n],o.has(t)||i.push(t);return i}(),this.remove.apply(this,r)},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=Array.prototype.slice;Batman.SetIntersection=function(){function t(){t.__super__.constructor.apply(this,arguments)}return e(t,Batman.BinarySetOperation),t.prototype._itemsWereAddedToSource=function(){var t,e,r,o,i;return i=arguments[0],o=arguments[1],e=arguments.length>=3?n.call(arguments,2):[],r=function(){var n,r,i;for(i=[],n=0,r=e.length;r>n;n++)t=e[n],o.has(t)&&i.push(t);return i}(),r.length>0?this.add.apply(this,r):void 0},t.prototype._itemsWereRemovedFromSource=function(){var t,e,r;return r=arguments[0],e=arguments[1],t=arguments.length>=3?n.call(arguments,2):[],this.remove.apply(this,t)},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=Array.prototype.slice;Batman.SetComplement=function(){function t(){t.__super__.constructor.apply(this,arguments)}return e(t,Batman.BinarySetOperation),t.prototype._itemsWereAddedToSource=function(){var t,e,r,o,i,a;
if(a=arguments[0],i=arguments[1],e=arguments.length>=3?n.call(arguments,2):[],a===this.left){if(r=function(){var n,r,o;for(o=[],n=0,r=e.length;r>n;n++)t=e[n],i.has(t)||o.push(t);return o}(),r.length>0)return this.add.apply(this,r)}else if(o=function(){var n,r,o;for(o=[],n=0,r=e.length;r>n;n++)t=e[n],i.has(t)&&o.push(t);return o}(),o.length>0)return this.remove.apply(this,o)},t.prototype._itemsWereRemovedFromSource=function(){var t,e,r,o,i;return i=arguments[0],o=arguments[1],e=arguments.length>=3?n.call(arguments,2):[],i===this.left?this.remove.apply(this,e):(r=function(){var n,r,i;for(i=[],n=0,r=e.length;r>n;n++)t=e[n],o.has(t)&&i.push(t);return i}(),r.length>0?this.add.apply(this,r):void 0)},t.prototype._addComplement=function(t,e){var n,r;return r=function(){var r,o,i;for(i=[],r=0,o=t.length;o>r;r++)n=t[r],e.has(n)&&i.push(n);return i}(),r.length>0?this.add.apply(this,r):void 0},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=function(t,e){return function(){return t.apply(e,arguments)}},r=Array.prototype.slice;Batman.StateMachine=function(){function t(t){this.nextEvents=[],this.set("_state",t)}return e(t,Batman.Object),t.InvalidTransitionError=function(t){this.message=null!=t?t:""},t.InvalidTransitionError.prototype=Error(),t.transitions=function(t){var e,o,i,a,s,u,c,p,l;for(i in t)p=t[i],p.from&&p.to&&(a={},p.from.forEach?p.from.forEach(function(t){return a[t]=p.to}):a[p.from]=p.to,t[i]=a);this.prototype.transitionTable=Batman.extend({},this.prototype.transitionTable,t),s=[],e=n(function(t){var e;return e="is"+Batman.helpers.capitalize(t),null==this.prototype[e]?(s.push(e),this.prototype[e]=function(){return this.get("state")===t}):void 0},this),l=this.prototype.transitionTable;for(i in l)if(c=l[i],!this.prototype[i]){n(function(t){return this.prototype[t]=function(){return this.startTransition(t)}},this)(i);for(o in c)u=c[o],e(o),e(u)}return s.length&&this.accessor.apply(this,r.call(s).concat([function(t){return this[t]()}])),this},t.accessor("state",function(){return this.get("_state")}),t.prototype.isTransitioning=!1,t.prototype.transitionTable={},t.prototype.onTransition=function(t,e,n){return this.on(""+t+"->"+e,n)},t.prototype.onEnter=function(t,e){return this.on("enter "+t,e)},t.prototype.onExit=function(t,e){return this.on("exit "+t,e)},t.prototype.startTransition=Batman.Property.wrapTrackingPrevention(function(t){var e,n;return this.isTransitioning?(this.nextEvents.push(t),void 0):(n=this.get("state"),(e=this.nextStateForEvent(t))?(this.isTransitioning=!0,this.fire("exit "+n),this.set("_state",e),this.fire(""+n+"->"+e),this.fire("enter "+e),this.fire(t),this.isTransitioning=!1,this.nextEvents.length>0&&this.startTransition(this.nextEvents.shift()),!0):!1)}),t.prototype.canStartTransition=function(t,e){return null==e&&(e=this.get("state")),!!this.nextStateForEvent(t,e)},t.prototype.nextStateForEvent=function(t,e){var n;return null==e&&(e=this.get("state")),null!=(n=this.transitionTable[t])?n[e]:void 0},t}(),Batman.DelegatingStateMachine=function(){function t(e,n){this.base=n,t.__super__.constructor.call(this,e)}return e(t,Batman.StateMachine),t.prototype.fire=function(){var e,n;return e=t.__super__.fire.apply(this,arguments),(n=this.base).fire.apply(n,arguments),e},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=Array.prototype.slice,r=function(t,e){return function(){return t.apply(e,arguments)}};Batman.Model=function(){function t(e){null==e&&(e={}),Batman.developer.assert(this instanceof Batman.Object,"constructors must be called with new"),"Object"===Batman.typeOf(e)?t.__super__.constructor.call(this,e):(t.__super__.constructor.call(this),this.set("id",e))}var o,i,a,s,u,c,p;for(e(t,Batman.Object),t.storageKey=null,t.primaryKey="id",t.persist=function(){var t,e;return t=arguments[0],e=arguments.length>=2?n.call(arguments,1):[],Batman.initializeObject(this.prototype),t=t.isStorageAdapter?t:new t(this),e.length>0&&Batman.mixin.apply(Batman,[t].concat(n.call(e))),this.prototype._batman.storage=t,t},t.storageAdapter=function(){return Batman.initializeObject(this.prototype),this.prototype._batman.storage},t.encode=function(){var t,e,r,o,i,a,s,u,c;switch(i=arguments.length>=2?n.call(arguments,0,s=arguments.length-1):(s=0,[]),r=arguments[s++],Batman.initializeObject(this.prototype),(a=this.prototype._batman).encoders||(a.encoders=new Batman.SimpleHash),t={},Batman.typeOf(r)){case"String":i.push(r);break;case"Function":t.encode=r;break;default:t=r}for(u=0,c=i.length;c>u;u++)o=i[u],e=Batman.extend({as:o},this.defaultEncoder,t),this.prototype._batman.encoders.set(o,e)},t.defaultEncoder={encode:function(t){return t},decode:function(t){return t}},t.observeAndFire("primaryKey",function(t,e){return this.encode(e,{encode:!1,decode:!1}),this.encode(t,{encode:!1,decode:this.defaultEncoder.decode})}),t.validate=function(){var t,e,r,o,i,a,s,u,c,p,l;if(t=arguments.length>=2?n.call(arguments,0,s=arguments.length-1):(s=0,[]),r=arguments[s++],Batman.initializeObject(this.prototype),i=(a=this.prototype._batman).validators||(a.validators=[]),"function"==typeof r)return i.push({keys:t,callback:r});for(p=Batman.Validators,l=[],u=0,c=p.length;c>u;u++)o=p[u],l.push((e=o.matches(r))?i.push({keys:t,validator:new o(e)}):void 0);return l},t.classAccessor("resourceName",{get:function(){return null!=this.resourceName?this.resourceName:(Batman.config.minificationErrors&&Batman.developer.error("Please define "+Batman.functionName(this)+".resourceName in order for your model to be minification safe."),Batman.helpers.underscore(Batman.functionName(this)))}}),t.classAccessor("all",{get:function(){return this._batman.check(this),this.prototype.hasStorage()&&!this._batman.allLoadTriggered&&(this.load(),this._batman.allLoadTriggered=!0),this.get("loaded")},set:function(t,e){return this.set("loaded",e)}}),t.classAccessor("loaded",{get:function(){return this._loaded||(this._loaded=new Batman.Set)},set:function(t,e){return this._loaded=e}}),t.classAccessor("first",function(){return this.get("all").toArray()[0]}),t.classAccessor("last",function(){var t;return t=this.get("all").toArray(),t[t.length-1]}),t.clear=function(){var t,e;return Batman.initializeObject(this),t=this.get("loaded").clear(),null!=(e=this._batman.get("associations"))&&e.reset(),this._resetPromises(),t},t.find=function(t,e){return this.findWithOptions(t,void 0,e)},t.findWithOptions=function(t,e,n){var r;return null==e&&(e={}),Batman.developer.assert(n,"Must call find with a callback!"),r=new this,r._withoutDirtyTracking(function(){return this.set("id",t)}),r.loadWithOptions(e,n),r},t.load=function(t,e){var n;return"function"==(n=typeof t)||"undefined"===n?(e=t,t={}):t={data:t},this.loadWithOptions(t,e)},t.loadWithOptions=function(t,e){return this.fire("loading",t),this._doStorageOperation("readAll",t,r(function(t,n,r){var o;return null!=t?(this.fire("error",t),"function"==typeof e?e(t,[]):void 0):(o=this._mapIdentities(n),this.fire("loaded",o,r),"function"==typeof e?e(t,o,r):void 0)},this))},t.create=function(t,e){var n,r;return e||(r=[{},t],t=r[0],e=r[1]),n=new this(t),n.save(e),n},t.findOrCreate=function(t,e){var n,r;return r=new this(t),r.isNew()?r.save(e):(n=this._mapIdentity(r),e(void 0,n)),r},t.createFromJSON=function(t){var e;return e=new this,e._withoutDirtyTracking(function(){return this.fromJSON(t)}),this._mapIdentity(e)},t._mapIdentity=function(t){return this._mapIdentities([t])[0]},t._mapIdentities=function(t){var e,n,r,o,i,a,s,u;for(o=[],r=0,a=t.length;a>r;r++)i=t[r],null!=(n=i.get("id"))&&((e=null!=(s=this.get("loaded.indexedBy.id").get(n))?s.toArray()[0]:void 0)?(e._withoutDirtyTracking(function(){var t;return this.updateAttributes((null!=(t=i.get("attributes"))?t.toObject():void 0)||{})}),t[r]=e):o.push(i));return o.length&&(u=this.get("loaded")).add.apply(u,o),t},t._doStorageOperation=function(t,e,n){var r;return Batman.developer.assert(this.prototype.hasStorage(),"Can't "+t+" model "+Batman.functionName(this.constructor)+" without any storage adapters!"),r=this.prototype._batman.get("storage"),r.perform(t,this,e,n)},c=["find","load","create"],i=0,s=c.length;s>i;i++)o=c[i],t[o]=Batman.Property.wrapTrackingPrevention(t[o]);for(t.InstanceLifecycleStateMachine=function(){function t(){t.__super__.constructor.apply(this,arguments)}return e(t,Batman.DelegatingStateMachine),t.transitions({load:{from:["dirty","clean"],to:"loading"},create:{from:["dirty","clean"],to:"creating"},save:{from:["dirty","clean"],to:"saving"},destroy:{from:["dirty","clean"],to:"destroying"},failedValidation:{from:["saving","creating"],to:"dirty"},loaded:{loading:"clean"},created:{creating:"clean"},saved:{saving:"clean"},destroyed:{destroying:"destroyed"},set:{from:["dirty","clean"],to:"dirty"},error:{from:["saving","creating","loading","destroying"],to:"error"}}),t}(),t.accessor("lifecycle",function(){return this.lifecycle||(this.lifecycle=new Batman.Model.InstanceLifecycleStateMachine("clean",this))}),t.accessor("attributes",function(){return this.attributes||(this.attributes=new Batman.Hash)}),t.accessor("dirtyKeys",function(){return this.dirtyKeys||(this.dirtyKeys=new Batman.Hash)}),t.accessor("_dirtiedKeys",function(){return this._dirtiedKeys||(this._dirtiedKeys=new Batman.SimpleSet)}),t.accessor("errors",function(){return this.errors||(this.errors=new Batman.ErrorsSet)}),t.accessor("isNew",function(){return this.isNew()}),t.accessor("isDirty",function(){return this.isDirty()}),t.accessor(t.defaultAccessor={get:function(t){return Batman.getPath(this,["attributes",t])},set:function(t,e){return this._willSet(t)?this.get("attributes").set(t,e):this.get(t)},unset:function(t){return this.get("attributes").unset(t)}}),t.wrapAccessor("id",function(t){return{get:function(){var e;return e=this.constructor.primaryKey,"id"===e?t.get.apply(this,arguments):this.get(e)},set:function(e,n){var r,o;return"string"==typeof n&&null===n.match(/[^0-9]/)&&""+(r=parseInt(n,10))===n&&(n=r),o=this.constructor.primaryKey,"id"===o?(this._willSet(e),t.set.apply(this,arguments)):this.set(o,n)}}}),t.prototype.isNew=function(){return this.get("id")===void 0},t.prototype.isDirty=function(){return"dirty"===this.get("lifecycle.state")},t.prototype.updateAttributes=function(t){return this.mixin(t),this},t.prototype.toString=function(){return""+this.constructor.get("resourceName")+": "+this.get("id")},t.prototype.toParam=function(){return this.get("id")},t.prototype.toJSON=function(){var t,e;return e={},t=this._batman.get("encoders"),t&&!t.isEmpty()&&t.forEach(r(function(t,n){var r,o;return n.encode&&(o=this.get(t),o!==void 0&&(r=n.encode(o,t,e,this),r!==void 0))?e[n.as]=r:void 0},this)),e},t.prototype.fromJSON=function(t){var e,n,o,i;if(o={},e=this._batman.get("encoders"),e&&!e.isEmpty()&&e.some(function(t,e){return null!=e.decode}))e.forEach(r(function(e,n){return n.decode&&t[n.as]!==void 0?o[e]=n.decode(t[n.as],n.as,t,o,this):void 0},this));else for(n in t)i=t[n],o[n]=i;return"id"!==this.constructor.primaryKey&&(o.id=t[this.constructor.primaryKey]),Batman.developer["do"](r(function(){return!e||1>=e.length?Batman.developer.warn("Warning: Model "+Batman.functionName(this.constructor)+" has suspiciously few decoders!"):void 0},this)),this.mixin(o)},t.prototype.hasStorage=function(){return null!=this._batman.get("storage")},t.prototype.load=function(t,e){var n;return e?t={data:t}:(n=[{},t],t=n[0],e=n[1]),this.loadWithOptions(t,e)},t.prototype.loadWithOptions=function(t,e){var n,o,i;return o=0!==Object.keys(t).length,"destroying"===(i=this.get("lifecycle.state"))||"destroyed"===i?("function"==typeof e&&e(Error("Can't load a destroyed record!")),void 0):this.get("lifecycle").load()?(n=[],null!=e&&n.push(e),o||(this._currentLoad=n),this._doStorageOperation("read",t,r(function(t,e,r){var i,a,s;for(t?this.get("lifecycle").error():(this.get("lifecycle").loaded(),e=this.constructor._mapIdentity(e)),o||(this._currentLoad=null),a=0,s=n.length;s>a;a++)i=n[a],i(t,e,r)},this))):"loading"!==this.get("lifecycle.state")||o?"function"==typeof e?e(new Batman.StateMachine.InvalidTransitionError("Can't load while in state "+this.get("lifecycle.state"))):void 0:null!=e?this._currentLoad.push(e):void 0},t.prototype.save=function(t,e){var n,o,i,a,s,u;return e||(s=[{},t],t=s[0],e=s[1]),o=this.isNew(),u=o?["create","create","created"]:["save","update","saved"],i=u[0],a=u[1],n=u[2],this.get("lifecycle").startTransition(i)?this.validate(r(function(o,i){var s;return o||i.length?(this.get("lifecycle").failedValidation(),"function"==typeof e?e(o||i,this):void 0):(s=this.constructor._batman.get("associations"),this._withoutDirtyTracking(function(){var t;return null!=s?null!=(t=s.getByType("belongsTo"))?t.forEach(r(function(t){return t.apply(this)},this)):void 0:void 0}),this._doStorageOperation(a,{data:t},r(function(t,r,o){return t?t instanceof Batman.ErrorsSet?this.get("lifecycle").failedValidation():this.get("lifecycle").error():(this.get("dirtyKeys").clear(),this.get("_dirtiedKeys").clear(),s&&r._withoutDirtyTracking(function(){var e,n;return null!=(e=s.getByType("hasOne"))&&e.forEach(function(e){return e.apply(t,r)}),null!=(n=s.getByType("hasMany"))?n.forEach(function(e){return e.apply(t,r)}):void 0}),r=this.constructor._mapIdentity(r),this.get("lifecycle").startTransition(n)),"function"==typeof e?e(t,r||this,o):void 0},this)))},this)):"function"==typeof e?e(new Batman.StateMachine.InvalidTransitionError("Can't save while in state "+this.get("lifecycle.state"))):void 0},t.prototype.destroy=function(t,e){var n;return e||(n=[{},t],t=n[0],e=n[1]),this.get("lifecycle").destroy()?this._doStorageOperation("destroy",{data:t},r(function(t,n,r){return t?this.get("lifecycle").error():(this.constructor.get("loaded").remove(this),this.get("lifecycle").destroyed()),"function"==typeof e?e(t,n,r):void 0},this)):"function"==typeof e?e(new Batman.StateMachine.InvalidTransitionError("Can't destroy while in state "+this.get("lifecycle.state"))):void 0},t.prototype.validate=function(t){var e,n,r,o,i,a,s,u,c,p,l,h;if(r=this.get("errors"),r.clear(),s=this._batman.get("validators")||[],!s||0===s.length)return"function"==typeof t&&t(void 0,r),!0;for(n=s.reduce(function(t,e){return t+e.keys.length},0),o=function(){return 0===--n?"function"==typeof t?t(void 0,r):void 0:void 0},u=0,p=s.length;p>u;u++)for(a=s[u],h=a.keys,c=0,l=h.length;l>c;c++){i=h[c],e=[r,this,i,o];try{a.validator?a.validator.validateEach.apply(a.validator,e):a.callback.apply(a,e)}catch(d){"function"==typeof t&&t(d,r)}}},t.prototype.associationProxy=function(t){var e,n,r;return Batman.initializeObject(this),e=(n=this._batman).associationProxies||(n.associationProxies={}),e[r=t.label]||(e[r]=new t.proxyClass(t,this)),e[t.label]},t.prototype._willSet=function(t){return this._pauseDirtyTracking?!0:this.get("lifecycle").startTransition("set")?(this.get("_dirtiedKeys").has(t)||(this.set("dirtyKeys."+t,this.get(t)),this.get("_dirtiedKeys").add(t)),!0):!1},t.prototype._doStorageOperation=function(t,e,n){var o;return Batman.developer.assert(this.hasStorage(),"Can't "+t+" model "+Batman.functionName(this.constructor)+" without any storage adapters!"),o=this._batman.get("storage"),o.perform(t,this,e,r(function(){return n.apply(null,arguments)},this))},t.prototype._withoutDirtyTracking=function(t){var e;return this._pauseDirtyTracking=!0,e=t.call(this),this._pauseDirtyTracking=!1,e},p=["load","save","validate","destroy"],a=0,u=p.length;u>a;a++)o=p[a],t.prototype[o]=Batman.Property.wrapTrackingPrevention(t.prototype[o]);return t}.call(this)}.call(this),function(){var t,e,n,r,o,i=function(t,e){return function(){return t.apply(e,arguments)}};for(o=Batman.AssociationCurator.availableAssociations,e=i(function(t){return Batman.Model[t]=function(e,n){var r,o;return Batman.initializeObject(this),r=(o=this._batman).associations||(o.associations=new Batman.AssociationCurator(this)),r.add(new(Batman[""+Batman.helpers.capitalize(t)+"Association"])(this,e,n))}},this),n=0,r=o.length;r>n;n++)t=o[n],e(t)}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.Proxy=function(){function t(e){t.__super__.constructor.call(this),null!=e&&this.set("target",e)}return e(t,Batman.Object),t.prototype.isProxy=!0,t.accessor("target",Batman.Property.defaultAccessor),t.accessor({get:function(t){var e;return null!=(e=this.get("target"))?e.get(t):void 0},set:function(t,e){var n;return null!=(n=this.get("target"))?n.set(t,e):void 0},unset:function(t){var e;return null!=(e=this.get("target"))?e.unset(t):void 0}}),t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=function(t,e){return function(){return t.apply(e,arguments)}};Batman.AssociationProxy=function(){function t(e,n){this.association=e,this.model=n,t.__super__.constructor.call(this)}return e(t,Batman.Proxy),t.prototype.loaded=!1,t.prototype.toJSON=function(){var t;return t=this.get("target"),null!=t?this.get("target").toJSON():void 0},t.prototype.load=function(t){return this.fetch(n(function(e,n){return e||this._setTarget(n),"function"==typeof t?t(e,n):void 0},this)),this.get("target")},t.prototype.loadFromLocal=function(){var t;if(this._canLoad())return(t=this.fetchFromLocal())&&this._setTarget(t),t},t.prototype.fetch=function(t){var e;return this._canLoad()?(e=this.fetchFromLocal(),e?t(void 0,e):this.fetchFromRemote(t)):t(void 0,void 0)},t.accessor("loaded",Batman.Property.defaultAccessor),t.accessor("target",{get:function(){return this.fetchFromLocal()},set:function(t,e){return e}}),t.prototype._canLoad=function(){return null!=(this.get("foreignValue")||this.get("primaryValue"))},t.prototype._setTarget=function(t){return this.set("target",t),this.set("loaded",!0),this.fire("loaded",t)},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=function(t,e){return function(){return t.apply(e,arguments)}};Batman.HasOneProxy=function(){function t(){t.__super__.constructor.apply(this,arguments)}return e(t,Batman.AssociationProxy),t.accessor("primaryValue",function(){return this.model.get(this.association.primaryKey)}),t.prototype.fetchFromLocal=function(){return this.association.setIndex().get(this.get("primaryValue"))},t.prototype.fetchFromRemote=function(t){var e;return e={data:{}},e.data[this.association.foreignKey]=this.get("primaryValue"),this.association.options.url&&(e.collectionUrl=this.association.options.url,e.urlContext=this.model),this.association.getRelatedModel().loadWithOptions(e,n(function(e,n){if(e)throw e;return!n||0>=n.length?t(Error("Couldn't find related record!"),void 0):t(void 0,n[0])},this))},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=function(t,e){return function(){return t.apply(e,arguments)}};Batman.BelongsToProxy=function(){function t(){t.__super__.constructor.apply(this,arguments)}return e(t,Batman.AssociationProxy),t.accessor("foreignValue",function(){return this.model.get(this.association.foreignKey)}),t.prototype.fetchFromLocal=function(){return this.association.setIndex().get(this.get("foreignValue"))},t.prototype.fetchFromRemote=function(t){var e;return e={},this.association.options.url&&(e.recordUrl=this.association.options.url),this.association.getRelatedModel().findWithOptions(this.get("foreignValue"),e,n(function(e,n){if(e)throw e;return t(void 0,n)},this))},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=function(t,e){return function(){return t.apply(e,arguments)}};Batman.PolymorphicBelongsToProxy=function(){function t(){t.__super__.constructor.apply(this,arguments)}return e(t,Batman.BelongsToProxy),t.accessor("foreignTypeValue",function(){return this.model.get(this.association.foreignTypeKey)}),t.prototype.fetchFromLocal=function(){return this.association.setIndexForType(this.get("foreignTypeValue")).get(this.get("foreignValue"))},t.prototype.fetchFromRemote=function(t){var e;return e={},this.association.options.url&&(e.recordUrl=this.association.options.url),this.association.getRelatedModelForType(this.get("foreignTypeValue")).findWithOptions(this.get("foreignValue"),e,n(function(e,n){if(e)throw e;return t(void 0,n)},this))},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.Accessible=function(){function t(){this.accessor.apply(this,arguments)}return e(t,Batman.Object),t}(),Batman.TerminalAccessible=function(){function t(){t.__super__.constructor.apply(this,arguments)}return e(t,Batman.Accessible),t.prototype.propertyClass=Batman.Property,t}()}.call(this),function(){Batman.mixins=new Batman.Object}.call(this),function(){Batman.URI=function(){function t(t){var n,r;for(r=h.exec(t),n=14;n--;)this[e[n]]=r[n]||"";this.queryParams=this.constructor.paramsFromQuery(this.query),delete this.authority,delete this.userInfo,delete this.relative,delete this.directory,delete this.file,delete this.query}var e,n,r,o,i,a,s,u,c,p,l,h;return h=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,e=["source","protocol","authority","userInfo","user","password","hostname","port","relative","path","directory","file","query","hash"],t.prototype.queryString=function(){return this.constructor.queryFromParams(this.queryParams)},t.prototype.toString=function(){return[this.protocol?""+this.protocol+":":void 0,this.authority()?"//":void 0,this.authority(),this.relative()].join("")},t.prototype.userInfo=function(){return[this.user,this.password?":"+this.password:void 0].join("")},t.prototype.authority=function(){return[this.userInfo(),this.user||this.password?"@":void 0,this.hostname,this.port?":"+this.port:void 0].join("")},t.prototype.relative=function(){var t;return t=this.queryString(),[this.path,t?"?"+t:void 0,this.hash?"#"+this.hash:void 0].join("")},t.prototype.directory=function(){var t;return t=this.path.split("/"),t.length>1?t.slice(0,t.length-1).join("/")+"/":""},t.prototype.file=function(){var t;return t=this.path.split("/"),t[t.length-1]},t.paramsFromQuery=function(t){var e,n,o,i,s,c;for(n={},c=t.split("&"),i=0,s=c.length;s>i;i++)o=c[i],(e=o.match(a))?u(n,r(e[1]),r(e[2])):u(n,r(o),null);return n},t.decodeQueryComponent=r=function(t){return decodeURIComponent(t.replace(c,"%20"))},s=/^[\[\]]*([^\[\]]+)\]*(.*)/,n=[/^\[\]\[([^\[\]]+)\]$/,/^\[\](.+)$/],c=/\+/g,l=/%20/g,a=/^([^=]*)=(.*)/,u=function(t,e,r){var o,i,a,c,p,l,h,d;if(p=e.match(s)){if(a=p[1],o=p[2],""===o)t[a]=r;else if("[]"===o){if(null==(l=t[a])&&(t[a]=[]),"Array"!==Batman.typeOf(t[a]))throw Error("expected Array (got "+Batman.typeOf(t[a])+') for param "'+a+'"');t[a].push(r)}else if(p=o.match(n[0])||o.match(n[1])){if(i=p[1],null==(h=t[a])&&(t[a]=[]),"Array"!==Batman.typeOf(t[a]))throw Error("expected Array (got "+Batman.typeOf(t[a])+') for param "'+a+'"');c=t[a][t[a].length-1],"Object"!==Batman.typeOf(c)||i in c?t[a].push(u({},i,r)):u(c,i,r)}else{if(null==(d=t[a])&&(t[a]={}),"Object"!==Batman.typeOf(t[a]))throw Error("expected Object (got "+Batman.typeOf(t[a])+') for param "'+a+'"');t[a]=u(t[a],o,r)}return t}},t.queryFromParams=p=function(t,e){var n,r,o,a;if(null==t)return e;if(a=Batman.typeOf(t),null==e&&"Object"!==a)throw Error("value must be an Object");switch(a){case"Array":return function(){var r,i;if(n=[],0===t.length)n.push(p(null,""+e+"[]"));else for(r=0,i=t.length;i>r;r++)o=t[r],n.push(p(o,""+e+"[]"));return n}().join("&");case"Object":return function(){var n;n=[];for(r in t)o=t[r],n.push(p(o,e?""+e+"["+i(r)+"]":i(r)));return n}().join("&");default:return null!=e?""+e+"="+i(t):i(t)}},t.encodeComponent=o=function(t){return null!=t?encodeURIComponent(t):""},t.encodeQueryComponent=i=function(t){return o(t).replace(l,"+")},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.Request=function(){function t(e){var n,r,o,i;r={};for(o in e)n=e[o],("success"===o||"error"===o||"loading"===o||"loaded"===o)&&(r[o]=n,delete e[o]);t.__super__.constructor.call(this,e);for(o in r)n=r[o],this.on(o,n);(null!=(i=this.get("url"))?i.length:void 0)>0?this.autosend&&this.send():this.observe("url",function(t){return null!=t?this.send():void 0})}var n;return e(t,Batman.Object),t.objectToFormData=function(t){var e,n,r,o,i,a,s,u;for(r=function(t,e,n){var o,i,a;return null==n&&(n=!1),e instanceof Batman.container.File?[[t,e]]:i=function(){switch(Batman.typeOf(e)){case"Object":return i=function(){var i;i=[];for(o in e)a=e[o],i.push(r(n?o:""+t+"["+o+"]",a));return i}(),i.reduce(function(t,e){return t.concat(e)},[]);case"Array":return e.reduce(function(e,n){return e.concat(r(""+t+"[]",n))},[]);default:return[[t,null!=e?e:""]]}}()},e=new Batman.container.FormData,s=r("",t,!0),i=0,a=s.length;a>i;i++)u=s[i],n=u[0],o=u[1],e.append(n,o);return e},t.dataHasFileUploads=n=function(t){var e,r,o,i,a;if("undefined"!=typeof File&&null!==File&&t instanceof File)return!0;switch(r=Batman.typeOf(t)){case"Object":for(e in t)if(o=t[e],n(o))return!0;break;case"Array":for(i=0,a=t.length;a>i;i++)if(o=t[i],n(o))return!0}return!1},t.wrapAccessor("method",function(t){return{set:function(e,n){return t.set.call(this,e,null!=n?"function"==typeof n.toUpperCase?n.toUpperCase():void 0:void 0)}}}),t.prototype.method="GET",t.prototype.hasFileUploads=function(){return n(this.data)},t.prototype.contentType="application/x-www-form-urlencoded",t.prototype.autosend=!0,t.prototype.send=function(){return Batman.developer.error("Please source a dependency file for a request implementation")},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=Array.prototype.slice,r=function(t,e){return function(){return t.apply(e,arguments)}};Batman.SetObserver=function(){function t(t){this.base=t,this._itemObservers=new Batman.SimpleHash,this._setObservers=new Batman.SimpleHash,this._setObservers.set("itemsWereAdded",r(function(){return this.fire.apply(this,["itemsWereAdded"].concat(n.call(arguments)))},this)),this._setObservers.set("itemsWereRemoved",r(function(){return this.fire.apply(this,["itemsWereRemoved"].concat(n.call(arguments)))},this)),this.on("itemsWereAdded",this.startObservingItems.bind(this)),this.on("itemsWereRemoved",this.stopObservingItems.bind(this))}return e(t,Batman.Object),t.prototype.observedItemKeys=[],t.prototype.observerForItemAndKey=function(){},t.prototype._getOrSetObserverForItemAndKey=function(t,e){return this._itemObservers.getOrSet(t,r(function(){var n;return n=new Batman.SimpleHash,n.getOrSet(e,r(function(){return this.observerForItemAndKey(t,e)},this))},this))},t.prototype.startObserving=function(){return this._manageItemObservers("observe"),this._manageSetObservers("addHandler")},t.prototype.stopObserving=function(){return this._manageItemObservers("forget"),this._manageSetObservers("removeHandler")},t.prototype.startObservingItems=function(){var t,e,r,o,i;for(e=arguments.length>=1?n.call(arguments,0):[],i=[],r=0,o=e.length;o>r;r++)t=e[r],i.push(this._manageObserversForItem(t,"observe"));return i},t.prototype.stopObservingItems=function(){var t,e,r,o,i;for(e=arguments.length>=1?n.call(arguments,0):[],i=[],r=0,o=e.length;o>r;r++)t=e[r],i.push(this._manageObserversForItem(t,"forget"));return i},t.prototype._manageObserversForItem=function(t,e){var n,r,o,i;if(t.isObservable){for(i=this.observedItemKeys,r=0,o=i.length;o>r;r++)n=i[r],t[e](n,this._getOrSetObserverForItemAndKey(t,n));return"forget"===e?this._itemObservers.unset(t):void 0}},t.prototype._manageItemObservers=function(t){return this.base.forEach(r(function(e){return this._manageObserversForItem(e,t)},this))},t.prototype._manageSetObservers=function(t){return this.base.isObservable?this._setObservers.forEach(r(function(e,n){return this.base.event(e)[t](n)},this)):void 0},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=function(t,e){return function(){return t.apply(e,arguments)}};Batman.SetSort=function(){function t(e,r,o){var i;this.key=r,null==o&&(o="asc"),t.__super__.constructor.call(this,e),this.descending="desc"===o.toLowerCase(),this.base.isObservable&&(this._setObserver=new Batman.SetObserver(this.base),this._setObserver.observedItemKeys=[this.key],i=n(function(){return this._reIndex()},this),this._setObserver.observerForItemAndKey=function(){return i},this._setObserver.on("itemsWereAdded",i),this._setObserver.on("itemsWereRemoved",i),this.startObserving()),this._reIndex()}return e(t,Batman.SetProxy),t.prototype.startObserving=function(){var t;return null!=(t=this._setObserver)?t.startObserving():void 0},t.prototype.stopObserving=function(){var t;return null!=(t=this._setObserver)?t.stopObserving():void 0},t.prototype.toArray=function(){return this.get("_storage")},t.prototype.forEach=function(t,e){var n,r,o,i,a;for(i=this.get("_storage"),a=[],r=0,o=i.length;o>r;r++)n=i[r],a.push(t.call(e,n,r,this));return a},t.prototype.find=function(t){var e,n,r,o;for(this.base.registerAsMutableSource(),o=this.get("_storage"),n=0,r=o.length;r>n;n++)if(e=o[n],t(e))return e},t.prototype.merge=function(t){return this.base.registerAsMutableSource(),function(t,e,n){n.prototype=t.prototype;var r=new n,o=t.apply(r,e);return"object"==typeof o?o:r}(Batman.Set,this._storage,function(){}).merge(t).sortedBy(this.key,this.order)},t.prototype.compare=function(t,e){return t===e?0:void 0===t?1:void 0===e?-1:null===t?1:null===e?-1:t===!1?1:e===!1?-1:t===!0?1:e===!0?-1:t!==t?e!==e?0:1:e!==e?-1:t>e?1:e>t?-1:0},t.prototype._reIndex=function(){var t,e;return t=this.base.toArray().sort(n(function(t,e){var n,r,o;return r=Batman.get(t,this.key),"function"==typeof r&&(r=r.call(t)),null!=r&&(r=r.valueOf()),o=Batman.get(e,this.key),"function"==typeof o&&(o=o.call(e)),null!=o&&(o=o.valueOf()),n=this.descending?-1:1,this.compare.call(this,r,o)*n},this)),null!=(e=this._setObserver)&&e.startObservingItems.apply(e,t),this.set("_storage",t)},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=function(t,e){return function(){return t.apply(e,arguments)}};Batman.AssociationSet=function(){function t(e,n){var r;this.foreignKeyValue=e,this.association=n,r=new Batman.Set,t.__super__.constructor.call(this,r,"_batmanID")}return e(t,Batman.SetSort),t.prototype.loaded=!1,t.prototype.load=function(t){return null==this.foreignKeyValue?t(void 0,this):this.association.getRelatedModel().loadWithOptions(this._getLoadOptions(),n(function(e){return e||this.markAsLoaded(),t(e,this)
},this))},t.prototype._getLoadOptions=function(){var t;return t={data:{}},t.data[this.association.foreignKey]=this.foreignKeyValue,this.association.options.url&&(t.collectionUrl=this.association.options.url,t.urlContext=this.association.parentSetIndex().get(this.foreignKeyValue)),t},t.accessor("loaded",Batman.Property.defaultAccessor),t.prototype.markAsLoaded=function(){return this.set("loaded",!0),this.fire("loaded")},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.PolymorphicAssociationSet=function(){function t(e,n,r){this.foreignKeyValue=e,this.foreignTypeKeyValue=n,this.association=r,t.__super__.constructor.call(this,this.foreignKeyValue,this.association)}return e(t,Batman.AssociationSet),t.prototype._getLoadOptions=function(){var t;return t={data:{}},t.data[this.association.foreignKey]=this.foreignKeyValue,t.data[this.association.foreignTypeKey]=this.foreignTypeKeyValue,this.association.options.url&&(t.collectionUrl=this.association.options.url,t.urlContext=this.association.parentSetIndex().get(this.foreignKeyValue)),t},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=Array.prototype.slice,r=function(t,e){return function(){return t.apply(e,arguments)}};Batman.SetIndex=function(){function t(e,o){this.base=e,this.key=o,t.__super__.constructor.call(this),this._storage=new Batman.Hash,this.base.isEventEmitter&&(this._setObserver=new Batman.SetObserver(this.base),this._setObserver.observedItemKeys=[this.key],this._setObserver.observerForItemAndKey=this.observerForItemAndKey.bind(this),this._setObserver.on("itemsWereAdded",r(function(){var t,e,r,o,i;for(e=arguments.length>=1?n.call(arguments,0):[],i=[],r=0,o=e.length;o>r;r++)t=e[r],i.push(this._addItem(t));return i},this)),this._setObserver.on("itemsWereRemoved",r(function(){var t,e,r,o,i;for(e=arguments.length>=1?n.call(arguments,0):[],i=[],r=0,o=e.length;o>r;r++)t=e[r],i.push(this._removeItem(t));return i},this))),this.base.forEach(this._addItem.bind(this)),this.startObserving()}return e(t,Batman.Object),t.accessor("toArray",function(){return this.toArray()}),Batman.extend(t.prototype,Batman.Enumerable),t.prototype.propertyClass=Batman.Property,t.accessor(function(t){return this._resultSetForKey(t)}),t.prototype.startObserving=function(){var t;return null!=(t=this._setObserver)?t.startObserving():void 0},t.prototype.stopObserving=function(){var t;return null!=(t=this._setObserver)?t.stopObserving():void 0},t.prototype.observerForItemAndKey=function(t){return r(function(e,n){return this._removeItemFromKey(t,n),this._addItemToKey(t,e)},this)},t.prototype.forEach=function(t,e){return this._storage.forEach(r(function(n,r){return r.get("length")>0?t.call(e,n,r,this):void 0},this))},t.prototype.toArray=function(){var t;return t=[],this._storage.forEach(function(e,n){return n.get("length")>0?t.push(e):void 0}),t},t.prototype._addItem=function(t){return this._addItemToKey(t,this._keyForItem(t))},t.prototype._addItemToKey=function(t,e){return this._resultSetForKey(e).add(t)},t.prototype._removeItem=function(t){return this._removeItemFromKey(t,this._keyForItem(t))},t.prototype._removeItemFromKey=function(t,e){return this._resultSetForKey(e).remove(t)},t.prototype._resultSetForKey=function(t){return this._storage.getOrSet(t,function(){return new Batman.Set})},t.prototype._keyForItem=function(t){return Batman.Keypath.forBaseAndKey(t,this.key).getValue()},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.PolymorphicAssociationSetIndex=function(){function t(e,n,r){this.association=e,this.type=n,t.__super__.constructor.call(this,this.association.getRelatedModel().get("loaded"),r)}return e(t,Batman.SetIndex),t.prototype._resultSetForKey=function(t){return this.association.setForKey(t)},t.prototype._addItem=function(e){return this.association.modelType()===e.get(this.association.foreignTypeKey)?t.__super__._addItem.apply(this,arguments):void 0},t.prototype._removeItem=function(e){return this.association.modelType()===e.get(this.association.foreignTypeKey)?t.__super__._removeItem.apply(this,arguments):void 0},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=function(t,e){return function(){return t.apply(e,arguments)}};Batman.AssociationSetIndex=function(){function t(e,n){this.association=e,t.__super__.constructor.call(this,this.association.getRelatedModel().get("loaded"),n)}return e(t,Batman.SetIndex),t.prototype._resultSetForKey=function(t){return this.association.setForKey(t)},t.prototype.forEach=function(t,e){return this.association.proxies.forEach(n(function(n,r){var o;return o=this.association.indexValueForRecord(n),r.get("length")>0?t.call(e,o,r,this):void 0},this))},t.prototype.toArray=function(){var t;return t=[],this.forEach(function(e){return t.push(e)}),t},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.UniqueSetIndex=function(){function t(){this._uniqueIndex=new Batman.Hash,t.__super__.constructor.apply(this,arguments)}return e(t,Batman.SetIndex),t.accessor(function(t){return this._uniqueIndex.get(t)}),t.prototype._addItemToKey=function(t,e){return this._resultSetForKey(e).add(t),this._uniqueIndex.hasKey(e)?void 0:this._uniqueIndex.set(e,t)},t.prototype._removeItemFromKey=function(e,n){var r;return r=this._resultSetForKey(n),t.__super__._removeItemFromKey.apply(this,arguments),r.isEmpty()?this._uniqueIndex.unset(n):this._uniqueIndex.set(n,r.toArray()[0])},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.UniqueAssociationSetIndex=function(){function t(e,n){this.association=e,t.__super__.constructor.call(this,this.association.getRelatedModel().get("loaded"),n)}return e(t,Batman.UniqueSetIndex),t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.PolymorphicUniqueAssociationSetIndex=function(){function t(e,n,r){this.association=e,this.type=n,t.__super__.constructor.call(this,this.association.getRelatedModelForType(n).get("loaded"),r)}return e(t,Batman.UniqueSetIndex),t}()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=Array.prototype.slice;Batman.Navigator=function(){function n(e){this.app=e,this.handleCurrentLocation=t(this.handleCurrentLocation,this)}return n.forApp=function(t){return new(this.defaultClass())(t)},n.defaultClass=function(){return Batman.config.usePushState&&Batman.PushStateNavigator.isSupported()?Batman.PushStateNavigator:Batman.HashbangNavigator},n.prototype.start=function(){return"undefined"==typeof window||this.started?void 0:(this.started=!0,this.startWatching(),Batman.currentApp.prevent("ready"),Batman.setImmediate(t(function(){return this.started&&Batman.currentApp?(this.checkInitialHash(),this.handleCurrentLocation(),Batman.currentApp.allowAndFire("ready")):void 0},this)))},n.prototype.stop=function(){return this.stopWatching(),this.started=!1},n.prototype.checkInitialHash=function(t){var e,n,r;return null==t&&(t=window.location),r=Batman.HashbangNavigator.prototype.hashPrefix,e=t.hash,e.length>r.length&&e.substr(0,r.length)!==r?this.initialHash=e.substr(r.length-1):-1!==(n=e.indexOf("##BATMAN##"))?(this.initialHash=e.substr(n+10),this.replaceState(null,"",e.substr(r.length,n-r.length),t)):void 0},n.prototype.handleCurrentLocation=function(){return this.handleLocation(window.location)},n.prototype.handleLocation=function(t){var e;return e=this.pathFromLocation(t),e!==this.cachedPath?this.dispatch(e):void 0},n.prototype.dispatch=function(t){var e,n;return e=this.app.get("dispatcher"),this.cachedPath=this.initialHash?(n={initialHash:this.initialHash},delete this.initialHash,e.dispatch(t,n)):e.dispatch(t),this._lastRedirect&&(this.cachedPath=this._lastRedirect),this.cachedPath},n.prototype.redirect=function(t,e){var n,r,o;return null==e&&(e=!1),r="function"==typeof(o=this.app.get("dispatcher")).pathFromParams?o.pathFromParams(t):void 0,r&&(this._lastRedirect=r),n=this.dispatch(t),this._lastRedirect&&this._lastRedirect!==n||this[e?"replaceState":"pushState"](null,"",n),n},n.prototype.push=function(t){return Batman.developer.deprecated("Navigator::push","Please use Batman.redirect({}) instead."),this.redirect(t)},n.prototype.replace=function(t){return Batman.developer.deprecated("Navigator::replace","Please use Batman.redirect({}, true) instead."),this.redirect(t,!0)},n.prototype.normalizePath=function(){var t,n,r;return r=arguments.length>=1?e.call(arguments,0):[],r=function(){var e,o;for(o=[],t=0,e=r.length;e>t;t++)n=r[t],o.push((""+n).replace(/^(?!\/)/,"/").replace(/\/+$/,""));return o}(),r.join("")||"/"},n.normalizePath=n.prototype.normalizePath,n}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.PushStateNavigator=function(){function t(){t.__super__.constructor.apply(this,arguments)}return e(t,Batman.Navigator),t.isSupported=function(){var t;return null!=("undefined"!=typeof window&&null!==window?null!=(t=window.history)?t.pushState:void 0:void 0)},t.prototype.startWatching=function(){return Batman.DOM.addEventListener(window,"popstate",this.handleCurrentLocation)},t.prototype.stopWatching=function(){return Batman.DOM.removeEventListener(window,"popstate",this.handleCurrentLocation)},t.prototype.pushState=function(t,e,n){return n!==this.pathFromLocation(window.location)?window.history.pushState(t,e,this.linkTo(n)):void 0},t.prototype.replaceState=function(t,e,n){return n!==this.pathFromLocation(window.location)?window.history.replaceState(t,e,this.linkTo(n)):void 0},t.prototype.linkTo=function(t){return this.normalizePath(Batman.config.pathToApp,t)},t.prototype.pathFromLocation=function(t){var e,n;return e=""+(t.pathname||"")+(t.search||""),n=RegExp("^"+this.normalizePath(Batman.config.pathToApp)),this.normalizePath(e.replace(n,""))},t.prototype.handleLocation=function(e){var n,r;return r=this.pathFromLocation(e),n=Batman.HashbangNavigator.prototype.pathFromLocation(e),"/"===r&&"/"!==n?this.redirect(n,!0):t.__super__.handleLocation.apply(this,arguments)},t}()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=Object.prototype.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.HashbangNavigator=function(){function e(){this.detectHashChange=t(this.detectHashChange,this),this.handleHashChange=t(this.handleHashChange,this),e.__super__.constructor.apply(this,arguments)}return n(e,Batman.Navigator),e.prototype.hashPrefix="#!","undefined"!=typeof window&&null!==window&&"onhashchange"in window?(e.prototype.startWatching=function(){return Batman.DOM.addEventListener(window,"hashchange",this.handleHashChange)},e.prototype.stopWatching=function(){return Batman.DOM.removeEventListener(window,"hashchange",this.handleHashChange)}):(e.prototype.startWatching=function(){return this.interval=setInterval(this.detectHashChange,100)},e.prototype.stopWatching=function(){return this.interval=clearInterval(this.interval)}),e.prototype.handleHashChange=function(){return this.ignoreHashChange?this.ignoreHashChange=!1:this.handleCurrentLocation()},e.prototype.detectHashChange=function(){return this.previousHash!==window.location.hash?(this.previousHash=window.location.hash,this.handleHashChange()):void 0},e.prototype.pushState=function(t,e,n){var r;return r=this.linkTo(n),r!==window.location.hash?(this.ignoreHashChange=!0,window.location.hash=r):void 0},e.prototype.replaceState=function(t,e,n,r){var o;return null==r&&(r=window.location),o=this.linkTo(n),o!==r.hash?(this.ignoreHashChange=!0,r.replace(""+(r.pathname||"")+(r.search||"")+(o||""))):void 0},e.prototype.linkTo=function(t){return this.hashPrefix+t},e.prototype.pathFromLocation=function(t){var e,n;return e=t.hash,n=this.hashPrefix.length,(null!=e?e.substr(0,n):void 0)===this.hashPrefix?this.normalizePath(e.substr(n)):"/"},e.prototype.handleLocation=function(t){var n;return Batman.config.usePushState?(n=Batman.PushStateNavigator.prototype.pathFromLocation(t),"/"!==n?t.replace(this.normalizePath(""+Batman.config.pathToApp+this.linkTo(n)+(this.initialHash?"##BATMAN##"+this.initialHash:""))):e.__super__.handleLocation.apply(this,arguments)):e.__super__.handleLocation.apply(this,arguments)},e}()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};Batman.RouteMap=function(){function e(){this.childrenByOrder=[],this.childrenByName={}}return e.prototype.memberRoute=null,e.prototype.collectionRoute=null,e.prototype.routeForParams=function(t){var e,n,r,o;for(o=this.childrenByOrder,n=0,r=o.length;r>n;n++)if(e=o[n],e.test(t))return e},e.prototype.addRoute=function(e,n){var r,o;return this.childrenByOrder.push(n),e.length>0&&(o=e.split(".")).length>0?(r=o.shift(),this.childrenByName[r]||(this.childrenByName[r]=new Batman.RouteMap),this.childrenByName[r].addRoute(o.join("."),n)):n.get("member")?(Batman.developer["do"](t(function(){return this.memberRoute?Batman.developer.error("Member route with name "+e+" already exists!"):void 0},this)),this.memberRoute=n):(Batman.developer["do"](t(function(){return this.collectionRoute?Batman.developer.error("Collection route with name "+e+" already exists!"):void 0},this)),this.collectionRoute=n),!0},e}()}.call(this),function(){var t=Array.prototype.slice;Batman.RouteMapBuilder=function(){function e(t,e,n,r){this.app=t,this.routeMap=e,this.parent=n,this.baseOptions=null!=r?r:{},this.parent?(this.rootPath=this.parent._nestingPath(),this.rootName=this.parent._nestingName()):(this.rootPath="",this.rootName="")}return e.BUILDER_FUNCTIONS=["resources","member","collection","route","root"],e.ROUTES={index:{cardinality:"collection",path:function(t){return t},name:function(t){return t}},"new":{cardinality:"collection",path:function(t){return""+t+"/new"},name:function(t){return""+t+".new"}},show:{cardinality:"member",path:function(t){return""+t+"/:id"},name:function(t){return t}},edit:{cardinality:"member",path:function(t){return""+t+"/:id/edit"},name:function(t){return""+t+".edit"}},collection:{cardinality:"collection",path:function(t,e){return""+t+"/"+e},name:function(t,e){return""+t+"."+e}},member:{cardinality:"member",path:function(t,e){return""+t+"/:id/"+e},name:function(t,e){return""+t+"."+e}}},e.prototype.resources=function(){var e,n,r,o,i,a,s,u,c,p,l,h,d,f,y,m,g,v,_,B,b,O,w,A,x,S;if(o=arguments.length>=1?t.call(arguments,0):[],f=function(){var t,e,n;for(n=[],t=0,e=o.length;e>t;t++)r=o[t],"string"==typeof r&&n.push(r);return n}(),"function"==typeof o[o.length-1]&&(a=o.pop()),l="object"==typeof o[o.length-1]?o.pop():{},n={index:!0,"new":!0,show:!0,edit:!0},l.except){for(x=l.except,_=0,O=x.length;O>_;_++)p=x[_],n[p]=!1;delete l.except}else if(l.only){for(p in n)v=n[p],n[p]=!1;for(S=l.only,B=0,w=S.length;w>B;B++)p=S[B],n[p]=!0;delete l.only}for(b=0,A=f.length;A>b;b++){d=f[b],y=Batman.helpers.pluralize(d),u=Batman.helpers.camelize(y,!0),s=this._childBuilder({controller:u}),null!=a&&a.call(s);for(e in n)c=n[e],c&&(g=this.constructor.ROUTES[e],i=g.name(y),h=g.path(y),m=Batman.extend({controller:u,action:e,path:h,as:i},l),s[g.cardinality](e,m))}return!0},e.prototype.member=function(){return this._addRoutesWithCardinality.apply(this,["member"].concat(t.call(arguments)))},e.prototype.collection=function(){return this._addRoutesWithCardinality.apply(this,["collection"].concat(t.call(arguments)))},e.prototype.root=function(t,e){return this.route("/",t,e)},e.prototype.route=function(t,e,n,r){return r||("function"==typeof n?(r=n,n=void 0):"function"==typeof e&&(r=e,e=void 0)),n?e&&(n.signature=e):(n="string"==typeof e?{signature:e}:e,n||(n={})),r&&(n.callback=r),n.as||(n.as=this._nameFromPath(t)),n.path=t,this._addRoute(n)},e.prototype._addRoutesWithCardinality=function(){var e,n,r,o,i,a,s,u,c,p;for(e=arguments[0],r=arguments.length>=3?t.call(arguments,1,u=arguments.length-1):(u=1,[]),o=arguments[u++],"string"==typeof o&&(r.push(o),o={}),o=Batman.extend({},this.baseOptions,o),o[e]=!0,s=this.constructor.ROUTES[e],i=Batman.helpers.underscore(o.controller),c=0,p=r.length;p>c;c++)n=r[c],a=Batman.extend({action:n},o),null==a.path&&(a.path=s.path(i,n)),null==a.as&&(a.as=s.name(i,n)),this._addRoute(a);return!0},e.prototype._addRoute=function(t){var e,n,r,o;return null==t&&(t={}),r=this.rootPath+t.path,n=this.rootName+Batman.helpers.camelize(t.as,!0),delete t.as,delete t.path,e=t.callback?Batman.CallbackActionRoute:Batman.ControllerActionRoute,t.app=this.app,o=new e(r,t),this.routeMap.addRoute(n,o)},e.prototype._nameFromPath=function(t){return t=t.replace(Batman.Route.regexps.namedOrSplat,"").replace(/\/+/g,".").replace(/(^\.)|(\.$)/g,"")},e.prototype._nestingPath=function(){var t,e;return this.parent?(t=":"+Batman.helpers.singularize(this.baseOptions.controller)+"Id",e=Batman.helpers.underscore(this.baseOptions.controller),""+this.parent._nestingPath()+e+"/"+t+"/"):""},e.prototype._nestingName=function(){return this.parent?this.parent._nestingName()+this.baseOptions.controller+".":""},e.prototype._childBuilder=function(t){return null==t&&(t={}),new Batman.RouteMapBuilder(this.app,this.routeMap,this,t)},e}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=Array.prototype.slice,r=function(t,e){return function(){return t.apply(e,arguments)}};Batman.App=function(){function t(){t.__super__.constructor.apply(this,arguments)}var o,i,a,s,u;for(e(t,Batman.Object),t.classAccessor("currentParams",{get:function(){return new Batman.Hash},"final":!0}),t.classAccessor("paramsManager",{get:function(){var t,e;if(t=this.get("navigator"))return e=this.get("currentParams"),e.replacer=new Batman.ParamsReplacer(t,e)},"final":!0}),t.classAccessor("paramsPusher",{get:function(){var t,e;if(t=this.get("navigator"))return e=this.get("currentParams"),e.pusher=new Batman.ParamsPusher(t,e)},"final":!0}),t.classAccessor("routes",function(){return new Batman.NamedRouteQuery(this.get("routeMap"))}),t.classAccessor("routeMap",function(){return new Batman.RouteMap}),t.classAccessor("routeMapBuilder",function(){return new Batman.RouteMapBuilder(this,this.get("routeMap"))}),t.classAccessor("dispatcher",function(){return new Batman.Dispatcher(this,this.get("routeMap"))}),t.classAccessor("controllers",function(){return this.get("dispatcher.controllers")}),t.classAccessor("_renderContext",function(){return Batman.RenderContext.base.descend(this)}),t.requirePath="",Batman.developer["do"](r(function(){var e;return e="Please use whatever means you'd like to load your code before calling App.run.",t.require=function(){var t,o,i,a,s,u;for(a=arguments[0],i=arguments.length>=2?n.call(arguments,1):[],Batman.developer.deprecated("App.require",e),t=this.requirePath+a,s=0,u=i.length;u>s;s++)o=i[s],this.prevent("run"),a=t+"/"+o+".coffee",new Batman.Request({url:a,type:"html",success:r(function(t){return CoffeeScript.eval(t),this.allow("run"),this.isPrevented("run")||this.fire("loaded"),this.wantsToRun?this.run():void 0},this)});return this},this.controller=function(){var t;return t=arguments.length>=1?n.call(arguments,0):[],Batman.developer.deprecated("App.controller",e),t=t.map(function(t){return t+"_controller"}),this.require.apply(this,["controllers"].concat(n.call(t)))},this.model=function(){return Batman.developer.deprecated("App.model",e),this.require.apply(this,["models"].concat(n.call(arguments)))},this.view=function(){return Batman.developer.deprecated("App.view",e),this.require.apply(this,["views"].concat(n.call(arguments)))}},t)),t.layout=void 0,t.shouldAllowEvent={},u=Batman.RouteMapBuilder.BUILDER_FUNCTIONS,i=r(function(t){return this[t]=function(){var e;return(e=this.get("routeMapBuilder"))[t].apply(e,arguments)}},t),a=0,s=u.length;s>a;a++)o=u[a],i(o);return t.event("ready").oneShot=!0,t.event("run").oneShot=!0,t.run=function(){var t,e;if(Batman.currentApp){if(Batman.currentApp===this)return;Batman.currentApp.stop()}return this.hasRun?!1:this.isPrevented("run")?(this.wantsToRun=!0,!1):(delete this.wantsToRun,Batman.currentApp=this,Batman.App.set("current",this),null==this.get("dispatcher")&&(this.set("dispatcher",new Batman.Dispatcher(this,this.get("routeMap"))),this.set("controllers",this.get("dispatcher.controllers"))),null==this.get("navigator")&&(this.set("navigator",Batman.Navigator.forApp(this)),this.on("run",r(function(){return Batman.navigator=this.get("navigator"),Object.keys(this.get("dispatcher").routeMap).length>0?Batman.navigator.start():void 0},this))),this.observe("layout",r(function(t){return null!=t?t.on("ready",r(function(){return this.fire("ready")},this)):void 0},this)),t=this.get("layout"),t?"string"==typeof t&&(e=this[Batman.helpers.camelize(t)+"View"]):null!==t&&(e=Batman.View),e&&(t=this.set("layout",new e({context:this,node:document}))),this.hasRun=!0,this.fire("run"),this)},t.event("ready").oneShot=!0,t.event("stop").oneShot=!0,t.stop=function(){var t;return null!=(t=this.navigator)&&t.stop(),Batman.navigator=null,this.hasRun=!1,this.fire("stop"),this},t}.call(this)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};Batman.Association=function(){function e(t,e,n){var r,o,i,a;this.model=t,this.label=e,null==n&&(n={}),r={namespace:Batman.currentApp,name:Batman.helpers.camelize(Batman.helpers.singularize(this.label))},this.options=Batman.extend(r,this.defaultOptions,n),this.options.nestUrl&&(null==this.model.urlNestsUnder&&Batman.developer.error("You must persist the the model "+this.model.constructor.name+" to use the url helpers on an association"),this.model.urlNestsUnder(Batman.helpers.underscore(this.getRelatedModel().get("resourceName")))),null!=this.options.extend&&Batman.extend(this,this.options.extend),o={encode:this.options.saveInline?this.encoder():!1,decode:this.decoder()},this.model.encode(this.label,o),a=this,i=function(){return a.getAccessor.call(this,a,this.model,this.label)},this.model.accessor(this.label,{get:i,set:t.defaultAccessor.set,unset:t.defaultAccessor.unset})}return e.prototype.associationType="",e.prototype.isPolymorphic=!1,e.prototype.defaultOptions={saveInline:!0,autoload:!0,nestUrl:!1},e.prototype.getRelatedModel=function(){var t,e,n;return n=this.options.namespace||Batman.currentApp,t=this.options.name,e=null!=n?n[t]:void 0,Batman.developer["do"](function(){return null==Batman.currentApp||e?void 0:Batman.developer.warn("Related model "+t+" hasn't loaded yet.")}),e},e.prototype.getFromAttributes=function(t){return t.get("attributes."+this.label)},e.prototype.setIntoAttributes=function(t,e){return t.get("attributes").set(this.label,e)},e.prototype.inverse=function(){var e,n;return(n=this.getRelatedModel()._batman.get("associations"))?this.options.inverseOf?n.getByLabel(this.options.inverseOf):(e=null,n.forEach(t(function(t,n){return n.getRelatedModel()===this.model?e=n:void 0},this)),e):void 0},e.prototype.reset=function(){return delete this.index,!0},e}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=function(t,e){return function(){return t.apply(e,arguments)}};Batman.PluralAssociation=function(){function t(){t.__super__.constructor.apply(this,arguments),this._resetSetHashes()}return e(t,Batman.Association),t.prototype.proxyClass=Batman.AssociationSet,t.prototype.isSingular=!1,t.prototype.setForRecord=function(t){var e,r;return r=this.indexValueForRecord(t),e=this.setIndex(),Batman.Property.withoutTracking(n(function(){return this._setsByRecord.getOrSet(t,n(function(){var t,e;return null!=r&&(t=this._setsByValue.get(r),null!=t)?t:(e=this.proxyClassInstanceForKey(r),null!=r&&this._setsByValue.set(r,e),e)},this))},this)),null!=r?e.get(r):this._setsByRecord.get(t)},t.prototype.setForKey=Batman.Property.wrapTrackingPrevention(function(t){var e;return e=void 0,this._setsByRecord.forEach(n(function(n,r){return null==e?this.indexValueForRecord(n)===t?e=r:void 0:void 0},this)),null!=e?(e.foreignKeyValue=t,e):this._setsByValue.getOrSet(t,n(function(){return this.proxyClassInstanceForKey(t)},this))}),t.prototype.proxyClassInstanceForKey=function(t){return new this.proxyClass(t,this)},t.prototype.getAccessor=function(t){var e,r;if(t.getRelatedModel())return(r=t.getFromAttributes(this))?r:(e=t.setForRecord(this),t.setIntoAttributes(this,e),Batman.Property.withoutTracking(n(function(){return!t.options.autoload||this.isNew()||e.loaded?void 0:e.load(function(t){if(t)throw t})},this)),e)},t.prototype.parentSetIndex=function(){return this.parentIndex||(this.parentIndex=this.model.get("loaded").indexedByUnique(this.primaryKey)),this.parentIndex},t.prototype.setIndex=function(){return this.index||(this.index=new Batman.AssociationSetIndex(this,this[this.indexRelatedModelOn])),this.index},t.prototype.indexValueForRecord=function(t){return t.get(this.primaryKey)},t.prototype.reset=function(){return t.__super__.reset.apply(this,arguments),this._resetSetHashes()},t.prototype._resetSetHashes=function(){return this._setsByRecord=new Batman.SimpleHash,this._setsByValue=new Batman.SimpleHash},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=function(t,e){return function(){return t.apply(e,arguments)}};Batman.HasManyAssociation=function(){function t(e,n,r){return(null!=r?r.as:void 0)?function(t,e,n){n.prototype=t.prototype;var r=new n,o=t.apply(r,e);return"object"==typeof o?o:r}(Batman.PolymorphicHasManyAssociation,arguments,function(){}):(t.__super__.constructor.apply(this,arguments),this.primaryKey=this.options.primaryKey||"id",this.foreignKey=this.options.foreignKey||""+Batman.helpers.underscore(e.get("resourceName"))+"_id",void 0)}return e(t,Batman.PluralAssociation),t.prototype.associationType="hasMany",t.prototype.indexRelatedModelOn="foreignKey",t.prototype.apply=function(t,e){var r,o;return t||((r=this.getFromAttributes(e))&&r.forEach(n(function(t){return t.set(this.foreignKey,e.get(this.primaryKey))},this)),e.set(this.label,o=this.setForRecord(e)),"creating"!==e.lifecycle.get("state"))?void 0:o.markAsLoaded()},t.prototype.encoder=function(){var t;return t=this,function(e,n,r,o){var i;return null!=e&&(i=[],e.forEach(function(e){var n;return n=e.toJSON(),(!t.inverse()||t.inverse().options.encodeForeignKey)&&(n[t.foreignKey]=o.get(t.primaryKey)),i.push(n)})),i}},t.prototype.decoder=function(){var t;return t=this,function(e,n,r,o,i){var a,s,u,c,p,l,h,d,f;if(l=t.getRelatedModel()){for(s=t.getFromAttributes(i)||t.setForRecord(i),c=s.filter(function(t){return t.isNew()}).toArray(),d=0,f=e.length;f>d;d++)u=e[d],p=new l,p._withoutDirtyTracking(function(){return this.fromJSON(u)}),a=l.get("loaded").indexedByUnique("id").get(p.get("id")),null!=a?(a._withoutDirtyTracking(function(){return this.fromJSON(u)}),p=a):c.length>0&&(h=c.shift(),h._withoutDirtyTracking(function(){return this.fromJSON(u)}),p=h),p=l._mapIdentity(p),s.add(p),t.options.inverseOf&&p.set(t.options.inverseOf,i);s.markAsLoaded()}else Batman.developer.error("Can't decode model "+t.options.name+" because it hasn't been loaded yet!");return s}},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=function(t,e){return function(){return t.apply(e,arguments)}};Batman.PolymorphicHasManyAssociation=function(){function t(e,n,r){r.inverseOf=this.foreignLabel=r.as,delete r.as,r.foreignKey||(r.foreignKey=""+this.foreignLabel+"_id"),t.__super__.constructor.call(this,e,n,r),this.foreignTypeKey=r.foreignTypeKey||""+this.foreignLabel+"_type",this.model.encode(this.foreignTypeKey)}return e(t,Batman.HasManyAssociation),t.prototype.proxyClass=Batman.PolymorphicAssociationSet,t.prototype.isPolymorphic=!0,t.prototype.apply=function(e,r){var o;return e||(o=this.getFromAttributes(r))&&(t.__super__.apply.apply(this,arguments),o.forEach(n(function(t){return t.set(this.foreignTypeKey,this.modelType())},this))),!0},t.prototype.proxyClassInstanceForKey=function(t){return new this.proxyClass(t,this.modelType(),this)},t.prototype.getRelatedModelForType=function(t){var e,n;return n=this.options.namespace||Batman.currentApp,t?(e=null!=n?n[t]:void 0,e||(e=null!=n?n[Batman.helpers.camelize(t)]:void 0)):e=this.getRelatedModel(),Batman.developer["do"](function(){return null==Batman.currentApp||e?void 0:Batman.developer.warn("Related model "+t+" for polymorphic association not found.")}),e},t.prototype.modelType=function(){return this.model.get("resourceName")},t.prototype.setIndex=function(){return this.typeIndex||(this.typeIndex=new Batman.PolymorphicAssociationSetIndex(this,this.modelType(),this[this.indexRelatedModelOn])),this.typeIndex},t.prototype.encoder=function(){var t;return t=this,function(e,n,r,o){var i;return null!=e&&(i=[],e.forEach(function(e){var n;return n=e.toJSON(),n[t.foreignKey]=o.get(t.primaryKey),n[t.foreignTypeKey]=t.modelType(),i.push(n)})),i}},t.prototype.decoder=function(){var t;return t=this,function(e,n,r,o,i){var a,s,u,c,p,l,h,d,f,y,m;if(l=t.getRelatedModel()){for(s=t.getFromAttributes(i)||t.setForRecord(i),c=s.filter(function(t){return t.isNew()}).toArray(),y=0,m=e.length;m>y;y++)u=e[y],f=u[t.options.foreignTypeKey],d=t.getRelatedModelForType(f),p=new d,p._withoutDirtyTracking(function(){return this.fromJSON(u)}),a=l.get("loaded").indexedByUnique("id").get(p.get("id")),null!=a?(a._withoutDirtyTracking(function(){return this.fromJSON(u)}),p=a):c.length>0&&(h=c.shift(),h._withoutDirtyTracking(function(){return this.fromJSON(u)}),p=h),p=l._mapIdentity(p),s.add(p),t.options.inverseOf&&p.set(t.options.inverseOf,i);s.markAsLoaded()}else Batman.developer.error("Can't decode model "+t.options.name+" because it hasn't been loaded yet!");return s}},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.SingularAssociation=function(){function t(){t.__super__.constructor.apply(this,arguments)}return e(t,Batman.Association),t.prototype.isSingular=!0,t.prototype.getAccessor=function(t){var e,n,r,o,i;return(o=t.getFromAttributes(this))?o:t.getRelatedModel()?(n=this.associationProxy(t),r=!1,e=this,null==(i=n._loadSetter)&&(n._loadSetter=n.once("loaded",function(n){return e._withoutDirtyTracking(function(){return this.set(t.label,n)
})})),Batman.Property.withoutTracking(function(){return n.get("loaded")})||(t.options.autoload?Batman.Property.withoutTracking(function(){return n.load()}):r=n.loadFromLocal()),r||n):void 0},t.prototype.setIndex=function(){return this.index||(this.index=new Batman.UniqueAssociationSetIndex(this,this[this.indexRelatedModelOn])),this.index},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.HasOneAssociation=function(){function t(){t.__super__.constructor.apply(this,arguments),this.primaryKey=this.options.primaryKey||"id",this.foreignKey=this.options.foreignKey||""+Batman.helpers.underscore(this.model.get("resourceName"))+"_id"}return e(t,Batman.SingularAssociation),t.prototype.associationType="hasOne",t.prototype.proxyClass=Batman.HasOneProxy,t.prototype.indexRelatedModelOn="foreignKey",t.prototype.apply=function(t,e){var n;return(n=this.getFromAttributes(e))?n.set(this.foreignKey,e.get(this.primaryKey)):void 0},t.prototype.encoder=function(){var t;return t=this,function(e,n,r,o){var i;if(t.options.saveInline)return(i=e.toJSON())&&(i[t.foreignKey]=o.get(t.primaryKey)),i}},t.prototype.decoder=function(){var t;return t=this,function(e,n,r,o,i){var a,s;if(e)return s=t.getRelatedModel(),a=s.createFromJSON(e),t.options.inverseOf&&a.set(t.options.inverseOf,i),a}},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.BelongsToAssociation=function(){function t(e,n,r){return(null!=r?r.polymorphic:void 0)?(delete r.polymorphic,function(t,e,n){n.prototype=t.prototype;var r=new n,o=t.apply(r,e);return"object"==typeof o?o:r}(Batman.PolymorphicBelongsToAssociation,arguments,function(){})):(t.__super__.constructor.apply(this,arguments),this.foreignKey=this.options.foreignKey||""+this.label+"_id",this.primaryKey=this.options.primaryKey||"id",this.options.encodeForeignKey&&this.model.encode(this.foreignKey),void 0)}return e(t,Batman.SingularAssociation),t.prototype.associationType="belongsTo",t.prototype.proxyClass=Batman.BelongsToProxy,t.prototype.indexRelatedModelOn="primaryKey",t.prototype.defaultOptions={saveInline:!1,autoload:!0,encodeForeignKey:!0},t.prototype.encoder=function(){return function(t){return t.toJSON()}},t.prototype.decoder=function(){var t;return t=this,function(e,n,r,o,i){var a,s,u;return u=t.getRelatedModel(),s=u.createFromJSON(e),t.options.inverseOf&&(a=t.inverse())&&(a instanceof Batman.HasManyAssociation?i.set(t.foreignKey,s.get(t.primaryKey)):s.set(a.label,i)),i.set(t.label,s),s}},t.prototype.apply=function(t){var e,n;return(n=t.get(this.label))&&(e=n.get(this.primaryKey),void 0!==e)?t.set(this.foreignKey,e):void 0},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=function(t,e){return function(){return t.apply(e,arguments)}};Batman.PolymorphicBelongsToAssociation=function(){function t(){t.__super__.constructor.apply(this,arguments),this.foreignTypeKey=this.options.foreignTypeKey||""+this.label+"_type",this.options.encodeForeignTypeKey&&this.model.encode(this.foreignTypeKey),this.typeIndicies={}}return e(t,Batman.BelongsToAssociation),t.prototype.isPolymorphic=!0,t.prototype.proxyClass=Batman.PolymorphicBelongsToProxy,t.prototype.defaultOptions=Batman.mixin({},Batman.BelongsToAssociation.prototype.defaultOptions,{encodeForeignTypeKey:!0}),t.prototype.getRelatedModel=!1,t.prototype.setIndex=!1,t.prototype.inverse=!1,t.prototype.apply=function(e){var n,r;return t.__super__.apply.apply(this,arguments),(r=e.get(this.label))?(n=r instanceof Batman.PolymorphicBelongsToProxy?r.get("foreignTypeValue"):r.constructor.get("resourceName"),e.set(this.foreignTypeKey,n)):void 0},t.prototype.getAccessor=function(t){var e,n;return(n=t.getFromAttributes(this))?n:t.getRelatedModelForType(this.get(t.foreignTypeKey))?(e=this.associationProxy(t),Batman.Property.withoutTracking(function(){return!e.get("loaded")&&t.options.autoload?e.load():void 0}),e):void 0},t.prototype.url=function(t){var e,n,r,o,i,a,s,u;return a=null!=(s=t.data)?s[this.foreignTypeKey]:void 0,a&&(o=this.inverseForType(a))?(i=Batman.helpers.pluralize(a).toLowerCase(),r=null!=(u=t.data)?u[this.foreignKey]:void 0,n=o.isSingular?"singularize":"pluralize",e=Batman.helpers[n](o.label),"/"+i+"/"+r+"/"+e):void 0},t.prototype.getRelatedModelForType=function(t){var e,n;return n=this.options.namespace||Batman.currentApp,t&&(e=null!=n?n[t]:void 0,e||(e=null!=n?n[Batman.helpers.camelize(t)]:void 0)),Batman.developer["do"](function(){return null==Batman.currentApp||e?void 0:Batman.developer.warn("Related model "+t+" for polymorphic association not found.")}),e},t.prototype.setIndexForType=function(t){var e;return(e=this.typeIndicies)[t]||(e[t]=new Batman.PolymorphicUniqueAssociationSetIndex(this,t,this.primaryKey)),this.typeIndicies[t]},t.prototype.inverseForType=function(t){var e,r,o;return(r=null!=(o=this.getRelatedModelForType(t))?o._batman.get("associations"):void 0)?this.options.inverseOf?r.getByLabel(this.options.inverseOf):(e=null,r.forEach(n(function(t,n){return n.getRelatedModel()===this.model?e=n:void 0},this)),e):void 0},t.prototype.decoder=function(){var t;return t=this,function(e,n,r,o,i){var a,s,u,c;return a=r[t.foreignTypeKey]||i.get(t.foreignTypeKey),c=t.getRelatedModelForType(a),u=c.createFromJSON(e),t.options.inverseOf&&(s=t.inverseForType(a))&&(s instanceof Batman.PolymorphicHasManyAssociation?(i.set(t.foreignKey,u.get(t.primaryKey)),i.set(t.foreignTypeKey,a)):u.set(s.label,i)),i.set(t.label,u),u}},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=Array.prototype.slice;Batman.Validator=function(){function t(){var e,r;r=arguments[0],e=arguments.length>=2?n.call(arguments,1):[],this.options=r,t.__super__.constructor.apply(this,e)}return e(t,Batman.Object),t.triggers=function(){var t;return t=arguments.length>=1?n.call(arguments,0):[],null!=this._triggers?this._triggers.concat(t):this._triggers=t},t.options=function(){var t;return t=arguments.length>=1?n.call(arguments,0):[],null!=this._options?this._options.concat(t):this._options=t},t.matches=function(t){var e,n,r,o,i,a;n={},r=!1;for(e in t)o=t[e],~(null!=(i=this._options)?i.indexOf(e):void 0)&&(n[e]=o),~(null!=(a=this._triggers)?a.indexOf(e):void 0)&&(n[e]=o,r=!0);return r?n:void 0},t.prototype.validate=function(){return Batman.developer.error("You must override validate in Batman.Validator subclasses.")},t.prototype.format=function(t,e,n){return Batman.t("errors.messages."+e,n)},t.prototype.handleBlank=function(t){return this.options.allowBlank&&!Batman.PresenceValidator.prototype.isPresent(t)?!0:void 0},t}()}.call(this),function(){Batman.Validators=[],Batman.extend(Batman.translate.messages,{errors:{format:"%{attribute} %{message}",messages:{too_short:"must be at least %{count} characters",too_long:"must be less than %{count} characters",wrong_length:"must be %{count} characters",blank:"can't be blank",not_numeric:"must be a number",greater_than:"must be greater than %{count}",greater_than_or_equal_to:"must be greater than or equal to %{count}",equal_to:"must be equal to %{count}",less_than:"must be less than %{count}",less_than_or_equal_to:"must be less than or equal to %{count}",not_matching:"is not valid",invalid_association:"is not valid",not_included_in_list:"is not included in the list",included_in_list:"is included in the list"}}})}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.RegExpValidator=function(){function t(e){var n;this.regexp=null!=(n=e.regexp)?n:e.pattern,t.__super__.constructor.apply(this,arguments)}return e(t,Batman.Validator),t.triggers("regexp","pattern"),t.options("allowBlank"),t.prototype.validateEach=function(t,e,n,r){var o;return o=e.get(n),this.handleBlank(o)?r():(null!=o&&""!==o&&this.regexp.test(o)||t.add(n,this.format(n,"not_matching")),r())},t}(),Batman.Validators.push(Batman.RegExpValidator)}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.PresenceValidator=function(){function t(){t.__super__.constructor.apply(this,arguments)}return e(t,Batman.Validator),t.triggers("presence"),t.prototype.validateEach=function(t,e,n,r){var o;return o=e.get(n),this.isPresent(o)||t.add(n,this.format(n,"blank")),r()},t.prototype.isPresent=function(t){return null!=t&&""!==t},t}(),Batman.Validators.push(Batman.PresenceValidator)}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.NumericValidator=function(){function t(){t.__super__.constructor.apply(this,arguments)}return e(t,Batman.Validator),t.triggers("numeric","greaterThan","greaterThanOrEqualTo","equalTo","lessThan","lessThanOrEqualTo"),t.options("allowBlank"),t.prototype.validateEach=function(t,e,n,r){var o,i;return o=this.options,i=e.get(n),this.handleBlank(i)?r():(null==i||!this.isNumeric(i)&&!this.canCoerceToNumeric(i)?t.add(n,this.format(n,"not_numeric")):(o.greaterThan&&o.greaterThan>=i&&t.add(n,this.format(n,"greater_than",{count:o.greaterThan})),o.greaterThanOrEqualTo&&o.greaterThanOrEqualTo>i&&t.add(n,this.format(n,"greater_than_or_equal_to",{count:o.greaterThanOrEqualTo})),o.equalTo&&i!==o.equalTo&&t.add(n,this.format(n,"equal_to",{count:o.equalTo})),o.lessThan&&i>=o.lessThan&&t.add(n,this.format(n,"less_than",{count:o.lessThan})),o.lessThanOrEqualTo&&i>o.lessThanOrEqualTo&&t.add(n,this.format(n,"less_than_or_equal_to",{count:o.lessThanOrEqualTo}))),r())},t.prototype.isNumeric=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},t.prototype.canCoerceToNumeric=function(t){return t-0==t&&t.length>0},t}(),Batman.Validators.push(Batman.NumericValidator)}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.LengthValidator=function(){function t(e){var n;(n=e.lengthIn||e.lengthWithin)&&(e.minLength=n[0],e.maxLength=n[1]||-1,delete e.lengthWithin,delete e.lengthIn),t.__super__.constructor.apply(this,arguments)}return e(t,Batman.Validator),t.triggers("minLength","maxLength","length","lengthWithin","lengthIn"),t.options("allowBlank"),t.prototype.validateEach=function(t,e,n,r){var o,i;return o=this.options,i=e.get(n),""!==i&&this.handleBlank(i)?r():(null==i&&(i=[]),o.minLength&&i.length<o.minLength&&t.add(n,this.format(n,"too_short",{count:o.minLength})),o.maxLength&&i.length>o.maxLength&&t.add(n,this.format(n,"too_long",{count:o.maxLength})),o.length&&i.length!==o.length&&t.add(n,this.format(n,"wrong_length",{count:o.length})),r())},t}(),Batman.Validators.push(Batman.LengthValidator)}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.InclusionValidator=function(){function t(e){this.acceptableValues=e.inclusion["in"],t.__super__.constructor.apply(this,arguments)}return e(t,Batman.Validator),t.triggers("inclusion"),t.prototype.validateEach=function(t,e,n,r){return-1===this.acceptableValues.indexOf(e.get(n))&&t.add(n,this.format(n,"not_included_in_list")),r()},t}(),Batman.Validators.push(Batman.InclusionValidator)}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.ExclusionValidator=function(){function t(e){this.unacceptableValues=e.exclusion["in"],t.__super__.constructor.apply(this,arguments)}return e(t,Batman.Validator),t.triggers("exclusion"),t.prototype.validateEach=function(t,e,n,r){return this.unacceptableValues.indexOf(e.get(n))>=0&&t.add(n,this.format(n,"included_in_list")),r()},t}(),Batman.Validators.push(Batman.ExclusionValidator)}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=function(t,e){return function(){return t.apply(e,arguments)}};Batman.AssociatedValidator=function(){function t(){t.__super__.constructor.apply(this,arguments)}return e(t,Batman.Validator),t.triggers("associated"),t.prototype.validateEach=function(t,e,r,o){var i,a,s;return s=e.get(r),null!=s?(s instanceof Batman.AssociationProxy&&(s="function"==typeof s.get?s.get("target"):void 0),a=1,i=n(function(e,n){return n.length>0&&t.add(r,this.format(r,"invalid_association")),0===--a?o():void 0},this),null!=(null!=s?s.forEach:void 0)?s.forEach(function(t){return a+=1,t.validate(i)}):null!=(null!=s?s.validate:void 0)&&(a+=1,s.validate(i)),i(null,[])):o()},t}(),Batman.Validators.push(Batman.AssociatedValidator)}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.ControllerActionFrame=function(){function t(e,n){t.__super__.constructor.call(this,e),this.once("complete",n)}return e(t,Batman.Object),t.prototype.operationOccurred=!1,t.prototype.remainingOperations=0,t.prototype.event("complete").oneShot=!0,t.prototype.startOperation=function(t){return null==t&&(t={}),t.internal||(this.operationOccurred=!0),this._changeOperationsCounter(1),!0},t.prototype.finishOperation=function(){return this._changeOperationsCounter(-1),!0},t.prototype.startAndFinishOperation=function(t){return this.startOperation(t),this.finishOperation(t),!0},t.prototype._changeOperationsCounter=function(t){var e;this.remainingOperations+=t,0===this.remainingOperations&&this.fire("complete"),null!=(e=this.parentFrame)&&e._changeOperationsCounter(t)},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=function(t,e){return function(){return t.apply(e,arguments)}};Batman.DOM.InsertionBinding=function(){function t(e){this.invert=e.invert,this.placeholderNode=document.createComment("detached node "+this.get("_batmanID")),t.__super__.constructor.apply(this,arguments),Batman.DOM.onParseExit(this.node,n(function(){return this.bind(),null!=this.placeholderNode?Batman.DOM.trackBinding(this,this.placeholderNode):void 0},this))}return e(t,Batman.DOM.AbstractBinding),t.prototype.isTwoWay=!1,t.prototype.bindImmediately=!1,t.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,t.prototype.dataChange=function(t){var e;if(e=this.placeholderNode.parentNode||this.node.parentNode,!!t==!this.invert){if(null==this.node.parentNode)return Batman.DOM.insertBefore(e,this.node,this.placeholderNode),e.removeChild(this.placeholderNode)}else if(null!=this.node.parentNode)return e.insertBefore(this.placeholderNode,this.node),Batman.DOM.removeNode(this.node)},t.prototype.die=function(){var e,n,r;if(!this.dead)return n=this.node,r=this.placeholderNode,e=this.get("filteredValue"),t.__super__.die.apply(this,arguments),!!e==!this.invert?Batman.DOM.destroyNode(r):Batman.DOM.destroyNode(n)},t}()}.call(this),function(){var t;t=function(t){var e;for(e in t)return!1;return!0},Batman.extend(Batman,{cache:{},uuid:0,expando:"batman"+(""+Math.random()).replace(/\D/g,""),canDeleteExpando:function(){var t;try{return t=document.createElement("div"),delete t.test}catch(e){return Batman.canDeleteExpando=!1}}(),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?Batman.cache[e[Batman.expando]]:e[Batman.expando],!!e&&!t(e)},data:function(t,e,n,r){var o,i,a,s,u,c;if(Batman.acceptData(t)&&(s=Batman.expando,i="string"==typeof e,o=Batman.cache,a=t[Batman.expando],!(!a||r&&a&&o[a]&&!o[a][s])||!i||void 0!==n))return a||(3!==t.nodeType?t[Batman.expando]=a=++Batman.uuid:a=Batman.expando),o[a]||(o[a]={}),("object"==typeof e||"function"==typeof e)&&(r?o[a][s]=Batman.extend(o[a][s],e):o[a]=Batman.extend(o[a],e)),c=o[a],r&&(c[s]||(c[s]={}),c=c[s]),void 0!==n&&(c[e]=n),u=i?c[e]:c},removeData:function(e,n,r){var o,i,a,s,u,c;if(Batman.acceptData(e)&&(s=Batman.expando,u=e.nodeType,o=Batman.cache,i=e[Batman.expando],o[i]&&!(n&&(c=r?o[i][s]:o[i],c&&(delete c[n],!t(c)))||r&&(delete o[i][s],!t(o[i])))))return a=o[i][s],Batman.canDeleteExpando||!o.setInterval?delete o[i]:o[i]=null,a?(o[i]={},o[i][s]=a):Batman.canDeleteExpando?delete e[Batman.expando]:e.removeAttribute?e.removeAttribute(Batman.expando):e[Batman.expando]=null},_data:function(t,e,n){return Batman.data(t,e,n,!0)},acceptData:function(t){var e;return t.nodeName&&(e=Batman.noData[t.nodeName.toLowerCase()])?!(e===!0||t.getAttribute("classid")!==e):!0}})}.call(this),function(){var t,e,n=Array.prototype.slice;t=function(t){return function(e){return null==e?void 0:t.apply(this,arguments)}},e=function(t,e){return t||e},Batman.Filters={raw:t(function(t,e){return e.escapeValue=!1,t}),get:t(function(t,e){return null!=t.get?t.get(e):t[e]}),equals:t(function(t,e){return t===e}),and:function(t,e){return t&&e},or:function(t,e){return t||e},not:function(t){return!t},trim:t(function(t){return t.trim()}),matches:t(function(t,e){return-1!==t.indexOf(e)}),truncate:t(function(t,e,n,r){return null==n&&(n="..."),r||(r=n,n="..."),t.length>e&&(t=t.substr(0,e-n.length)+n),t}),"default":function(t,e){return null!=t&&""!==t?t:e},prepend:function(t,e){return(null!=e?e:"")+(null!=t?t:"")},append:function(t,e){return(null!=t?t:"")+(null!=e?e:"")},replace:t(function(t,e,n,r,o){return o||(o=r,r=void 0),void 0===r?t.replace(e,n):t.replace(e,n,r)}),downcase:t(function(t){return t.toLowerCase()}),upcase:t(function(t){return t.toUpperCase()}),pluralize:t(function(t,e,n,r){return r||(r=n,n=!0,r||(r=e,e=void 0)),null!=e?Batman.helpers.pluralize(e,t,void 0,n):Batman.helpers.pluralize(t)}),humanize:t(function(t){return Batman.helpers.humanize(t)}),join:t(function(t,e,n){return null==e&&(e=""),n||(n=e,e=""),t.join(e)}),sort:t(function(t){return t.sort()}),map:t(function(t,e){return t.map(function(t){return Batman.get(t,e)})}),has:function(t,e){return null==t?!1:Batman.contains(t,e)},first:t(function(t){return t[0]}),meta:t(function(t,e){return Batman.developer.assert(t.meta,"Error, value doesn't have a meta to filter on!"),t.meta.get(e)}),interpolate:function(t,e,n){var r,o,i;if(n||(n=e,e=void 0),t){i={};for(r in e)o=e[r],i[r]=this.get(o),null==i[r]&&(Batman.developer.warn("Warning! Undefined interpolation key "+r+" for interpolation",t),i[r]="");return Batman.helpers.interpolate(t,i)}},withArguments:function(){var t,e,r,o;return e=arguments[0],r=arguments.length>=3?n.call(arguments,1,o=arguments.length-1):(o=1,[]),t=arguments[o++],e?function(){var t;return t=arguments.length>=1?n.call(arguments,0):[],e.call.apply(e,[this].concat(n.call(r),n.call(t)))}:void 0},routeToAction:t(function(t,e){var n;return n=Batman.Dispatcher.paramsFromArgument(t),n.action=e,n}),escape:t(Batman.escapeHTML)},function(){var e,n,r,o,i;for(o=["capitalize","singularize","underscore","camelize"],i=[],n=0,r=o.length;r>n;n++)e=o[n],i.push(Batman.Filters[e]=t(Batman.helpers[e]));return i}(),Batman.developer.addFilters()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=function(t,e){return function(){return t.apply(e,arguments)}};Batman.HTMLStore=function(){function t(){t.__super__.constructor.apply(this,arguments),this._htmlContents={},this._requestedPaths=new Batman.SimpleSet}return e(t,Batman.Object),t.prototype.propertyClass=Batman.Property,t.prototype.fetchHTML=function(t){return new Batman.Request({url:Batman.Navigator.normalizePath(Batman.config.pathToHTML,""+t+".html"),type:"html",success:n(function(e){return this.set(t,e)},this),error:function(){throw Error("Could not load html from "+t)}})},t.accessor({"final":!0,get:function(t){var e;if("/"!==t.charAt(0))return this.get("/"+t);if(this._htmlContents[t])return this._htmlContents[t];if(!this._requestedPaths.has(t)){if(e=this._sourceFromDOM(t))return e;if(!Batman.config.fetchRemoteHTML)throw Error("Couldn't find html source for '"+t+"'!");this.fetchHTML(t)}},set:function(t,e){return"/"!==t.charAt(0)?this.set("/"+t,e):(this._requestedPaths.add(t),this._htmlContents[t]=e)}}),t.prototype.prefetch=function(t){return this.get(t),!0},t.prototype._sourceFromDOM=function(t){var e,n;return n=t.slice(1),(e=Batman.DOM.querySelector(document,"[data-defineview*='"+n+"']"))?(Batman.setImmediate(function(){var t;return null!=(t=e.parentNode)?t.removeChild(e):void 0}),Batman.DOM.defineView(t,e)):void 0},t}()}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=Array.prototype.slice,r=function(t,e){return function(){return t.apply(e,arguments)}};Batman.View=function(){function t(e){var n;null==e&&(e={}),n=e.context,n?n instanceof Batman.RenderContext||(n=Batman.RenderContext.root().descend(n)):n=Batman.RenderContext.root(),e.context=n.descend(this),t.__super__.constructor.call(this,e),Batman.Property.withoutTracking(r(function(){return this.observeAndFire("readyToRender",r(function(t){return t?this.render():void 0},this))},this))}return e(t,Batman.Object),t.YieldStorage=function(){function t(){t.__super__.constructor.apply(this,arguments)}return e(t,Batman.Hash),t.wrapAccessor(function(t){return{get:function(e){var n;return n=t.get.call(this,e),null==n&&(n=this.set(e,[])),n}}}),t}(),t.store=new Batman.HTMLStore,t.option=function(){var t;return t=arguments.length>=1?n.call(arguments,0):[],this.accessor.apply(this,n.call(t).concat([{get:function(t){var e;return null!=(e=this.get("argumentBindings."+t))?e.get("filteredValue"):void 0},set:function(t,e){var n;return null!=(n=this.get("argumentBindings."+t))?n.set("filteredValue",e):void 0},unset:function(t){var e;return null!=(e=this.get("argumentBindings."+t))?e.unset("filteredValue"):void 0}}]))},t.prototype.isView=!0,t.prototype.cache=!0,t.prototype._rendered=!1,t.prototype.node=null,t.prototype.event("ready").oneShot=!0,t.accessor("argumentBindings",function(){return new Batman.TerminalAccessible(r(function(t){var e,n,r,o,i,a;if((i=this.get("node"))&&(n=this.get("context"))&&(o=i.getAttribute(("data-view-"+t).toLowerCase()),null!=o))return e="_argumentBinding"+t,null!=(a=this[e])&&a.die(),r=new Batman.DOM.ReaderBindingDefinition(i,o,n),this[e]=new Batman.DOM.ViewArgumentBinding(r)},this))}),t.accessor("html",{get:function(){var t;if(this.html&&this.html.length>0)return this.html;if(t=this.get("source"))return t=Batman.Navigator.normalizePath(t),this.html=this.constructor.store.get(t)},set:function(t,e){return this.html=e}}),t.accessor("node",{get:function(){var t;if(null==this.node){if(t=this.get("html"),!(t&&t.length>0))return;this.node=document.createElement("div"),this._setNodeOwner(this.node),Batman.DOM.setInnerHTML(this.node,t)}return this.node},set:function(t,e){var n;return this.node=e,this._setNodeOwner(e),n=r(function(t){return null!=t?(Batman.DOM.setInnerHTML(this.node,t),this.forget("html",n)):void 0},this),this.observeAndFire("html",n),e}}),t.accessor("yields",function(){return new this.constructor.YieldStorage}),t.accessor("fetched?",function(){return null!=this.get("source")}),t.accessor("readyToRender",function(){var t;return this.get("node")&&(this.get("fetched?")?(null!=(t=this.get("html"))?t.length:void 0)>0:!0)}),t.prototype.render=function(){var t;if(!this._rendered)return this._rendered=!0,this._renderer=new Batman.Renderer(t=this.get("node"),this.get("context"),this),this._renderer.once("rendered",r(function(){return this.fire("ready",t)},this))},t.prototype.isInDOM=function(){var t;return(t=this.get("node"))?null!=t.parentNode||this.get("yields").some(function(e,n){var r,o;for(r=0,o=n.length;o>r;r++)if(t=n[r].node,null!=t.parentNode)return!0;return!1}):!1},t.prototype.die=function(){var t;return this.fire("destroy",this.node),this.forget(),null!=(t=this._batman.properties)&&t.forEach(function(t,e){return e.die()}),this.get("yields").forEach(function(t,e){var n,r,o,i;for(i=[],r=0,o=e.length;o>r;r++)n=e[r].node,i.push(Batman.DOM.didDestroyNode(n));return i})},t.prototype.applyYields=function(){return this.get("yields").forEach(function(t,e){var n,r,o,i,a,s,u;for(o=Batman.DOM.Yield.withName(t),u=[],i=0,a=e.length;a>i;i++)s=e[i],r=s.node,n=s.action,u.push(o[n](r));return u})},t.prototype.retractYields=function(){return this.get("yields").forEach(function(t,e){var n,r,o,i,a;for(a=[],r=0,o=e.length;o>r;r++)n=e[r].node,a.push(null!=(i=n.parentNode)?i.removeChild(n):void 0);return a})},t.prototype.pushYieldAction=function(t,e,n){return this._setNodeYielder(n),this.get("yields").get(t).push({node:n,action:e})},t.prototype._setNodeOwner=function(t){return Batman._data(t,"view",this)},t.prototype._setNodeYielder=function(t){return Batman._data(t,"yielder",this)},t.prototype.on("ready",function(){return"function"==typeof this.ready?this.ready.apply(this,arguments):void 0}),t.prototype.on("appear",function(){return"function"==typeof this.viewDidAppear?this.viewDidAppear.apply(this,arguments):void 0}),t.prototype.on("disappear",function(){return"function"==typeof this.viewDidDisappear?this.viewDidDisappear.apply(this,arguments):void 0}),t.prototype.on("beforeAppear",function(){return"function"==typeof this.viewWillAppear?this.viewWillAppear.apply(this,arguments):void 0}),t.prototype.on("beforeDisappear",function(){return"function"==typeof this.viewWillDisappear?this.viewWillDisappear.apply(this,arguments):void 0}),t}.call(this)}.call(this),function(){var t=Object.prototype.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.RenderContext=function(){function t(t,e){this.object=t,this.parent=e}var n;return t.deProxy=function(t){return null!=t&&t.isContextProxy?t.get("proxiedObject"):t},t.root=function(){var t;return null!=Batman.currentApp&&(t=Batman.currentApp.get("_renderContext")),null!=t?t:t=this.base},t.prototype.windowWrapper={window:Batman.container},t.prototype.findKey=function(t){var e,n,r;for(e=t.split(".")[0].split("|")[0].trim(),n=this;n;){if(r=Batman.get(n.object,e),r!==void 0)return r=Batman.get(n.object,t),[r,n.object].map(this.constructor.deProxy);n=n.parent}return[Batman.get(this.windowWrapper,t),this.windowWrapper]},t.prototype.get=function(t){return this.findKey(t)[0]},t.prototype.contextForKey=function(t){return this.findKey(t)[1]},t.prototype.descend=function(t,e){var n;return e&&(n=t,t=new Batman.Object,t[e]=n),new this.constructor(t,this)},t.prototype.descendWithDefinition=function(t){var e;return e=new n(t),this.descend(e,t.attr)},t.prototype.chain=function(){var t,e;for(e=[],t=this;t;)e.push(t.object),t=t.parent;return e},t.ContextProxy=n=function(){function t(t){this.binding=new Batman.DOM.AbstractBinding(t)}return e(t,Batman.Object),t.prototype.isContextProxy=!0,t.accessor("proxiedObject",function(){return this.binding.get("filteredValue")}),t.accessor({get:function(t){return this.get("proxiedObject."+t)},set:function(t,e){return this.set("proxiedObject."+t,e)},unset:function(t){return this.unset("proxiedObject."+t)}}),t}(),t}.call(this),Batman.RenderContext.base=new Batman.RenderContext(Batman.RenderContext.prototype.windowWrapper)}.call(this),function(){var t,e=Object.prototype.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},r=Array.prototype.slice,o=function(t,e){return function(){return t.apply(e,arguments)}};Batman.DOM.Yield=t=function(){function t(){this.cycle()}return n(t,Batman.Object),t.yields={},t.queued=function(t){return function(){var e,n;return e=arguments.length>=1?r.call(arguments,0):[],null!=this.containerNode?t.apply(this,e):n=this.observe("containerNode",o(function(){var r;return r=t.apply(this,e),this.forget("containerNode",n),r},this))}},t.reset=function(){return this.yields={}},t.withName=function(t){var e;return(e=this.yields)[t]||(e[t]=new this({name:t})),this.yields[t]},t.forEach=function(t){var e,n,r;r=this.yields;for(e in r)n=r[e],t(n)},t.clearAll=function(){return this.forEach(function(t){return t.clear()})},t.cycleAll=function(){return this.forEach(function(t){return t.cycle()})},t.clearAllStale=function(){return this.forEach(function(t){return t.clearStale()})},t.prototype.cycle=function(){return this.currentVersionNodes=[]},t.prototype.clear=t.queued(function(){var t,e,n,r,o;for(this.cycle(),r=function(){var e,n,r,o;for(r=this.containerNode.childNodes,o=[],e=0,n=r.length;n>e;e++)t=r[e],o.push(t);return o}.call(this),o=[],e=0,n=r.length;n>e;e++)t=r[e],o.push(Batman.DOM.removeOrDestroyNode(t));return o}),t.prototype.clearStale=t.queued(function(){var t,e,n,r,o;for(r=function(){var e,n,r,o;for(r=this.containerNode.childNodes,o=[],e=0,n=r.length;n>e;e++)t=r[e],o.push(t);return o}.call(this),o=[],e=0,n=r.length;n>e;e++)t=r[e],~this.currentVersionNodes.indexOf(t)||o.push(Batman.DOM.removeOrDestroyNode(t));return o}),t.prototype.append=t.queued(function(t){return this.currentVersionNodes.push(t),Batman.DOM.appendChild(this.containerNode,t,!0)}),t.prototype.replace=t.queued(function(t){return this.clear(),this.append(t)}),t}()}.call(this),function(){}.call(this),!function(t,e){"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(t,e):this[t]=e()}("reqwest",function(){function handleReadyState(t,e,n){return function(){t&&4==t[readyState]&&(twoHundo.test(t.status)?e(t):n(t))}}function setHeaders(t,e){var n,r=e.headers||{};r.Accept=r.Accept||defaultHeaders.accept[e.type]||defaultHeaders.accept["*"],e.crossOrigin||r[requestedWith]||(r[requestedWith]=defaultHeaders.requestedWith),r[contentType]||(r[contentType]=e.contentType||defaultHeaders.contentType);for(n in r)r.hasOwnProperty(n)&&t.setRequestHeader(n,r[n])}function generalCallback(t){lastValue=t}function urlappend(t,e){return t+(/\?/.test(t)?"&":"?")+e}function handleJsonp(t,e,n,r){var o=uniqid++,i=t.jsonpCallback||"callback",a=t.jsonpCallbackName||"reqwest_"+o,s=RegExp("((^|\\?|&)"+i+")=([^&]+)"),u=r.match(s),c=doc.createElement("script"),p=0;u?"?"===u[3]?r=r.replace(s,"$1="+a):a=u[3]:r=urlappend(r,i+"="+a),win[a]=generalCallback,c.type="text/javascript",c.src=r,c.async=!0,c.onreadystatechange!==void 0&&(c.event="onclick",c.htmlFor=c.id="_reqwest_"+o),c.onload=c.onreadystatechange=function(){return c[readyState]&&"complete"!==c[readyState]&&"loaded"!==c[readyState]||p?!1:(c.onload=c.onreadystatechange=null,c.onclick&&c.onclick(),t.success&&t.success(lastValue),lastValue=void 0,head.removeChild(c),p=1,void 0)},head.appendChild(c)
}function getRequest(t,e,n){var r,o=(t.method||"GET").toUpperCase(),i="string"==typeof t?t:t.url,a=t.processData!==!1&&t.data&&"string"!=typeof t.data?reqwest.toQueryString(t.data):t.data||null;return"jsonp"!=t.type&&"GET"!=o||!a||(i=urlappend(i,a),a=null),"jsonp"==t.type?handleJsonp(t,e,n,i):(r=xhr(),r.open(o,i,!0),setHeaders(r,t),r.onreadystatechange=handleReadyState(r,e,n),t.before&&t.before(r),r.send(a),r)}function Reqwest(t,e){this.o=t,this.fn=e,init.apply(this,arguments)}function setType(t){var e=t.match(/\.(json|jsonp|html|xml)(\?|$)/);return e?e[1]:"js"}function init(o,fn){function complete(t){o.timeout&&clearTimeout(self.timeout),self.timeout=null,o.complete&&o.complete(t)}function success(resp){var r=resp.responseText;if(r)switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r}fn(resp),o.success&&o.success(resp),complete(resp)}function error(t,e,n){o.error&&o.error(t,e,n),complete(t)}this.url="string"==typeof o?o:o.url,this.timeout=null;var type=o.type||setType(this.url),self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){self.abort()},o.timeout)),this.request=getRequest(o,success,error)}function reqwest(t,e){return new Reqwest(t,e)}function normalize(t){return t?t.replace(/\r?\n/g,"\r\n"):""}function serial(t,e){var n=t.name,r=t.tagName.toLowerCase(),o=function(t){t&&!t.disabled&&e(n,normalize(t.attributes.value&&t.attributes.value.specified?t.value:t.text))};if(!t.disabled&&n)switch(r){case"input":if(!/reset|button|image|file/i.test(t.type)){var i=/checkbox/i.test(t.type),a=/radio/i.test(t.type),s=t.value;(!(i||a)||t.checked)&&e(n,normalize(i&&""===s?"on":s))}break;case"textarea":e(n,normalize(t.value));break;case"select":if("select-one"===t.type.toLowerCase())o(t.selectedIndex>=0?t.options[t.selectedIndex]:null);else for(var u=0;t.length&&t.length>u;u++)t.options[u].selected&&o(t.options[u])}}function eachFormElement(){var t,e,n,r=this,o=function(t,e){for(var o=0;e.length>o;o++){var i=t[byTag](e[o]);for(n=0;i.length>n;n++)serial(i[n],r)}};for(e=0;arguments.length>e;e++)t=arguments[e],/input|select|textarea/i.test(t.tagName)&&serial(t,r),o(t,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var t={};return eachFormElement.apply(function(e,n){e in t?(t[e]&&!isArray(t[e])&&(t[e]=[t[e]]),t[e].push(n)):t[e]=n},arguments),t}var context=this,win=window,doc=document,old=context.reqwest,twoHundo=/^20\d$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,lastValue,xmlHttpRequest="XMLHttpRequest",isArray="function"==typeof Array.isArray?Array.isArray:function(t){return t instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"},requestedWith:xmlHttpRequest},xhr=win[xmlHttpRequest]?function(){return new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")};return Reqwest.prototype={abort:function(){this.request.abort()},retry:function(){init.call(this,this.o,this.fn)}},reqwest.serializeArray=function(){var t=[];return eachFormElement.apply(function(e,n){t.push({name:e,value:n})},arguments),t},reqwest.serialize=function(){if(0===arguments.length)return"";var t,e,n=Array.prototype.slice.call(arguments,0);return t=n.pop(),t&&t.nodeType&&n.push(t)&&(t=null),t&&(t=t.type),e="map"==t?serializeHash:"array"==t?reqwest.serializeArray:serializeQueryString,e.apply(null,n)},reqwest.toQueryString=function(t){var e,n="",r=encodeURIComponent,o=function(t,e){n+=r(t)+"="+r(e)+"&"};if(isArray(t))for(e=0;t&&t.length>e;e++)o(t[e].name,t[e].value);else for(var i in t)if(Object.hasOwnProperty.call(t,i)){var a=t[i];if(isArray(a))for(e=0;a.length>e;e++)o(i,a[e]);else o(i,t[i])}return n.replace(/&$/,"").replace(/%20/g,"+")},reqwest.compat=function(t,e){return t&&(t.type&&(t.method=t.type)&&delete t.type,t.dataType&&(t.type=t.dataType),t.jsonpCallback&&(t.jsonpCallbackName=t.jsonpCallback)&&delete t.jsonpCallback,t.jsonp&&(t.jsonpCallback=t.jsonp)),new Reqwest(t,e)},reqwest}),function(){var t,e;Batman.extend(Batman.DOM,{querySelectorAll:null!=("undefined"!=typeof window&&null!==window?null!=(t=window.document)?t.querySelectorAll:void 0:void 0)?function(t,e){return t.querySelectorAll(e)}:function(){return Batman.developer.error("Please include either jQuery or a querySelectorAll polyfill, or set Batman.DOM.querySelectorAll to return an empty array.")},querySelector:null!=("undefined"!=typeof window&&null!==window?null!=(e=window.document)?e.querySelector:void 0:void 0)?function(t,e){return t.querySelector(e)}:function(){return Batman.developer.error("Please include either jQuery or a querySelector polyfill, or set Batman.DOM.querySelector to an empty function.")},setInnerHTML:function(t,e){var n,r,o,i,a,s,u;for(r=function(){var e,r,o,i;for(o=t.childNodes,i=[],e=0,r=o.length;r>e;e++)n=o[e],i.push(n);return i}(),i=0,s=r.length;s>i;i++)n=r[i],Batman.DOM.willRemoveNode(n);for(o=t.innerHTML=e,a=0,u=r.length;u>a;a++)n=r[a],Batman.DOM.didRemoveNode(n);return o},removeNode:function(t){var e;return Batman.DOM.willRemoveNode(t),null!=(e=t.parentNode)&&e.removeChild(t),Batman.DOM.didRemoveNode(t)},destroyNode:function(t){return Batman.DOM.willDestroyNode(t),Batman.DOM.removeNode(t),Batman.DOM.didDestroyNode(t)},appendChild:function(t,e){return Batman.DOM.willInsertNode(e),t.appendChild(e),Batman.DOM.didInsertNode(e)},textContent:function(t){return t.textContent}})}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};Batman.Request.prototype._parseResponseHeaders=function(t){var e;return e=t.getAllResponseHeaders().split("\n").reduce(function(t,e){var n,r,o;return(r=e.match(/([^:]*):\s*(.*)/))&&(n=r[1],o=r[2],t[n]=o),t},{})},Batman.Request.prototype.send=function(t){var n,r,o;return null==t&&(t=this.get("data")),this.fire("loading"),n={url:this.get("url"),method:this.get("method"),type:this.get("type"),headers:this.get("headers"),success:e(function(t){return this.mixin({xhr:r,response:t,status:r!==void 0&&null!==r?r.status:void 0,responseHeaders:this._parseResponseHeaders(r)}),this.fire("success",t)},this),error:e(function(t){return this.mixin({xhr:t,response:t.responseText||t.content,status:t.status,responseHeaders:this._parseResponseHeaders(t)}),t.request=this,this.fire("error",t)},this),complete:e(function(){return this.fire("loaded")},this)},"PUT"===(o=n.method)||"POST"===o?this.hasFileUploads()?n.data=this.constructor.objectToFormData(t):(n.contentType=this.get("contentType"),n.data=Batman.URI.queryFromParams(t)):n.data=t,r=reqwest(n).request},t=["Webkit","Moz","O","ms",""],Batman.mixins.animation={initialize:function(){var e,n,r;for(n=0,r=t.length;r>n;n++)e=t[n],this.style[""+e+"Transform"]="scale(1, 1)",this.style.opacity=1,this.style[""+e+"TransitionProperty"]=""+(e?"-"+e.toLowerCase()+"-":"")+"transform, opacity",this.style[""+e+"TransitionDuration"]="0.8s, 0.55s",this.style[""+e+"TransformOrigin"]="left top";return this},show:function(n){var r,o,i;return r=e(function(){var e,n,r;for(this.style.opacity=1,n=0,r=t.length;r>n;n++)e=t[n],this.style[""+e+"Transform"]="scale(1, 1)";return this},this),n?(null!=(o=n.append)&&o.appendChild(this),null!=(i=n.before)&&i.parentNode.insertBefore(this,n.before),setTimeout(r,0)):r(),this},hide:function(n){var r,o,i;for(this.style.opacity=0,o=0,i=t.length;i>o;o++)r=t[o],this.style[""+r+"Transform"]="scale(0, 0)";return n&&setTimeout(e(function(){var t;return null!=(t=this.parentNode)?t.removeChild(this):void 0},this),600),this}}}.call(this),function(){}.call(this);